<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Arquillian Cube</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Arquillian Cube</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_what_is_this">1. What is this?</a></li>
<li><a href="#_preliminaries">2. Preliminaries</a></li>
<li><a href="#_basic_example">3. Basic Example</a></li>
<li><a href="#_standalone_example">4. Standalone Example</a></li>
<li><a href="#_arquillian_cube_bom_unified_dependencies">5. Arquillian Cube BOM - Unified Dependencies</a>
<ul class="sectlevel2">
<li><a href="#_usage">5.1. Usage</a></li>
<li><a href="#_available_modules">5.2. Available Modules:</a></li>
</ul>
</li>
<li><a href="#_configuration">6. Configuration</a>
<ul class="sectlevel2">
<li><a href="#_networks">6.1. Networks</a></li>
<li><a href="#_cube_environment">6.2. cube.environment</a></li>
<li><a href="#_await">6.3. Await</a></li>
<li><a href="#_inferring_exposedports_from_portbinding">6.4. Inferring exposedPorts from portBinding</a></li>
<li><a href="#_allow_connecting_to_a_running_container">6.5. Allow connecting to a running container</a></li>
<li><a href="#_before_stop_events">6.6. Before Stop Events</a></li>
<li><a href="#_cubespecificproperties">6.7. CubeSpecificProperties</a></li>
<li><a href="#automatic-resolution">6.8. Automatic serverUri resolution</a></li>
</ul>
</li>
<li><a href="#_building_containers">7. Building containers</a></li>
<li><a href="#docker-compose-format">8. Docker-Compose Format</a></li>
<li><a href="#_enrichers">9. Enrichers</a>
<ul class="sectlevel2">
<li><a href="#_docker_inside_docker_docker_on_docker">9.1. Docker Inside Docker / Docker On Docker</a></li>
<li><a href="#_cubecontroller">9.2. CubeController</a></li>
<li><a href="#_auto_starting_cubes_outside_of_arquillian_containers">9.3. Auto starting Cubes outside of Arquillian Containers</a></li>
<li><a href="#_auto_remapping">9.4. Auto-Remapping</a></li>
<li><a href="#_dockerserverip_and_containers">9.5. DockerServerIp and Containers</a></li>
<li><a href="#_system_properties_injection">9.6. System Properties Injection</a></li>
</ul>
</li>
<li><a href="#_parallel_execution">10. Parallel Execution</a>
<ul class="sectlevel2">
<li><a href="#_star_operator">10.1. Star Operator</a></li>
</ul>
</li>
<li><a href="#_container_object_pattern">11. Container Object pattern</a>
<ul class="sectlevel2">
<li><a href="#_arquillian_cube_and_container_object">11.1. Arquillian Cube and Container Object</a></li>
<li><a href="#_arquillian_cube_and_container_object_dsl">11.2. Arquillian Cube and Container Object DSL</a></li>
</ul>
</li>
<li><a href="#_arquillian_standalone_and_cube">12. Arquillian Standalone and Cube</a></li>
<li><a href="#_requirements_module">13. Requirements Module</a>
<ul class="sectlevel2">
<li><a href="#_example_of_environment_requirements">13.1. Example of environment requirements</a></li>
<li><a href="#_example_with_openshift_4">13.2. Example with OpenShift 4</a></li>
<li><a href="#_customizing_requirements">13.3. Customizing Requirements</a></li>
</ul>
</li>
<li><a href="#_containerless_server_and_docker">14. Containerless Server and Docker</a>
<ul class="sectlevel2">
<li><a href="#_java_embedded_servers">14.1. Java Embedded Servers</a></li>
</ul>
</li>
<li><a href="#_cube_docker_dronegraphene_integration">15. Cube Docker Drone/Graphene Integration</a>
<ul class="sectlevel2">
<li><a href="#_drone">15.1. Drone</a></li>
<li><a href="#_graphene">15.2. Graphene</a></li>
</ul>
</li>
<li><a href="#_rest_assured_integration">16. Rest-Assured integration</a>
<ul class="sectlevel2">
<li><a href="#_why_integration_with_cube">16.1. Why integration with Cube?</a></li>
<li><a href="#_configuration_3">16.2. Configuration</a></li>
</ul>
</li>
<li><a href="#_arquillian_reporter_integration">17. Arquillian Reporter integration</a>
<ul class="sectlevel2">
<li><a href="#_arquillian_cube_docker_reporter_2">17.1. Arquillian Cube Docker Reporter</a></li>
<li><a href="#_arquillian_cube_docker_drone_integration">17.2. Arquillian Cube Docker Drone Integration</a></li>
<li><a href="#_arquillian_cube_docker_restassured_integration">17.3. Arquillian Cube Docker RestAssured Integration</a></li>
<li><a href="#_arquillian_cube_kubernetes_reporter_2">17.4. Arquillian Cube Kubernetes Reporter</a></li>
<li><a href="#_examples">17.5. Examples</a></li>
</ul>
</li>
<li><a href="#_polyglot_applications">18. Polyglot Applications</a></li>
<li><a href="#_kubernetes">19. Kubernetes</a>
<ul class="sectlevel2">
<li><a href="#_overview">19.1. Overview</a></li>
<li><a href="#_modules">19.2. Modules</a></li>
<li><a href="#_features">19.3. Features</a></li>
<li><a href="#_pre_requisites">19.4. Pre-requisites</a></li>
<li><a href="#_setup">19.5. Setup</a></li>
<li><a href="#_configuring_the_extension">19.6. Configuring the extension</a></li>
<li><a href="#_namespaces">19.7. Namespaces</a></li>
<li><a href="#_creating_the_environment">19.8. Creating the environment</a></li>
<li><a href="#_readiness_and_waiting">19.9. Readiness and waiting</a></li>
<li><a href="#_immutable_infrastructure_and_integration_testing">19.10. Immutable infrastructure and integration testing</a></li>
<li><a href="#_resource_providers">19.11. Resource Providers</a></li>
<li><a href="#_openshift_integration_with_graphene">19.12. OpenShift Integration with Graphene</a></li>
<li><a href="#_openshift_integration_with_restassured">19.13. OpenShift Integration with RestAssured</a></li>
<li><a href="#_istio_in_kubernetesopenshift">19.14. Istio in Kubernetes/OpenShift</a></li>
<li><a href="#_arquillian_kubernetes_and_openshift_recipes">19.15. Arquillian Kubernetes and OpenShift Recipes</a></li>
<li><a href="#_dealing_with_version_conflicts">19.16. Dealing with version conflicts</a></li>
</ul>
</li>
<li><a href="#_fabric8">20. Fabric8</a>
<ul class="sectlevel2">
<li><a href="#_additional_features">20.1. Additional Features</a></li>
<li><a href="#_jkube_kubernetes_openshift_maven_plugin_integration_with_cube">20.2. JKube Kubernetes &amp; OpenShift Maven Plugin Integration With Cube</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
2.0.0.Final breaks compatibility with previous versions as <em>boot2docker</em> and <em>DockerMachine</em> support has
been removed. This means that support for Windows and macOS or the Docker Machine usage is removed from 2.x.
We&#8217;re in the process of evaluating whether to add such support to the 2.x stream again, or to adopt
different solutions. In such a case we&#8217;d probably release a 1.x version, which would still support such components.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_this"><a class="anchor" href="#_what_is_this"></a>1. What is this?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Arquillian Cube</strong> is an <em>Arquillian</em> extension that can be used to manager <em>Docker</em> containers from <em>Arquillian</em>.</p>
</div>
<div class="paragraph">
<p>Extension is named <strong>Cube</strong> for two reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Because Docker is like a cube</p>
</li>
<li>
<p>Because <a href="http://en.memory-alpha.org/wiki/Borg_cube">Borg starship</a> is named <strong>cube</strong> and well because we are moving tests close to production we can say that "any resistance is futile, bugs will be assimilated".</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With this extension you can start a <em>Docker</em> container with a server installed, deploy the required deployable file within it and execute <em>Arquillian</em> tests.</p>
</div>
<div class="paragraph">
<p>The key point here is that if <em>Docker</em> is used as deployable platform in production, your tests are executed in the same container as it will be in production, so your tests are even more real than before.</p>
</div>
<div class="paragraph">
<p>But it also lets you start a container with every required service like database, mail server, &#8230;&#8203; and instead of stubbing or using fake objects your tests can use real servers.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This extension has been developed and tested on a Linux machine with the <em>Docker</em> server already installed.</p>
</div>
<div class="paragraph">
<p>The current version is meant to fill a gap in the project maintenance, and to support execution against latest <em>Docker</em>,
<em>Kubernetes</em> and <em>OpenShift</em> versions, but we had to take some decisions about deprecated integration, mainly due to
capacity reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Arquillian Cube 2.0.0 does not support execution on <em>Windows</em> and <em>macOS</em> machines anymore</strong>, since the <strong>Boot2Docker</strong>
integration has been removed, and it no longer supports <strong>Docker Machine</strong> integration, due to deprecation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We&#8217;re aware this might be an issue in some cases, and we&#8217;re open to community discussion about any options that could
help mitigate the consequences, like temporarily resuming the integration in a sustaining branch. Feel free to
log issues or start discussions about this topic.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preliminaries"><a class="anchor" href="#_preliminaries"></a>2. Preliminaries</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Arquillian Cube</strong> relies on <a href="https://github.com/docker-java/docker-java">docker-java</a> API.</p>
</div>
<div class="paragraph">
<p>To use <strong>Arquillian Cube</strong> you need a <em>Docker</em> daemon running on a computer (it can be local or not), but probably it will
be at local.</p>
</div>
<div class="paragraph">
<p>By default, the <em>Docker</em> server uses UNIX sockets for communicating with the <em>Docker</em> client.
<strong>Arquillian Cube</strong> will attempt to set <em>docker-java</em> to use UNIX socket on <em>Linux</em>.</p>
</div>
<div class="paragraph">
<p>If you want to use TCP/IP to connect to the Docker server, you&#8217;ll need to make sure that your
<em>Docker</em> server is listening on TCP port. To allow <em>Docker</em> server to use TCP, set the <em>Docker daemon options</em>, the exact
process for which varies by the way you launch the Docker daemon and/or the underlying OS:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>systemd (Ubuntu, Debian, RHEL 7, CentOS 7, Fedora, Archlinux) — edit docker.service and change the ExecStart value</p>
<div class="paragraph">
<p>To change the value of an option, ExecStart in this case, do the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ sudo systemctl edit docker</pre>
</div>
</div>
<div class="paragraph">
<p>This will create the necessary directory structure under <code>/etc/systemd/system/docker.service.d</code> and open an editor
(using the default editor configured for the user) to the override file. Add the section below into the editor:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[Service]
ExecStart=
ExecStart=/usr/bin/dockerd -H tcp://127.0.0.1:2375 -H unix:///var/run/docker.sock</pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, ExecStart is cleared out - using <code>ExecStart=</code> - before setting it to the override value. This is only
required for some options, while most of them in the configuration file would not need to be cleared like this. Using
systemctl edit also ensures that the override settings are loaded.</p>
</div>
</li>
<li>
<p>upstart (Ubuntu 14.04 and older versions) — set DOCKER_OPTS in <code>/etc/default/docker</code></p>
<div class="literalblock">
<div class="content">
<pre>DOCKER_OPTS="-H tcp://127.0.0.1:2375 -H unix:///var/run/docker.sock"</pre>
</div>
</div>
</li>
<li>
<p>In case of Fedora distribution docker installed on Fedora - set OPTIONS in <code>/etc/sysconfig/docker</code></p>
<div class="literalblock">
<div class="content">
<pre>OPTIONS='-H tcp://127.0.0.1:2375 -H unix:///var/run/docker.sock'</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After restarting the <em>Docker</em> daemon you need to make sure that <em>Docker</em> is up and listening on TCP.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">$ sudo systemctl daemon-reload
$ sudo systemctl restart docker</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">$ docker -H tcp://127.0.0.1:2375 version

Client version: 0.8.0
Go version (client): go1.2
Git commit (client): cc3a8c8
Server version: 1.2.0
Git commit (server): fa7b24f
Go version (server): go1.3.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you cannot see the client and server versions then it means that something is wrong with the <em>Docker</em> installation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_example"><a class="anchor" href="#_basic_example"></a>3. Basic Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After having a <em>Docker</em> server installed we can start using <strong>Arquillian Cube</strong>.
In this case we are going to use a very simple example using a <em>Docker</em> image with <em>Apache Tomcat</em> and we are going to test a <em>Servlet</em> on it.</p>
</div>
<div class="listingblock">
<div class="title">HelloWorldServlet.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/HelloWorld</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldServlet</span> <span class="directive">extends</span> HttpServlet {

  <span class="annotation">@Override</span>
  <span class="directive">protected</span> <span class="type">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {
    <span class="predefined-type">PrintWriter</span> writer = resp.getWriter();
    writer.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>);
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">HelloWorldServletTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Arquillian.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldServletTest</span> {

  <span class="annotation">@Deployment</span>(testable=<span class="predefined-constant">false</span>) <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="directive">public</span> <span class="directive">static</span> WebArchive create() {
    <span class="keyword">return</span> ShrinkWrap.create(WebArchive.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">hello.war</span><span class="delimiter">&quot;</span></span>).addClass(HelloWorldServlet.class); <i class="conum" data-value="2"></i><b>(2)</b>
  }

  <span class="annotation">@Test</span>
  <span class="directive">public</span> <span class="type">void</span> should_parse_and_load_configuration_file(<span class="annotation">@ArquillianResource</span> <span class="predefined-type">URL</span> resource) <span class="directive">throws</span> <span class="exception">IOException</span> { <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="predefined-type">URL</span> obj = <span class="keyword">new</span> <span class="predefined-type">URL</span>(resource, <span class="string"><span class="delimiter">&quot;</span><span class="content">HelloWorld</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">HttpURLConnection</span> con = (<span class="predefined-type">HttpURLConnection</span>) obj.openConnection();
    con.setRequestMethod(<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>);

    <span class="predefined-type">BufferedReader</span> in = <span class="keyword">new</span> <span class="predefined-type">BufferedReader</span>(
            <span class="keyword">new</span> <span class="predefined-type">InputStreamReader</span>(con.getInputStream()));
    <span class="predefined-type">String</span> inputLine;
    <span class="predefined-type">StringBuffer</span> response = <span class="keyword">new</span> <span class="predefined-type">StringBuffer</span>();

    <span class="keyword">while</span> ((inputLine = in.readLine()) != <span class="predefined-constant">null</span>) {
        response.append(inputLine);
    }
    in.close();

    assertThat(response.toString(), is(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>));<i class="conum" data-value="4"></i><b>(4)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In this case we are running the test as a client. So in fact this test is executed against the container instead of inside the container.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>No changes in this part, we need to create a deployable file, and because we are testing against <em>Tomcat</em>, a <em>war</em> file is created.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Because the test is run as client, we can use @ArquillianResource to get the URL where the file is deployed. Note that this will be the URL to access <em>Tomcat</em> running inside the <em>Docker</em> container.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Typical jUnit assertion of servlet response.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now this test could be run in any container, there is nothing that ties this to <em>Docker</em>.
Next step is adding some dependencies apart from the typical <em>Arquillian</em> dependencies.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-docker<span class="tag">&lt;/artifactId&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tag">&lt;version&gt;</span>${project.version}<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>

<span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jboss.arquillian.container<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>arquillian-tomcat-remote-7<span class="tag">&lt;/artifactId&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tag">&lt;version&gt;</span>1.0.0.CR7<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Adds <strong>Arquillian Cube</strong> dependency.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>From the point of view of <em>Arquillian</em>, <em>Tomcat</em> is being executed in a remote host (in fact this is true because <em>Tomcat</em> is running inside <em>Docker</em> which is external to <em>Arquillian</em>), so we need to add the remote adapter.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And finally we need to configure <em>Tomcat</em> remote adapter and <strong>Arquillian Cube</strong> in arquillian.xml file.</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="tag">&lt;arquillian</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://jboss.org/schema/arquillian</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://jboss.org/schema/arquillian</span>
  <span class="content">http://jboss.org/schema/arquillian/arquillian_1_0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

  <span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">docker</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverVersion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>1.12<span class="tag">&lt;/property&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverUri</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>http://localhost:2375<span class="tag">&lt;/property&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">definitionFormat</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>CUBE<span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dockerContainers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
          tomcat:
            image: tomcat:10.1.30
            exposedPorts: [8089/tcp]
            await:
              strategy: polling
            env: [TOMCAT_PASS=mypass, JAVA_OPTS=-Dcom.sun.management.jmxremote.port=8089 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false]
            portBindings: [8089/tcp, 8080/tcp]
      <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/extension&gt;</span>

  <span class="tag">&lt;container</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tomcat</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="5"></i><b>(5)</b>
      <span class="tag">&lt;configuration&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>localhost<span class="tag">&lt;/property&gt;</span> <i class="conum" data-value="6"></i><b>(6)</b>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpPort</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>8080<span class="tag">&lt;/property&gt;</span> <i class="conum" data-value="7"></i><b>(7)</b>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>admin<span class="tag">&lt;/property&gt;</span> <i class="conum" data-value="8"></i><b>(8)</b>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pass</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>mypass<span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;/configuration&gt;</span>
  <span class="tag">&lt;/container&gt;</span>

<span class="tag">&lt;/arquillian&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><strong>Arquillian Cube</strong> extension is registered.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><em>Docker</em> server version is required.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><em>Docker</em> server URI is required.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A <em>Docker</em> container contains a lot of parameters that can be configured. To avoid having to create one XML property for each one, a YAML content can be embedded directly as property.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Configuration of <em>Tomcat</em> remote adapter. Cube will start the <em>Docker</em> container when it is ran in the same context as an <em>Arquillian</em> container with the same name.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Host can be <em>localhost</em> because there is a port forwarding between container and <em>Docker</em> server.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Port is exposed as well.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>User and password are required to deploy the war file to remote <em>Tomcat</em>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Notice that in this case you are using <em>CUBE</em> format as orchestration definition but you&#8217;ll see in next sections that you can use <strong>docker_compose</strong> too.
Read more at <a href="#_configuration">Configuration</a> section and <a href="#docker-compose-format">Docker-Compose Format</a>.</p>
</div>
<div class="paragraph">
<p>And that&#8217;s all.
Now you can run your test and you will see how <em>tomcat:10.1.30</em> image is downloaded and started.
Ports 8080 (Tomcat standard port) and 8089(JMX port used by Arquillian) are exposed.
Finally in <em>env</em> section, environment variables are set. Read next link to understand why this is required <a href="https://docs.jboss.org/author/display/ARQ/Tomcat+7.0+-+Remote" class="bare">https://docs.jboss.org/author/display/ARQ/Tomcat+7.0+-+Remote</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_standalone_example"><a class="anchor" href="#_standalone_example"></a>4. Standalone Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In previous example you have seen how to to start a Docker container, deploy an <em>Shrinkwrap</em> element using <code>@Deployment</code> to finally execute the test inside Docker container, get the results and stops everything.</p>
</div>
<div class="paragraph">
<p>But this is not the only way of using Arquillian Cube.
Sometimes you already have your container image created and you want to test that it starts, that exposes correctly the ports and of course that for example the deployment file is in the correct place.
This is known as <strong>Container tests</strong>.
Notice that in this case you don&#8217;t need <code>@Deployment</code> method since the image is already created and you don&#8217;t want to modify anything.
The only thin g that you want is start the container, run the test (as client) and if everything works, then just stop the container.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see how to do it:</p>
</div>
<div class="paragraph">
<p>First major change is in dependencies:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-docker<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.jboss.arquillian.junit<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>arquillian-junit-standalone<span class="tag">&lt;/artifactId&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Instead of setting a container, you set arquillian in standalone mode</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Than you can define in your <code>arquillian.xml</code> or <code>docker-compose.xml</code> containers.
For example:</p>
</div>
<div class="listingblock">
<div class="title">docker-compose.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">planetstest</span>:
  <span class="key">extends</span>:
      <span class="key">file</span>: <span class="string"><span class="content">../docker-compose.yml</span></span>
      <span class="key">service</span>: <span class="string"><span class="content">planets</span></span>
  <span class="key">image</span>: <span class="string"><span class="content">lordofthejars/starwars:1.0.1</span></span> <span class="comment">#1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>&lt;1&gt;Image with WAR file already bundled inside server</p>
</div>
<div class="paragraph">
<p>And finally the test:</p>
</div>
<div class="listingblock">
<div class="title">PlanetServiceAPIContainerTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Arquillian.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">PlanetServiceAPIContainerTest</span> {

    <span class="annotation">@HostIp</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> ip;

    <span class="annotation">@HostPort</span>(containerName = <span class="string"><span class="delimiter">&quot;</span><span class="content">planetstest</span><span class="delimiter">&quot;</span></span>, value = <span class="integer">8080</span>)
    <span class="type">int</span> planetsPort;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> shouldReturnAverage() {
        <span class="predefined-type">URL</span> url = <span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://</span><span class="delimiter">&quot;</span></span> + ip + <span class="string"><span class="delimiter">&quot;</span><span class="content">:</span><span class="delimiter">&quot;</span></span> + planetsPort + <span class="string"><span class="delimiter">&quot;</span><span class="content">/starwars/</span><span class="delimiter">&quot;</span></span>);
        <span class="directive">final</span> <span class="predefined-type">String</span> average = RestAssured.get(url.toExternalForm() + <span class="string"><span class="delimiter">&quot;</span><span class="content">rest/planet/orbital/average</span><span class="delimiter">&quot;</span></span>).asString();
        assertThat(average, is(<span class="string"><span class="delimiter">&quot;</span><span class="content">1699.42</span><span class="delimiter">&quot;</span></span>));
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that in this case there is no <code>@Deployment</code> method because the full application is already bundled in the docker image that is being used.
This test basically validates that the image can be started, and finally that from outside you can communicate with it and it returns something valid.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_arquillian_cube_bom_unified_dependencies"><a class="anchor" href="#_arquillian_cube_bom_unified_dependencies"></a>5. Arquillian Cube BOM - Unified Dependencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This aims to fulfill requirements for unifying naming &amp; versions.</p>
</div>
<div class="sect2">
<h3 id="_usage"><a class="anchor" href="#_usage"></a>5.1. Usage</h3>
<div class="paragraph">
<p>Include the following snippet in your pom.xml file:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;version.arquillian_cube&gt;</span>${latest_released_version}<span class="tag">&lt;/version.arquillian_cube&gt;</span>
<span class="tag">&lt;/properties&gt;</span>

<span class="tag">&lt;dependencyManagement&gt;</span>
    <span class="tag">&lt;dependencies&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-bom<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>${version.arquillian_cube}<span class="tag">&lt;/version&gt;</span>
            <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
            <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then include the individual modules as you see fit, by simply depending on the unified pom name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-docker<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_available_modules"><a class="anchor" href="#_available_modules"></a>5.2. Available Modules:</h3>
<div class="sect3">
<h4 id="_arquillian_cube_api"><a class="anchor" href="#_arquillian_cube_api"></a>5.2.1. Arquillian Cube API</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-api<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquillian_cube_spi"><a class="anchor" href="#_arquillian_cube_spi"></a>5.2.2. Arquillian Cube SPI</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-spi<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquillian_cube_core"><a class="anchor" href="#_arquillian_cube_core"></a>5.2.3. Arquillian Cube Core</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-core<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquillian_cube_containerless"><a class="anchor" href="#_arquillian_cube_containerless"></a>5.2.4. Arquillian Cube Containerless</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-containerless<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquillian_cube_requirement"><a class="anchor" href="#_arquillian_cube_requirement"></a>5.2.5. Arquillian Cube Requirement</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-requirement<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquillian_cube_docker"><a class="anchor" href="#_arquillian_cube_docker"></a>5.2.6. Arquillian Cube Docker</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-docker<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquillian_cube_docker_starter_single_unified_dependency_for_cube_docker_in_standalone_mode"><a class="anchor" href="#_arquillian_cube_docker_starter_single_unified_dependency_for_cube_docker_in_standalone_mode"></a>5.2.7. Arquillian Cube Docker Starter (Single Unified Dependency for Cube Docker in Standalone Mode)</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-docker-starter<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>${project.version}<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquillian_cube_docker_junit_rule"><a class="anchor" href="#_arquillian_cube_docker_junit_rule"></a>5.2.8. Arquillian Cube Docker Junit Rule</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-docker-junit-rule<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>${project.version}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquillian_cube_docker_drone"><a class="anchor" href="#_arquillian_cube_docker_drone"></a>5.2.9. Arquillian Cube Docker Drone</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-docker-drone<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquillian_cube_docker_restassured"><a class="anchor" href="#_arquillian_cube_docker_restassured"></a>5.2.10. Arquillian Cube Docker Restassured</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-docker-restassured<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquillian_cube_docker_reporter"><a class="anchor" href="#_arquillian_cube_docker_reporter"></a>5.2.11. Arquillian Cube Docker Reporter</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-docker-reporter<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_docker_java_assertj"><a class="anchor" href="#_docker_java_assertj"></a>5.2.12. Docker Java AssertJ</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>assertj-docker-java<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquillian_cube_kubernetes"><a class="anchor" href="#_arquillian_cube_kubernetes"></a>5.2.13. Arquillian Cube Kubernetes</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-kubernetes<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquillian_cube_kubernetes_starter_single_unified_dependency_for_cube_kubernetes_in_standalone_mode"><a class="anchor" href="#_arquillian_cube_kubernetes_starter_single_unified_dependency_for_cube_kubernetes_in_standalone_mode"></a>5.2.14. Arquillian Cube Kubernetes Starter (Single Unified Dependency for Cube Kubernetes in Standalone Mode)</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-kubernetes-starter<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>${project.version}<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquillian_cube_kubernetes_reporter"><a class="anchor" href="#_arquillian_cube_kubernetes_reporter"></a>5.2.15. Arquillian Cube Kubernetes Reporter</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-kubernetes-reporter<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquillian_cube_kubernetes_fabric8"><a class="anchor" href="#_arquillian_cube_kubernetes_fabric8"></a>5.2.16. Arquillian Cube Kubernetes Fabric8</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-kubernetes-fabric8<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquillian_cube_openshift"><a class="anchor" href="#_arquillian_cube_openshift"></a>5.2.17. Arquillian Cube Openshift</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-openshift<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arquillian_cube_openshift_starter_single_unified_dependency_for_cube_openshift_in_standalone_mode"><a class="anchor" href="#_arquillian_cube_openshift_starter_single_unified_dependency_for_cube_openshift_in_standalone_mode"></a>5.2.18. Arquillian Cube Openshift Starter (Single Unified Dependency for Cube OpenShift in Standalone Mode)</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-openshift-starter<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>${project.version}<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration"><a class="anchor" href="#_configuration"></a>6. Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Arquillian Cube</strong> requires some parameters to be configured, some related with <em>Docker</em> server and others related to the image that is being used.
The following table summarizes the attributes that are currently supported:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serverVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version of REST API provided by <em>Docker</em> server. You should check on the <em>Docker</em> site which version of REST API is shipped inside installed <em>Docker</em> service. This field is not mandatory and if it&#8217;s not set the default provided version from <em>docker-java</em> will be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serverUri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uri of <em>Docker</em> server. It can be a unix socket URI as well in case you are running <em>Docker</em> on Linux (unix:///var/run/docker.sock). If the URI has <code>http://</code> or <code>https://</code> scheme, the <code>tlsVerify</code> attribute will be set by Cube to <code>false</code> or <code>true</code> respectively. You can read at <a href="#automatic-resolution">this section</a> about automatic resolution of serverUri parameter. Also, you can use <code>DOCKER_HOST</code> java property or system environment to set this parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dockerRegistry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the location of Docker registry. Default value is the official <em>Docker</em> registry located at <a href="https://registry.hub.docker.com" class="bare">https://registry.hub.docker.com</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the username to connect to Docker registry.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the password to connect to Docker registry.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dockerContainers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Each <em>Docker</em> image (or container) can be configured with different parameters. This configuration is provided in YAML format. This property can be used to embed as YAML string value, all configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dockerContainersFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instead of embedding YAML as a string, you can set the location of a YAML file with this attribute. The location can be a relative from the root of the project or also a URI that is converted to URL so you can effectively have docker definitions on remote sites.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dockerContainersFiles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can set a list of locations separated by comma. These locations follow the same rules as <code>dockerContainersFile</code> so it can be a file or an URI. This property can be used to append the definitions from several files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dockerContainersResource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rather than embedding YAML as a string, or specifying a path on the filesystem, you can specify a file containing the container definitions on the java classpath. This allows you to avoid dealing with complex relative paths if sharing definitions between multiple modules.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">definitionFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the format of content expressed in <code>dockerContainers</code> attribute or in file set in <code>dockerContainersFile</code>. It can contain two possible values <em>CUBE</em> to indicate that content is written following <a href="#cube-format">Arquillian Cube</a> format or <em>COMPOSE</em> (default one in case of not set) to indicate that content is written following <a href="#docker-compose-format">Docker Compose</a> format.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cubeSpecificProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In case you are using COMPOSE format, you cannot configure cube custom properties like <code>await</code> or <code>beforeStop</code>. This property allows you to add them in already defined containers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoStartContainers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cube will normally start a <em>Docker</em> container when it has the same name as an active <em>Arquillian</em> container and all the containers defined as links to this container, so basically <em>Cube</em> resolves all the container dependencies as well e.g. a database where the application saves data, or mail server where application sends an email. That works for things that are <em>DeployableContainer</em>'s. In case of defining networks instead of links, Cube will start <strong>only</strong> all the containers that belongs to a network defined inside definition file. For any other container services that might not have a link to the <em>DeployableContainer</em>, e.g. a monitor, you can use the <em>autoStartContainers</em> option to define which <em>Docker</em> containers to automatically start up. The option takes a comma separated list of <em>Docker</em> container ids. e.g. <em>monitor</em>. <strong>Arquillian Cube</strong> will attempt to start the containers in parallel if possible as well as start any linked containers. Also if you need to start several images, instead of adding them as CSV, you can use a regular expression by prefixing with <code>regexp:</code>, for example setting the property to <code>regexp:a(.*)</code> would start all container ids starting with <em>a</em>, or you can add a custom implementation of <code>org.arquillian.cube.spi.AutoStartParser</code> by using reserved word <code>custom:</code> and the full qualified class name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoStartOrder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property to set a new strategy for starting Cubes. Normally the default one is enough but in some cases, if you need to modify it or provide a custom one you can use this property. You need to set the fully qualified name of a class implementing <code>org.arquillian.cube.spi.AutoStartOrder</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsVerify</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean to set if Cube should connect to Docker server with TLS. This attribute will be ignored if <code>serverUri</code> attribute starts with <code>http://</code> or <code>https://</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certPath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path where certificates are stored. If you are not using <em>https</em> protocol this parameter is not required. This parameter accepts starting with ~ as home directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dockerInsideDockerResolution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean to set if Cube should detect that tests are run inside an already started Docker container, so Docker containers started by Cube could be run using DinD (Docker Inside Docker) or DoD (docker On Docker). Basically it ignores any <code>SERVER_URI</code> properties and sets the <code>serverUri</code> to <code>unix:///var/run/docker.sock</code>. By default, its value is set to true. If you want to use an external dockerhost, then you need to set this property to false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sometimes you might have left some container running inside your docker host with the same name as one defined for Cube test. When this happens, Arquillian Cube (actually Docker) complains about a conflict, i.e. trying to create a container using a name that exists already. If you want for Cube to automatically remove such containers, then you can set this property to true. By default, it is set to false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">removeVolumes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean, whether Cube should also remove the volumes associated with a container when removing the container. By default,
it is set to true. Can be overwritten on container level.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cleanBuildImage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean to set if you set to true all images built by cube are removed and if false no built images are removed. If image is not built by cube it should not be removed. By default, it is set true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionMode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection Mode to bypass the Create/Start Cube commands if the a Docker Container with the same name is already running on the target system. This parameter can receive three possible values. <em>STARTANDSTOP</em> which is the default one if not set any and simply creates and stops all Docker Containers. If a container is already running, an exception is thrown. <em>STARTORCONNECT</em> mode tries to bypass the Create/Start Cube commands if a container with the same name is already running, and if it is the case doesn’t stop it at the end. But if container is not already running, Cube will start one and stop it at the end of the execution. And last mode is <em>STARTORCONNECTANDLEAVE</em> which is exactly the same of <em>STARTORCONNECT</em> but if container is started by Cube it won’t be stopped at the end of the execution, so it can be reused in next executions. <strong>This is a Cube property, not a Docker one</strong>, thus it should be inside a &lt;extension qualifier="cube"&gt; tag. See <a href="#_allow_connecting_to_a_running_container">here</a> for an example.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignoreContainersDefinition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you set to true then Arquillian Cube will ignore definitions set in <code>dockerContainers</code>, <code>dockerContainersFile</code> and <code>dockerContainersFiles</code> as well as default locations. By default is set to false.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Some of these properties can be provided by using standard Docker system environment variables, so that you can set them
once and then use them in your tests too. Additionally, you can set such configuration as Java system properties (-D&#8230;&#8203;)
as well.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serverUri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOCKER_HOST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certPath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOCKER_CERT_PATH</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If <code>dockerContainers</code>, <code>dockerContainersFile</code> or <code>dockerContainersFiles</code> are not set Arquillian Cube automatically search a file named <code>docker-compose.y(a)ml</code> into next places and in following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>src/{test, main}/docker</code> having more priority <code>test location than `main</code> location.</p>
</li>
<li>
<p><code>Root</code> directory of project</p>
</li>
<li>
<p><code>src/distribution</code></p>
</li>
<li>
<p><code>src/{test, main}/resources/docker</code> having more priority <code>test location than `main</code> location.</p>
</li>
<li>
<p><code>src/{test, main}/resources</code> having more priority <code>test location than `main</code> location.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the next example you can see a whole YAML document with configuration properties.
Keep in mind that almost all of them are configuration parameters provided by <em>Docker</em> remote API.
In this example we are going to explain the attributes that are most used and special cases.
Of course not all of them are mandatory:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In YAML adding brackets ("[" "]") is for setting a list.
</td>
</tr>
</table>
</div>
<div id="cube-format" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tomcat</span>: <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30 </span></span><i class="conum" data-value="2"></i><b>(2)</b>
  <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp] </span></span><i class="conum" data-value="3"></i><b>(3)</b>
  <span class="key">await</span>: <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="key">strategy</span>: <span class="string"><span class="content">polling </span></span><i class="conum" data-value="5"></i><b>(5)</b>
  <span class="key">workingDir</span>: <span class="string"><span class="content">.</span></span>
  <span class="key">alwaysPull</span>: <span class="string"><span class="content">false</span></span>
  <span class="key">disableNetwork</span>: <span class="string"><span class="content">true</span></span>
  <span class="key">hostName</span>: <span class="string"><span class="content">host</span></span>
  <span class="key">portSpecs</span>: <span class="string"><span class="content">[80,81]</span></span>
  <span class="key">user</span>: <span class="string"><span class="content">alex</span></span>
  <span class="key">tty</span>: <span class="string"><span class="content">true</span></span>
  <span class="key">stdinOpen</span>: <span class="string"><span class="content">true</span></span>
  <span class="key">stdinOnce</span>: <span class="string"><span class="content">true</span></span>
  <span class="key">memoryLimit</span>: <span class="string"><span class="content">1</span></span>
  <span class="key">memorySwap</span>: <span class="string"><span class="content">1</span></span>
  <span class="key">cpuShares</span>: <span class="string"><span class="content">1</span></span>
  <span class="key">cpuQuota</span>: <span class="string"><span class="content">1</span></span>
  <span class="key">shmSize</span>: <span class="string"><span class="content">64</span></span>
  <span class="key">cpuSet</span>: <span class="string"><span class="content">a</span></span>
  <span class="key">extraHosts</span>: <span class="string"><span class="content">a</span></span>
  <span class="key">attachStdin</span>: <span class="string"><span class="content">true</span></span>
  <span class="key">attachStderr</span>: <span class="string"><span class="content">true</span></span>
  <span class="key">env</span>: <span class="string"><span class="content">[TOMCAT_PASS=mypass, JAVA_OPTS=-Dcom.sun.management.jmxremote.port=8089] </span></span><i class="conum" data-value="6"></i><b>(6)</b>
  <span class="key">cmd</span>: <span class="string"><span class="content">[] </span></span><i class="conum" data-value="7"></i><b>(7)</b>
  <span class="key">dns</span>: <span class="string"><span class="content">[127.0.0.1]</span></span>
  <span class="key">volumes</span>: <span class="string"><span class="content">[/tmp]</span></span>
  <span class="key">volumesFrom</span>: <span class="string"><span class="content">[tomcat]</span></span>
  <span class="key">removeVolumes</span>: <span class="string"><span class="content">true</span></span>
  <span class="key">binds</span>:
    - <span class="string"><span class="content">/host:/container:ro</span></span>
  <span class="key">links</span>:
    - <span class="string"><span class="content">name:alias</span></span>
    - <span class="string"><span class="content">name2:alias2</span></span>
  <span class="key">portBindings</span>: <span class="string"><span class="content">[8089/tcp, 8081-&gt;8080/tcp] </span></span><i class="conum" data-value="8"></i><b>(8)</b>
  <span class="key">privileged</span>: <span class="string"><span class="content">true</span></span>
  <span class="key">publishAllPorts</span>: <span class="string"><span class="content">true</span></span>
  <span class="key">networkMode</span>: <span class="string"><span class="content">host</span></span>
  <span class="key">dnsSearch</span>: <span class="string"><span class="content">[127.0.0.1]</span></span>
  <span class="key">entryPoint</span>: <span class="string"><span class="content">[sh]</span></span>
  <span class="key">devices</span>:
    <span class="key">cGroupPermissions</span>: <span class="string"><span class="content">a</span></span>
    <span class="key">pathOnHost</span>: <span class="string"><span class="content">b</span></span>
    <span class="key">pathInContainer</span>: <span class="string"><span class="content">c</span></span>
  <span class="key">restartPolicy</span>:
    <span class="key">name</span>: <span class="string"><span class="content">failure</span></span>
    <span class="key">maximumRetryCount</span>: <span class="string"><span class="content">1</span></span>
  <span class="key">capAdd</span>: <span class="string"><span class="content">[a]</span></span>
  <span class="key">capDrop</span>: <span class="string"><span class="content">[b]</span></span>
  <span class="key">extends</span>: <span class="string"><span class="content">container-id </span></span><i class="conum" data-value="9"></i><b>(9)</b>
  <span class="key">manual</span>: <span class="string"><span class="content">true </span></span><i class="conum" data-value="10"></i><b>(10)</b>
  <span class="key">killContainer</span>: <span class="string"><span class="content">true </span></span><i class="conum" data-value="11"></i><b>(11)</b>
  <span class="key">alias</span>: <span class="string"><span class="content">tomcat1 </span></span><i class="conum" data-value="12"></i><b>(12)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name that is going to be assigned to the running container. It is <strong>mandatory</strong>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of the image to be used. It is <strong>mandatory</strong>. If the image has not already been pulled by the <em>Docker</em> server, <strong>Arquillian Cube</strong> will pull it for you. If you want to always pull latest image before container is created, you can configure <strong>alwaysPull: true</strong>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Sets exposed ports of the running container. It should follow the format <em>port number</em> slash(/) and _protocol (udp or tcp). Note that it is a list and it is not mandatory.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>After a container is started, it starts booting up the defined services/commands. Depending on the nature of service, the lifecycle of these services are linked to start up or not. For example Tomcat, Wildlfy, TomEE and in general all Java servers must be started in foreground and this means that from the point of view of the client, the container never finishes to start. But on the other side other services like Redis are started in background and when the container is started you can be sure that Redis server is there. To avoid executing tests before the services are ready, you can set which await strategy should be used from <strong>Arquillian Cube</strong> side to accept that <em>Docker</em> container and all its defined services are up and ready. It is not mandatory and by default polling with <em>ss</em> command strategy is used.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>In strategy you set which strategy you want to follow. Currently, three strategies are supported. <em>static</em>, <em>native</em> and <em>polling</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can pass environment variables by using <code>env</code>. In this section you can set special <code>dockerServerIp</code> string which at runtime will be replaced by <em>Cube</em> to current docker server ip.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>After the container is up, a list of commands can be executed within it.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Port forwarding is configured using <code>portBinding</code> section. It contains a list of <code>exposedPort</code> and <code>port</code> separated by arrow (<em>&#8594;</em>). If only one port is provided, <strong>Arquillian Cube</strong> will expose the same port number. In this example the exposed port 8089 is mapped to 8089 and exposed port 8080 is mapped to 8081.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>You can extend another configuration. Any top level element and it&#8217;s children from the target container-id will be copied over to this configuration, unless they have been defined here already.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>You can use <code>manual</code> to indicate that this container is going to be started or in the test manually using <code>CubeController</code> or started by an extension. This attribute is ingorned in case of arquillian containers (none autostart containers) or in case of a linked container that comes from a none manual container.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Kills the container instead of stopping it normally. By default, it is set to false, so that containers are stopped.</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Alternate hostname for use with the builtin DNS for <a href="https://docs.docker.com/engine/network/#user-defined-networks">docker&#8217;suser defined networks</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As we&#8217;ve seen in the basic example the definition of the Arquillian Cube scenarios are described in <code>dockerContainers</code> property.
But if you want you can avoid using this property by simply creating a file called <code>cube</code> in the root of the classpath of your project.
<em>Arquillian Cube</em> will read it as if it was defined in <code>arquilllian.xml</code> file.</p>
</div>
<div class="listingblock">
<div class="title">src/test/resources/cube</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tomcat</span>:
  <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
  <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp]</span></span>
  <span class="key">await</span>:
    <span class="key">strategy</span>: <span class="string"><span class="content">polling</span></span>
  <span class="key">env</span>: <span class="string"><span class="content">[TOMCAT_PASS=mypass, JAVA_OPTS=-Dcom.sun.management.jmxremote.port=8089 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false]</span></span>
  <span class="key">portBindings</span>: <span class="string"><span class="content">[8089/tcp, 8080/tcp]</span></span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_networks"><a class="anchor" href="#_networks"></a>6.1. Networks</h3>
<div class="paragraph">
<p>You can define networks using cube format (Docker Compose v1 (the one supported by Cube) does not have support to networks.
For defining them you only need to use the reserved word <code>networks</code>.</p>
</div>
<div class="listingblock">
<div class="title">src/test/resources/cube</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">networks</span>: <i class="conum" data-value="1"></i><b>(1)</b>
   <span class="key">mynetwork</span>: <i class="conum" data-value="2"></i><b>(2)</b>
       <span class="key">driver</span>: <span class="string"><span class="content">bridge </span></span><i class="conum" data-value="3"></i><b>(3)</b>
<span class="key">tomcat</span>:
  <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
  <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp]</span></span>
  <span class="key">networkMode</span>: <span class="string"><span class="content">mynetwork </span></span><i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Reserved word to indicate start of network definition</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Network name</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Driver used. Currently this is the only supported property due not support in docker-java</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Sets the network where container must join.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also use <code>networks</code> to connect to more than one network:</p>
</div>
<div class="listingblock">
<div class="title">src/test/resources/cube</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">tomcat</span>:
  <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
  <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp]</span></span>
  <span class="key">networkMode</span>: <span class="string"><span class="content">mynetwork</span></span>
  <span class="key">networks</span>:
    - <span class="string"><span class="content">mynetwork</span></span>
    - <span class="string"><span class="content">myothernetwork</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cube_environment"><a class="anchor" href="#_cube_environment"></a>6.2. cube.environment</h3>
<div class="paragraph">
<p>In case you use the <code>dockerContainersFile</code> to configure a YAML file (Cube format or Compose format) for loading the definition of your containers, you can use <code>cube.environment</code> system property to append a prefix to the file you want to load.</p>
</div>
<div class="paragraph">
<p>For example, in case you set <code>dockerContainersFile</code> to <code>docker-compose.yml</code> and <code>cube.environment</code> not set, Cube loads a file named <code>docker-compose.yml</code>. But if <code>cube.environment</code> is set to <strong>qa</strong> (<code>-Dcube.environment=qa</code>), the Cube loads a file called <code>docker-compose.qa.yml</code>.</p>
</div>
<div class="paragraph">
<p>This property is useful for loading different configurations depending on the environment you are running the tests.</p>
</div>
</div>
<div class="sect2">
<h3 id="_await"><a class="anchor" href="#_await"></a>6.3. Await</h3>
<div class="paragraph">
<p>After a container is started, it starts booting up the defined services/commands.
Depending on the nature of service, the lifecycle of these services are linked to start up or not.
For example Tomcat, Wildlfy, TomEE and in general all Java servers must be started in foreground and this means that from the point of view of the <em>Docker</em> client, the container never finishes to start.
But on the other side other services like Redis are started in background and when the container is started you can be sure that Redis server is there.
To avoid executing tests before the services are ready, you can set which await strategy should be used from <strong>Arquillian Cube</strong> side to accept that <em>Docker</em> container and all its defined services are up and ready.</p>
</div>
<div class="paragraph">
<p>Currently next await strategies are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">native</dt>
<dd>
<p>it uses <strong>wait</strong> command. In this case current thread is waiting until the <em>Docker</em> server notifies that has started. In case of foreground services this is not the approach to be used.</p>
</dd>
<dt class="hdlist1">polling</dt>
<dd>
<p>in this case a polling (with <em>ping</em> or <em>ss</em> command) is executed for 5 seconds against all exposed ports. When communication to all exposed ports is acknowledged, the container is considered to be up. This approach is the one to be used in case of services started in foreground. By default <em>polling</em> executes <em>ss</em> command inside the running container to know if the server is already running.
Also you can use a <em>ping</em> strategy from client by setting type attribute to ping; Note that <em>ping</em> only works if you are running <em>Docker</em> daemon on localhost.
You can also use <code>wait-for-it</code> script which is automatically downloaded, copied inside container and executed inside it. To do it you need to set <code>type</code> property to <code>waitforit</code>. In almost all cases the default behaviour matches all scenarios. If it is not specified, this is the default strategy.
By default, if you use <em>ss</em> strategy but ss command is not installed into the container it fallsback automatically to waitforit strategy.</p>
</dd>
<dt class="hdlist1">static</dt>
<dd>
<p>similar to <em>polling</em>, but it uses the host ip and specified list of ports provided as configuration parameter.</p>
</dd>
<dt class="hdlist1">sleeping</dt>
<dd>
<p>sleeps current thread for the specified amount of time. You can specify the time in seconds or milliseconds.</p>
</dd>
<dt class="hdlist1">log</dt>
<dd>
<p>looks for a specified pattern in container log to detect service startup. This can be used when there is no port to connect or connecting to the port successfully doesn&#8217;t mean the service is fully initialized.</p>
</dd>
<dt class="hdlist1">http</dt>
<dd>
<p>polls through a configured http endpoint checking for http response code and optionally the answer content or headers.</p>
</dd>
<dt class="hdlist1">docker_health</dt>
<dd>
<p>polls the docker API to wait for the container to match the docker healthy definition (see: <a href="https://docs.docker.com/engine/reference/builder/#healthcheck">here</a>).</p>
</dd>
<dt class="hdlist1">&lt;fullyqualifiedclassname&gt;</dt>
<dd>
<p>if you specify a fully qualified class name, Arquillian Cube will instantiate the given class. In this way you can implement your own await strategies. There are two rules to follow, the first one is that class must implement <code>AwaitStrategy</code> and the second one is that one default constructor must be provided. Optionally you can add fields/setters for types <code>Cube</code>, <code>DockerClientExecutor</code> or <code>Await</code> to inject them into the await strategy.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>By default in case you don&#8217;t specify any <em>await</em> strategy, polling with <em>ss</em> command is used with automatic fallback to <em>wait-fo_it</em> strategy.</p>
</div>
<div class="listingblock">
<div class="title">Example native</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tomcat</span>:
  <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
  <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp]</span></span>
  <span class="key">await</span>:
    <span class="key">strategy</span>: <span class="string"><span class="content">native</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example polling using ss command by default</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tomcat</span>:
  <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
  <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp]</span></span>
  <span class="key">await</span>:
    <span class="key">strategy</span>: <span class="string"><span class="content">polling</span></span>
    <span class="key">sleepPollingTime</span>: <span class="string"><span class="content">200 s </span></span><i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key">iterations</span>: <span class="string"><span class="content">3 </span></span><i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Optional parameter to configure sleeping time between poling. You can set in seconds using <em>s</em> or miliseconds using <em>ms</em>. By default time unit is miliseconds and value 500.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optional parameter to configure number of retries to be done. By default 10 iterations are done.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example static</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tomcat</span>:
  <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
  <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp]</span></span>
  <span class="key">await</span>:
    <span class="key">strategy</span>: <span class="string"><span class="content">static</span></span>
    <span class="key">ip</span>: <span class="string"><span class="content">localhost</span></span>
    <span class="key">ports</span>: <span class="string"><span class="content">[8080, 8089]</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example sleeping</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tomcat</span>:
  <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
  <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp]</span></span>
  <span class="key">await</span>:
    <span class="key">strategy</span>: <span class="string"><span class="content">sleeping</span></span>
    <span class="key">sleepTime</span>: <span class="string"><span class="content">200 s </span></span><i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Optional parameter to configure sleeping time between poling. You can set in seconds using <em>s</em> or miliseconds using <em>ms</em>. By default time unit is miliseconds and value 500.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example log</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tomcat</span>:
  <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
  <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp]</span></span>
  <span class="key">await</span>:
    <span class="key">strategy</span>: <span class="string"><span class="content">log</span></span>
    <span class="key">match</span>: <span class="string"><span class="content">'Server startup' </span></span><i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key">stdOut</span>: <span class="string"><span class="content">true </span></span><i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key">stdErr</span>: <span class="string"><span class="content">true </span></span><i class="conum" data-value="3"></i><b>(3)</b>
    <span class="key">timeout</span>: <span class="string"><span class="content">15 </span></span><i class="conum" data-value="4"></i><b>(4)</b>
    <span class="key">occurrences</span>: <span class="string"><span class="content">2 </span></span><i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Mandatory parameter to configure the pattern that signals the service started. To use regular expression just prefix the pattern with <code>regexp:</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optional parameter to enable scanning of <em>standard output</em> log. Default is true.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Optional parameter to enable scanning of <em>standard error</em> log. Default is false.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Optional parameter to configure timeout. It is expressed in seconds and by default is 15.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Optional parameter to configure the number of times that it should match. By default is 1.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example http</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tomcat</span>:
  <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
  <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp]</span></span>
  <span class="key">await</span>:
    <span class="key">strategy</span>: <span class="string"><span class="content">http</span></span>
    <span class="key">match</span>: <span class="string"><span class="content">'Server startup' </span></span><i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key">responseCode</span>: <span class="string"><span class="content">201 </span></span><i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key">url</span>: <span class="string"><span class="content">http://dockerHost:8080 </span></span><i class="conum" data-value="3"></i><b>(3)</b>
    <span class="key">sleepPollingTime</span>: <span class="string"><span class="content">200 s </span></span><i class="conum" data-value="4"></i><b>(4)</b>
    <span class="key">iterations</span>: <span class="string"><span class="content">3 </span></span><i class="conum" data-value="5"></i><b>(5)</b>
    <span class="key">headers</span>:
        <span class="key">X-Cube</span>: <span class="string"><span class="content">Docker </span></span><i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Parameter to configure the pattern that signals the service returned correctly value. To use regular expression just prefix the pattern with <code>regexp:</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optional parameter to set which response http code is the expected one from service. Default is 200.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Mandatory parameter that sets the url where to connect. <code>dockerHost</code> is substituted by Cube to Docker Host.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Optional parameter to configure sleeping time between each call in case of fail. You can set in seconds using <em>s</em> or miliseconds using <em>ms</em>. By default, time unit is set to milliseconds, and value to 500.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Optional parameter to configure number of retries to be done. By default, 10 iterations are executed.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Optional parameter to check header&#8217;s value returned by service.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example docker_health</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tomcat</span>:
  <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
  <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp]</span></span>
  <span class="key">await</span>:
    <span class="key">strategy</span>: <span class="string"><span class="content">docker_health</span></span>
    <span class="key">iterations</span>: <span class="string"><span class="content">5 </span></span><i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key">sleepPollingTime</span>: <span class="string"><span class="content">200 s </span></span><i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key">command</span>: <span class="string"><span class="content">[&quot;curl&quot;, &quot;localhost:8089&quot;] </span></span><i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Optional parameter to configure number of retries to be done. By default 10 iterations are done.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optional parameter to configure sleeping time between each call in case of fail. You can set in seconds using <em>s</em> or miliseconds using <em>ms</em>. By default, time unit is set to milliseconds, and value is set to 500.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Optional parameter to configure a command line to execute inside the container instead of using the docker API to get container health.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Custom Await strategy:</p>
</div>
<div class="listingblock">
<div class="title">org.arquillian.cube.docker.impl.await.CustomAwaitStrategyImpl</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomAwaitStrategyImpl</span> <span class="directive">implements</span> AwaitStrategy {

  Await params;
  DockerClientExecutor dockerClientExecutor;
  Cube&lt;?&gt; cube;

  <span class="directive">public</span> <span class="type">void</span> setCube(Cube&lt;?&gt; cube) {
    <span class="local-variable">this</span>.cube = cube;
  }

  <span class="directive">public</span> <span class="type">void</span> setDockerClientExecutor(DockerClientExecutor dockerClientExecutor) {
    <span class="local-variable">this</span>.dockerClientExecutor = dockerClientExecutor;
  }

  <span class="directive">public</span> <span class="type">void</span> setParams(Await params) {
     <span class="local-variable">this</span>.params = params;
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> await() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.params != <span class="predefined-constant">null</span> &amp;&amp; <span class="local-variable">this</span>.dockerClientExecutor != <span class="predefined-constant">null</span> &amp;&amp; <span class="local-variable">this</span>.cube != <span class="predefined-constant">null</span>;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the configuration comes as:</p>
</div>
<div class="listingblock">
<div class="title">Example.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tomcat</span>:
  <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
  <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp]</span></span>
  <span class="key">await</span>:
    <span class="key">strategy</span>: <span class="string"><span class="content">org.arquillian.cube.docker.impl.await.CustomAwaitStrategyImpl</span></span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_healthcheck_annotation"><a class="anchor" href="#_healthcheck_annotation"></a>6.3.1. <code>@HealthCheck</code> annotation</h4>
<div class="paragraph">
<p>Sometimes default <code>await</code> strategy because when the service opens the port it does not mean that the service is up and running.
For example in case of Tomcat, exposed port is opened when the application is deployed so default strategy works perfectly, but in case of Wildfly the port is opened when the server is up and running but not when the application has been deployed.</p>
</div>
<div class="paragraph">
<p>To avoid this problem and continue using default <code>await</code> strategy you can annotate your test class with <code>@HealthCheck</code> annotation.</p>
</div>
<div class="paragraph">
<p>By annotating your test class with it, the following default parameters are used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">context: /
schema: http
port: <span class="integer">8080</span>
method: GET
containerName: <span class="predefined-constant">null</span>
responseCode: <span class="integer">200</span>
iterations: <span class="integer">40</span>
interval: <span class="integer">500</span>ms
timeout: <span class="integer">2</span>s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each of these attributes are configurable with custom values.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Time attributes like <code>timeout</code> and <code>interval</code> uses <code>docker-compose</code> durations approach of using timespan format such as <code>1m30s</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If <code>containerName</code> is set to null <code>port</code> attribute is used, otherwise <code>port</code> is considered an exposed port and it is resolved against the given container.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_sleep_annotation"><a class="anchor" href="#_sleep_annotation"></a>6.3.2. <code>@Sleep</code> annotation</h4>
<div class="paragraph">
<p>Sometimes you need to sleep your execution for some specific amount of time and you have no way to do it using an http health check.
In these situations, a sleep might do the work.</p>
</div>
<div class="paragraph">
<p>To avoid this problem and continue using default <code>await</code> strategy you can annotate your test class with <code>@Sleep</code> annotation which receives as value an string that represents a timespan.</p>
</div>
<div class="paragraph">
<p>By default, the time specified is in milliseconds so annotating the test class with <code>@Sleep("1000")</code> makes your test class sleeps 1 second before executing all test methods.
You can also use the timespan format and write something like <code>@Sleep("1m30s")</code> which makes your test class sleeps for one minute and a half before executing all test methods.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inferring_exposedports_from_portbinding"><a class="anchor" href="#_inferring_exposedports_from_portbinding"></a>6.4. Inferring exposedPorts from portBinding</h3>
<div class="paragraph">
<p>When you are using <em>Docker</em> you can set two different parameters, exposedPort and portBinding.
exposedPorts are ports that are available inside <em>Docker</em> infrastructure and they are used for communication between <em>Docker</em> containers but not from outside.
On the other side portBindings are a way to instruct <em>Docker</em> container to publish a port to be available from outside (for example from our test).</p>
</div>
<div class="paragraph">
<p>It seems reasonable that if you set a port binding this port should automatically be exposed port as well.
For this reason in <strong>Arquillian Cube</strong> you can use portBinding and it will automatically set to exposed port.</p>
</div>
<div class="paragraph">
<p>In next example we are only setting portBinding and <strong>Arquillian Cube</strong> will instruct <em>Docker</em> to expose port 8080 and of course bind the port 8080 so it can be accessible from outside.</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml (fragment)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">daytime</span>:
  <span class="key">buildImage</span>:
    <span class="key">dockerfileLocation</span>: <span class="string"><span class="content">src/test/resources/undertow</span></span>
    <span class="key">noCache</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">remove</span>: <span class="string"><span class="content">true</span></span>
  <span class="key">await</span>:
    <span class="key">strategy</span>: <span class="string"><span class="content">polling</span></span>
  <span class="key">portBindings</span>: <span class="string"><span class="content">[8080/tcp]</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Also it is not necessary to set the network protocol (tcp or udp).
If protocol is not specified <code>portBindings: ["8080"]</code> then <em>tcp</em> is used by default.
Notice that you need to add double-quotes to stringify the value.</p>
</div>
</div>
<div class="sect2">
<h3 id="_allow_connecting_to_a_running_container"><a class="anchor" href="#_allow_connecting_to_a_running_container"></a>6.5. Allow connecting to a running container</h3>
<div class="paragraph">
<p>With the configuration option connectionMode you can bypass
the Create/Start Cube commands if the a <em>Docker</em> Container with the same name is already
running on the target system. If so, <strong>Arquillian Cube</strong> will reuse that Container moving forward.</p>
</div>
<div class="paragraph">
<p>This allows you to prestart the containers manually during development and just
connect to them to avoid the extra cost of starting the <em>Docker</em> Containers for each test
run. This assumes you are not changing the actual definition of the <em>Docker</em> Container itself.</p>
</div>
<div class="paragraph">
<p>An example of this configuration could be:</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cube</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionMode</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>STARTORCONNECT<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/extension&gt;</span>

<span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">docker</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverVersion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>1.12<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverUri</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>http://localhost:2375<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dockerContainers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      tomcat:
        #more properties
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>connectionMode is an attribute that can receive three parameters:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">STARTANDSTOP</dt>
<dd>
<p>it is the default one if not set any and simply creates and stops all <em>Docker</em> Containers. If a container is already running, an exception is thrown.</p>
</dd>
<dt class="hdlist1">STARTORCONNECT</dt>
<dd>
<p>it tries to bypass the Create/Start Cube commands if a container with the same name is already running, and if it is the case doesn’t stop it at the end. But if container is not already running, Cube will start one and stop it at the end of the execution.</p>
</dd>
<dt class="hdlist1">STARTORCONNECTANDLEAVE</dt>
<dd>
<p>it is exactly the same of <em>STARTORCONNECT</em> but if container is started by Cube it won’t be stopped at the end of the execution so it can be reused in next executions.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_before_stop_events"><a class="anchor" href="#_before_stop_events"></a>6.6. Before Stop Events</h3>
<div class="paragraph">
<p>Sometimes when the tests have finished and container is stopped you want to inspect some data like container console or getting a file from the container to manual inspecting.
In these cases you can configure each container to copy console log or copy a file/s from container to local machine just before container is stopped.
Or if your need is more specific, you can provide a custom implementation</p>
</div>
<div class="paragraph">
<p>Next snippet shows how to copy a directory from container to local disk:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tomcat_default</span>:
  <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
  <span class="key">beforeStop</span>: <i class="conum" data-value="1"></i><b>(1)</b>
    - <span class="string"><span class="content">copy: </span><span class="content"><i class="conum" data-value="2"></i><b>(2)</b>
        from: /test
        to: /tmp</span></span>

    - <span class="string"><span class="content">log: </span><span class="content"><i class="conum" data-value="3"></i><b>(3)</b>
        to: /tmp/container.log</span></span>

    - <span class="string"><span class="content">customBeforeStopAction: </span><span class="content"><i class="conum" data-value="4"></i><b>(4)</b>
        strategy: &lt;fullyqualifiedclassname&gt;</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>beforeStop goes into the container section and may contain a list of copy and log elements.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>copy is used to notify that we want to copy some directories or files form from container location to to local location.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>log is used to notify that we want to copy container log to to local location.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>customBeforeStopAction is used to notify that we provide our own implementation of a stop action. There are
two rules to follow. The first is that the class must implement 'BeforeStopAction' and the second one is that the class must have a default constructor.
Optionally fields/setters for types 'DockerClientExecutor' and 'CubeId' for containerId can be used to inject them into
the custom beforeStop action</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In case of log command the standard output and the error output are returned.
log <em>Docker</em> command can receive some configuration paramters, and you can set them too in configuration file.</p>
</div>
<div class="listingblock">
<div class="title">Example of log parameters</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">beforeStop</span>:
  - <span class="string"><span class="content">log:</span></span>
    <span class="key">to</span>: <span class="string"><span class="content">/tmp/container.log</span></span>
    <span class="key">follow</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">stdout</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">stderr</span>: <span class="string"><span class="content">false</span></span>
    <span class="key">timestamps</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">tail</span>: <span class="string"><span class="content">10</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Custom BeforeStop action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.arquillian.cube.docker.impl.beforeStop</span>;

<span class="keyword">import</span> <span class="include">org.arquillian.cube.docker.impl.docker.DockerClientExecutor</span>;
<span class="keyword">import</span> <span class="include">org.arquillian.cube.impl.model.CubeId</span>;
<span class="keyword">import</span> <span class="include">org.arquillian.cube.spi.beforeStop.BeforeStopAction</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomBeforeStopActionImpl</span> <span class="directive">implements</span> BeforeStopAction {

    <span class="directive">private</span> DockerClientExecutor dockerClientExecutor;
    <span class="directive">private</span> CubeId containerID;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> doBeforeStop() {

    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the configuration comes as:</p>
</div>
<div class="listingblock">
<div class="title">Example.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">tomcat</span>:
  <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
  <span class="key">beforeStop</span>:
    - <span class="string"><span class="content">customBeforeStopAction:</span><span class="content">
        strategy: org.arquillian.cube.docker.impl.beforeStop.CustomBeforeStopActionImpl</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cubespecificproperties"><a class="anchor" href="#_cubespecificproperties"></a>6.7. CubeSpecificProperties</h3>
<div class="paragraph">
<p>In case you are using COMPOSE format, you cannot configure cube custom properties like <code>await</code> or <code>beforeStop</code>.
You can use a property called <code>cubeSpecificProperties</code> allows you to add them in already defined containers.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This property only overrides custom properties defined by CUBE format.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cubeSpecificProperties</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    tomcat:
      removeVolumes: true
      await:
        strategy: polling
      beforeStop:
        - copy:
            from: /test
            to: /tmp&quot;;
<span class="tag">&lt;/property&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Previous snippet would override <code>await</code> strategy to polling and set a <code>beforeStop</code> event in cube container named <code>tomcat</code> defined in a previous docker-compose definition.</p>
</div>
</div>
<div class="sect2">
<h3 id="automatic-resolution"><a class="anchor" href="#automatic-resolution"></a>6.8. Automatic serverUri resolution</h3>
<div class="paragraph">
<p>serverUri parameter is where you configure the Uri of <em>Docker</em> server.
This parameter is not mandatory and in case you don&#8217;t set it, <em>Arquillian Cube</em> will use next values:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unix:///var/run/docker.sock</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_containers"><a class="anchor" href="#_building_containers"></a>7. Building containers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To build a container <em>Docker</em> uses a file called <code>Dockerfile</code> <a href="https://docs.docker.com/reference/dockerfile/" class="bare">https://docs.docker.com/reference/dockerfile/</a>.
<strong>Arquillian Cube</strong> also supports building and running a container from a <code>Dockerfile</code>.</p>
</div>
<div class="paragraph">
<p>To set that <strong>Arquillian Cube</strong> must build the container, the <code>image</code> property must be changed to <code>buildImage</code> and add the location of <code>Dockerfile</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see previous example but instead of creating a container from a predefined image, we are going to build one:</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="error">&lt;property name=&quot;dockerContainers&quot;&gt;</span>
  <span class="key">tomcat</span>:
    <span class="key">buildImage</span>: <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key">dockerfileLocation</span>: <span class="string"><span class="content">src/test/resources/tomcat </span></span><i class="conum" data-value="2"></i><b>(2)</b>
      <span class="key">noCache</span>: <span class="string"><span class="content">true </span></span><i class="conum" data-value="3"></i><b>(3)</b>
      <span class="key">remove</span>: <span class="string"><span class="content">true </span></span><i class="conum" data-value="4"></i><b>(4)</b>
      <span class="key">dockerfileName</span>: <span class="string"><span class="content">my-dockerfile </span></span><i class="conum" data-value="5"></i><b>(5)</b>
    <span class="key">await</span>:
      <span class="key">strategy</span>: <span class="string"><span class="content">polling</span></span>
    <span class="key">env</span>: <span class="string"><span class="content">[JAVA_OPTS=-Dcom.sun.management.jmxremote.port=8089 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false]</span></span>
    <span class="key">portBindings</span>: <span class="string"><span class="content">[8089/tcp, 8080/tcp]</span></span>
<span class="error">&lt;/property&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>buildImage</code> section is used in front of <code>image</code>. In case of both sections present in a document, <code>image</code> section has preference over <code>buildImage</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>dockerfileLocation</code> contains the location of <code>Dockerfile</code> and all files required to build the container.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Property to enable or disable the no cache attribute.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Property to enable or disable the remove attribute.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Property to set the dockerfile name to be used instead of the default ones.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>dockerfileLocation</code> can be a directory that must contains <code>Dockerfile</code> in root directory (in case you don&#8217;t set <em>dockerfileName</em> property), also a tar.gz file or a <em>URL</em> pointing to a tar.gz file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An example of <code>Dockerfile</code> is:</p>
</div>
<div class="listingblock">
<div class="title">src/test/resources/tomcat/Dockerfile</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">FROM tomcat:10.1.30

ENV JAVA_OPTS -Dcom.sun.management.jmxremote.port=8089 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false
ADD tomcat-users.xml /tomcat/conf/ <i class="conum" data-value="1"></i><b>(1)</b>
EXPOSE 8089
CMD [&quot;/tomcat/bin/catalina.sh&quot;,&quot;run&quot;]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>tomcat-users.xml file is located at same directory as <code>Dockerfile</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="docker-compose-format"><a class="anchor" href="#docker-compose-format"></a>8. Docker-Compose Format</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead of using Arquillian Cube format, you can use <a href="https://docs.docker.com/reference/compose-file/">Docker Compose V2 format</a>
to define containers layout.
This means that you can use the same Docker Compose file for running your tests with Arquillian Cube, and without any
change run <code>docker-compose up</code> command from terminal and get the same result.</p>
</div>
<div class="paragraph">
<p>It is important to note that this is not a docker-compose implementation but only the docker-compose format.
This means that for example you cannot execute some CLI commands of <em>docker-compose</em>, like to start several instances of same service.</p>
</div>
<div class="paragraph">
<p>Another limitation is that some specific Arquillian Cube attributes, like await strategy, cannot be configured and the
default values are used.</p>
</div>
<div class="paragraph">
<p>Moreover, there are some docker-compose commands that are not implemented yet due to restrictions on docker-java library.
These commands are  <em>pid</em>, <em>log_driver</em> and <em>security_opt</em>.
But they will be implemented as soon as docker-java library adds their support.</p>
</div>
<div class="paragraph">
<p>Last thing, in case you define a command that is not implemented in Arquillian Cube, this command will be ignored
(no exception will be thrown), but a log line will be printed notifying this situation.
Please it is really important that if this happens you open a bug, so we can add support for them.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see how you can rewrite previous HelloWorld example with Tomcat, using docker-compose format.</p>
</div>
<div class="paragraph">
<p>First let&#8217;s create a file called <code>envs</code> on root of the project which configures environment variables:</p>
</div>
<div class="listingblock">
<div class="title">envs</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TOMCAT_PASS=mypass
JAVA_OPTS=-Djava.rmi.server.hostname=dockerServerIp -Dcom.sun.management.jmxremote.rmi.port=<span class="integer">8088</span> -Dcom.sun.management.jmxremote.port=<span class="integer">8089</span> -Dcom.sun.management.jmxremote.ssl=<span class="predefined-constant">false</span> -Dcom.sun.management.jmxremote.authenticate=<span class="predefined-constant">false</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You can use <code>dockerServerIp</code> as special tag for identify the docker host IP. Before injecting the environement variables, Cube will change it to real host IP.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then you can create a file called <code>docker-compose.yml</code> following docker-compose commands on root of the project:</p>
</div>
<div class="listingblock">
<div class="title">docker-compose.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">tomcat</span>:
  <span class="key">env_file</span>: <span class="string"><span class="content">envs</span></span>
  <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
  <span class="key">ports</span>:
      - <span class="string"><span class="delimiter">&quot;</span><span class="content">8089:8089</span><span class="delimiter">&quot;</span></span>
      - <span class="string"><span class="delimiter">&quot;</span><span class="content">8088:8088</span><span class="delimiter">&quot;</span></span>
      - <span class="string"><span class="delimiter">&quot;</span><span class="content">8081:8080</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and finally you can configure in <code>arquillian.xml</code> file that you want to use docker-compose format.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In case you use <a href="https://docs.docker.com/compose/compose-file/#context">context</a> with a GIT repository, you should add the following dependency <code>org.eclipse.jgit:org.eclipse.jgit:${jgit.version}</code>.
Due of library conflicts between <code>docker-java</code> and <code>jgit</code>, that they are sharing common libraries but different unsupported versions, you need to exclude and include some of them.</p>
</div>
<div class="paragraph">
<p>For example in case of using Maven, your <code>pom.xml</code> should look like:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.eclipse.jgit<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>org.eclipse.jgit<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
  <span class="tag">&lt;exclusions&gt;</span>
    <span class="tag">&lt;exclusion&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>httpclient<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;/exclusion&gt;</span>
  <span class="tag">&lt;/exclusions&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.slf4j<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>slf4j-api<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.slf4j<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>slf4j-simple<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">src/test/resources/arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">docker</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverVersion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>1.13<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverUri</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>localhost<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dockerContainersFile</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>docker-compose.yml<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/extension&gt;</span>

<span class="tag">&lt;container</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tomcat</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>admin<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pass</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>mypass<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/container&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that you don&#8217;t need to specify <em>definitionFormat</em> since docker compose format is the default one.</p>
</div>
<div class="paragraph">
<p>And that&#8217;s all, you can now reuse your existing docker-compose files in Arquillian Cube too.
You can see the full example at: <a href="https://github.com/arquillian/arquillian-cube/tree/main/docker/ftest-docker-compose-v2" class="bare">https://github.com/arquillian/arquillian-cube/tree/main/docker/ftest-docker-compose-v2</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enrichers"><a class="anchor" href="#_enrichers"></a>9. Enrichers</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Arquillian Cube</strong> comes with a few enrichers.</p>
</div>
<div class="paragraph">
<p>One for injecting the CubeID(<em>containerId</em>) of the current container created for executing the test, one that injects the CubeController to call lifecycle methods on any cube and one that injects com.github.dockerjava.api.DockerClient instance used to communicate with <em>Docker</em> server. Also you can inject in your tests the <em>Docker Host IP</em> used for running containers by using @HostIp annotation.</p>
</div>
<div class="paragraph">
<p>DockerClient, Docker Host IP, Docker Host Port and Cube Ip injection only work if the tests are run in client mode, that is by using @RunAsClient or by setting the testable property to false @Deployment(testable = false).
Also they work if you run Arquillian in standalone mode.</p>
</div>
<div class="paragraph">
<p>These can be injected using the @ArquillianResource annotation.</p>
</div>
<div class="paragraph">
<p>As examples:</p>
</div>
<div class="listingblock">
<div class="title">CubeIDResourceProvider.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ArquillianResource</span>
CubeID containerId;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">CubeResourceProvider.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ArquillianResource</span>
DockerClient dockerClient;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">CubeControllerProvider.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ArquillianResource</span>
CubeController cubeController;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">DockerHostProvider.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@HostIp</span>
<span class="predefined-type">String</span> ip;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">DockerHostPortProvider.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@HostPort</span>(containerName = <span class="string"><span class="delimiter">&quot;</span><span class="content">tomcat</span><span class="delimiter">&quot;</span></span>, value = <span class="integer">8080</span>)
<span class="type">int</span> tomcatPort; <span class="comment">// gets the binding port for exposed port 8080 of container tomcat.</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">CubeIpProvider.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CubeIp</span>(containerName = <span class="string"><span class="delimiter">&quot;</span><span class="content">tomcat</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">String</span> ip;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When running Arquillian Cube with Standalone you can enrich the test with URL.</p>
</div>
<div class="listingblock">
<div class="title">DockerUrlProvider.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DockerUrl</span>(containerName = <span class="string"><span class="delimiter">&quot;</span><span class="content">pingpong</span><span class="delimiter">&quot;</span></span>, exposedPort = <span class="integer">8080</span>) <span class="comment">// resolves bind port</span>
<span class="annotation">@ArquillianResource</span>
<span class="directive">private</span> <span class="predefined-type">URL</span> url;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When running Arquillian Cube against a OpenShift&#8217;s pod you can retrieve the route to the pod&#8217;s service just by using the example code below:</p>
</div>
<div class="listingblock">
<div class="title">RouterURLEnricher.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RouteURL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">app-name</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">URL</span> url;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This annotation also has a <code>path</code> parameter which can change the path part of the injected URL.</p>
</div>
<div class="paragraph">
<p>Furthermore, the annotation also provides the <code>namespace</code> parameter which can be used when a test needs the URL of a Route
that exists in a namespace other than the namespace the test uses (which is the default behavior when no value is provided to <code>namespace</code>).</p>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="title">RouterURLEnricher.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@RouteURL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${route.name}</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@AwaitRoute</span>
    <span class="directive">private</span> <span class="predefined-type">URL</span> url;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use an additional annotation <code>@AwaitRoute</code> to wait until the route becomes available.
That is, it responds with a known good HTTP status code in given timeout.</p>
</div>
<div class="paragraph">
<p>To resolve expression <code>"${route.name}"</code>, it looks in hierarchy of <code>system property</code> &#8594; <code>environment variable</code> &#8594; <code>properties defined in arquillian.xml</code>.</p>
</div>
<div class="paragraph">
<p>If the route is not resolvable, you need to set the <code>routerHost</code> setting to the IP address of the OpenShift router.
You can configure it in arquillian.xml:</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> <span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">openshift</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ....
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">routerHost</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>192.168.10.10<span class="tag">&lt;/property&gt;</span>
    ...
 <span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or just by setting the system property <code>openshift.router.host</code>.
To obtain the router address from your OpenShift instance you can execute the command below:
<code>oc describe svc/router</code>
And look for the Endpoints field.</p>
</div>
<div class="paragraph">
<p>URL will be <code><a href="http://&lt;docker_host&gt;:&lt;bind_port&gt;/" class="bare">http://&lt;docker_host&gt;:&lt;bind_port&gt;/</a></code></p>
</div>
<div class="sect2">
<h3 id="_docker_inside_docker_docker_on_docker"><a class="anchor" href="#_docker_inside_docker_docker_on_docker"></a>9.1. Docker Inside Docker / Docker On Docker</h3>
<div class="paragraph">
<p>If you are running your tests on your continuous integration/delivery server (for example on Jenkins or GitLab runners) and at the same time the server is running inside Docker. Then the docker containers started for Cube are run inside a Docker container.
So you effectively face the Docker inside Docker problem - DockerHost is <strong>not</strong> the machine where your test is running.</p>
</div>
<div class="paragraph">
<p>From Arquillian Cube perspective we cannot do a lot of things, more than adapting to this situation by changing the <code>serverUri</code>.
Basically it ignores any <code>SERVER_URI</code>, properties and sets the <code>serverUri</code> to <code>unix:///var/run/docker.sock</code>.</p>
</div>
<div class="paragraph">
<p>You can avoid this behaviour by setting <code>dockerInsideDockerResolution</code> to false.</p>
</div>
<div class="paragraph">
<p>INFO: In this case almost all work should be done in infrastructure level by configuring correctly Docker instances. For this reason it is important that before running Cube tests, you test manually your infrastructure to be sure that everything is connected as expected.</p>
</div>
<div class="paragraph">
<p>In next sections, some minor information is provided on how to run Docker inside/on Docker. Keep in mind that you need to configure continuous integration/delivery correctly.</p>
</div>
<div class="sect3">
<h4 id="_docker_inside_docker"><a class="anchor" href="#_docker_inside_docker"></a>9.1.1. Docker Inside Docker</h4>
<div class="paragraph">
<p>You can find more information about Docker Inside Docker at: <a href="https://github.com/jpetazzo/dind" class="bare">https://github.com/jpetazzo/dind</a></p>
</div>
<div class="paragraph">
<p>Also if you are using Jenkins you can use next Jenkins Slave. <code>kmadel/dind-jenkins-slave:1.4</code> running with <code>privileged</code> flag.</p>
</div>
</div>
<div class="sect3">
<h4 id="_docker_on_docker"><a class="anchor" href="#_docker_on_docker"></a>9.1.2. Docker On Docker</h4>
<div class="paragraph">
<p>If instead of running Docker inside Docker, you want to use the Docker instance/host of the "parent" Docker, you can map as volume the Docker CLI, Docker socket and <code>apparmor</code> library from parent to child container.</p>
</div>
<div class="paragraph">
<p><code>-v /var/run/docker.sock:/var/run/docker.sock -v /usr/bin/docker:/usr/bin/docker -v /usr/lib/x86_64-linux-gnu/libapparmor.so.1.1.0:/usr/lib/x86_64-linux-gnu/libapparmor.so.1</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cubecontroller"><a class="anchor" href="#_cubecontroller"></a>9.2. CubeController</h3>
<div class="paragraph">
<p><code>CubeController</code> is facade class that let&#8217;s you interact with any cube container.
 It offers some operations like creating and destroying <em>Cubes</em> (in case of Docker, it is Docker containers), copy a directory to local directory, get a log with all the changes that happened to Cube filesystem, execute a <code>Top</code> command or copy the logs to local file.</p>
</div>
<div class="paragraph">
<p>Suppose you have next Docker Container definition in <code>dockerContainers</code> property:</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dockerContainers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    manual_database:
        image: oscarfonts/h2:2.1.214
        portBindings: [1521/tcp, 8181-<span class="error">&gt;</span>81/tcp]
<span class="tag">&lt;/property&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you enrich your test with <code>CubeController</code> then you will be able to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>call <code>cubeController.create("manual_database")</code> to create the Cube defined in <code>dockerContainers</code> with name <em>manual_database</em>.</p>
</li>
<li>
<p>call <code>cubeController.start("manual_database")</code> to start the given Cube.</p>
</li>
<li>
<p>call <code>cubeController.stop("manual_database")</code> to stop the given Cube.</p>
</li>
<li>
<p>call <code>cubeController.destroy("manual_database")</code> to destroy the given Cube.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But also it offers some extra operations not related with the lifecycle of a Cube.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cubeController.copyFileDirectoryFromContainer("manual_database", "/db", newFolder.getAbsolutePath())</code> to copy content from container folder <code>/db</code> to <code>newFolder</code> local location.</p>
</li>
<li>
<p><code>List&lt;ChangeLog&gt; changesOnFilesystem = cubeController.changesOnFilesystem("manual_database")</code> to returns a log with all changes that has occurred inside given Cube.</p>
</li>
<li>
<p><code>TopContainer top = cubeController.top("manual_testing")</code> to get the result of executing <code>top</code> command inside Cube.</p>
</li>
<li>
<p><code>cubeController.copyLog("manual_testing", follow, stdout, stderr, timestamp, tail, byteArrayOutputStream)</code> to copy Cube log to given <code>outputStream</code>. This operation only works in Client mode.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_auto_starting_cubes_outside_of_arquillian_containers"><a class="anchor" href="#_auto_starting_cubes_outside_of_arquillian_containers"></a>9.3. Auto starting Cubes outside of Arquillian Containers</h3>
<div class="paragraph">
<p>Probably any application you may write will need an application/servlet container but also other servers like database server or mail server.
Each one will be placed on one <em>Docker Container</em>.
So for example a full application may contain one <em>Docker Container</em> with an application server (for example <em>Wildfly</em>) and another container with a database (for example <em>H2</em>).</p>
</div>
<div class="paragraph">
<p><strong>Arquillian Cube</strong> can orchestrate these containers as well.</p>
</div>
<div class="paragraph">
<p>An example of orchestration can be:</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dockerContainers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  wildfly_database:
    extends: wildfly
    links:
      - database:database <i class="conum" data-value="1"></i><b>(1)</b>
  database:
    image: oscarfonts/h2:2.1.214
    exposedPorts: [81/tcp, 1521/tcp]
    await:
      strategy: polling
    portBindings: [1521/tcp, 8181-<span class="error">&gt;</span>81/tcp]
  <span class="tag">&lt;/property&gt;</span>

<span class="tag">&lt;container</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">wildfly_database</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">target</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>wildfly:33.0.2.Final-jdk11:remote<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>admin<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Admin#70365<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/container&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We use <em>link</em> property to connect <em>Wildfly</em> container to <em>database</em> container.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case when a test is started both containers are started and when both are ready to receive requests, the test will be executed.</p>
</div>
<div class="paragraph">
<p>And the database definition shall be:</p>
</div>
<div class="listingblock">
<div class="title">UserRepository.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DataSourceDefinition</span>(
  name = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/TestDataSource</span><span class="delimiter">&quot;</span></span>,
  className = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.h2.jdbcx.JdbcDataSource</span><span class="delimiter">&quot;</span></span>,
  url = <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:tcp://database:1521/opt/h2-data/test</span><span class="delimiter">&quot;</span></span>,
  user = <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>,
  password = <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>
)
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">UserRepository</span> {

    <span class="annotation">@PersistenceContext</span>
    <span class="directive">private</span> EntityManager em;

    <span class="directive">public</span> <span class="type">void</span> store(User user) {
        em.persist(user);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cube will normally start a Docker container when it has the same name as an active Arquillian container and <strong>all</strong> the <em>links</em> from this container to another containers as we have seen in previous example. Basically Cube resolves all the container depdendencies as well e.g. a database where the application saves data, or mail server where application sends an email.</p>
</div>
<div class="paragraph">
<p>That works for things that are DeployableContainer&#8217;s. For any other container services that might not have a link to the DeployableContainer, e.g. a monitor, you can use the <code>autoStartContainers</code> option to define which Docker containers to automatically start up.
The option takes a comma separated list of Docker container ids. e.g. monitor.
Arquillian Cube will attempt to start the containers in parallel if possible as well as start any linked containers.
Also if you need to start several images, instead of adding them as CSV, you can use a regular expression by prefixing with <code>regexp:</code>, for example setting the property to <code>regexp:a(.*)</code> would start all container ids starting with a.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">docker</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">autoStartContainers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>regexp:a(.*)<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Also you can provide your own implementation of autostart containers.
To make it so, first you need to implement <code>org.arquillian.cube.spi.AutoStartParser</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ChangeNameAutoStartParser</span> <span class="directive">implements</span> AutoStartParser { <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Inject</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> Instance&lt;CubeDockerConfiguration&gt; cubeDockerConfigurationInstance;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, Node&gt; parse() { <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="directive">final</span> DockerCompositions dockerContainersContent = cubeDockerConfigurationInstance.get().getDockerContainersContent();

        <span class="directive">final</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, Node&gt; nodes = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
        <span class="directive">final</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; containersNames = <span class="keyword">new</span> <span class="predefined-type">TreeSet</span>&lt;&gt;(dockerContainersContent.getContainers().keySet());

        <span class="keyword">for</span> (<span class="predefined-type">String</span> name : containersNames) {
            nodes.put(<span class="keyword">new</span> <span class="predefined-type">StringBuilder</span>(name).reverse().toString(), Node.from(name));
        }

        <span class="keyword">return</span> nodes;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Need to implement AutoStartParser interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can Inject any element produced by Arquillian such as CubeDockerConfiguration or ContainerRegistry</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Returns a map with the name of the map and id.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then you need to use reserved word <code>custom:</code> + full qualified class name in the <code>autoStartContainers</code> property.</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">docker</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">autoStartContainers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>custom:org.arquillian.cube.docker.impl.client.ChangeNameAutoStartParser<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_auto_remapping"><a class="anchor" href="#_auto_remapping"></a>9.4. Auto-Remapping</h3>
<div class="paragraph">
<p><strong>Arquillian Cube</strong> can automatically configure default ports of container in case of port forwarding.</p>
</div>
<div class="paragraph">
<p>What <strong>Arquillian Cube</strong> does internally is remapping default <code>DeployableContainer</code> port values to the ones configured in <em>Docker Containers</em> configuration.</p>
</div>
<div class="paragraph">
<p>Suppose you have a <em>Docker Container</em> configuration like:</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dockerContainers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    tomcat_default:
      image: tomcat:10.1.30
      exposedPorts: [8089/tcp]
      await:
        strategy: polling
      env: [TOMCAT_PASS=mypass, JAVA_OPTS=-Dcom.sun.management.jmxremote.port=8089 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false]
      portBindings: [8089/tcp, 8081-<span class="error">&gt;</span>8080/tcp] <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tag">&lt;/property&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note that the exposed port is the 8081.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then in theory you should configure the remote <em>Tomcat</em> adapter to port 8081 on your <em>arquillian.xml</em> file.
But let&#8217;s say that you are using that remote adapter for a remote local <em>Tomcat</em> (outside <em>Docker</em>) too, and is configured to use 8080 port.</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;container</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tomcat_default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  configuration<span class="error">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>localhost<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>admin<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pass</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>mypass<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/container&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which basically uses default port (8080) to connect to remote server.</p>
</div>
<div class="paragraph">
<p>In this case you don&#8217;t need to create a new <code>container</code> tag, <strong>Arquillian Cube</strong> is smart enough to change the default port value automatically; in case of <em>Tomcat</em> 8080 to 8081.
<strong>Arquillan Cube</strong> will apply autoremapping to all properties that contains <code>port</code> as a substring of the property, and will remap if it is necessary.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Automapping only works in case you want to change the default server port to a <em>Docker</em> port forwarded port.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_dockerserverip_and_containers"><a class="anchor" href="#_dockerserverip_and_containers"></a>9.5. DockerServerIp and Containers</h3>
<div class="paragraph">
<p>If you are using a remote docker server (not on <em>localhost</em>) you may want to set that ip to Arquillian remote adapter configuration so it can deploy the archive under test.
In these cases you can hardcode this ip to Arquillian container adapter configuration or you can use the special tag dockerServerIp.
At runtime these tag will be replaced by <em>Arquillian Cube</em> to docker server ip configured in serverUri parameter.
This replacement only works in properties that contains the string host or address in property name.</p>
</div>
<div class="paragraph">
<p>So for example:</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">docker</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverUri</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>http://192.168.0.2:2756<span class="tag">&lt;/property&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
  ...
<span class="tag">&lt;/extension&gt;</span>
<span class="tag">&lt;container</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tomcat_default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  configuration<span class="error">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>dockerServerIp<span class="tag">&lt;/property&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>admin<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pass</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>mypass<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/container&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We set the serverUri as usually.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>dockerServerIp is replaced at runtime.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The host property will be replaced automatically to 192.168.0.2.</p>
</div>
<div class="paragraph">
<p>In case of using <em>unix</em> socket dockerServerUri is replaced by <em>localhost</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_system_properties_injection"><a class="anchor" href="#_system_properties_injection"></a>9.6. System Properties Injection</h3>
<div class="paragraph">
<p>Arquillian Cube sets some system properties to be used in tests in case you cannot use enrichers (i.e in case of JUnit rules).
These system properties are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>arq.cube.docker.host</code> with Docker Host host.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For each container started:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>arq.cube.docker.&lt;cubeid&gt;.ip</code> with container ip.</p>
</li>
<li>
<p><code>arq.cube.docker.&lt;cubeid&gt;.internal.ip</code> with container internal ip.</p>
</li>
<li>
<p><code>arq.cube.docker.&lt;cubeid&gt;.port.&lt;exposedport&gt;</code> with binding port of giving exposed port.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_parallel_execution"><a class="anchor" href="#_parallel_execution"></a>10. Parallel Execution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes using any Maven/Gradle/Jenkins plugin you end up by executing tests in parallel.
This means that the same <code>docker-compose</code> file is executed for all tests.
The problem is that probably <em>docker host</em> is the same, too.
So when you start the second test (in parallel) you will get a failure regarding that a container with same name is
already started in that docker host.</p>
</div>
<div class="paragraph">
<p>In this situation you can do two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can have one <em>docker host</em> for each parallel test and override <code>serverUri</code> property at each case, using system
property (arq.extension.docker.serverUri).</p>
</li>
<li>
<p>You can reuse the same <em>docker host</em> and use <em>star operator</em>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_star_operator"><a class="anchor" href="#_star_operator"></a>10.1. Star Operator</h3>
<div class="paragraph">
<p>Star operator lets you indicate to Arquillian Cube that you want to generate <strong>cube</strong> names randomly and adapt links as well.
In this way when you execute your tests in parallel there will be no conflicts because of names or binding ports.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see an example:</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="error">&lt;property name=&quot;dockerContainers&quot;&gt;</span>
    <span class="key">tomcat*</span>:
      <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
      <span class="key">portBindings</span>: <span class="string"><span class="content">[8080/tcp]</span></span>
      <span class="key">links</span>:
        - <span class="string"><span class="content">ping*</span></span>
    <span class="key">ping*</span>:
      <span class="key">image</span>: <span class="string"><span class="content">tsongpon/pingpong</span></span>
      <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp]</span></span>
    <span class="key">pong*</span>:
      <span class="key">image</span>: <span class="string"><span class="content">tsongpon/pingpong</span></span>
      <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp]</span></span>
      <span class="key">depends_on</span>:
        - <span class="string"><span class="delimiter">&quot;</span><span class="content">ping*</span><span class="delimiter">&quot;</span></span>
<span class="error">&lt;/property&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You add the special character <code><strong></code> to indicate that *cube</strong> name should be randomized.</p>
</div>
<div class="paragraph">
<p>With previous example Cube will:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate a unique <em>UUID</em>.</p>
</li>
<li>
<p>Substitute <strong>cube</strong> name, links and depends_on using the name + UUID</p>
</li>
<li>
<p>In case of using an alias, don&#8217;t add the <code>*</code> since it is extended from the service name</p>
</li>
<li>
<p>Bind port is going to be changed to a random private port (49152 - 65535)</p>
</li>
<li>
<p>Add an environment variable with new hostname. This environment variable is &lt;name&gt;_HOSTNAME</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>So for example the resulting file could look like this:</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="error">&lt;property name=&quot;dockerContainers&quot;&gt;</span>
    <span class="key">tomcat_123456</span>:
      <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
      <span class="key">portBindings</span>: <span class="string"><span class="content">[54678 -&gt; 8080/tcp]</span></span>
      <span class="key">env</span>: <span class="string"><span class="content">[ping_HOSTNAME=ping_123456]</span></span>
      <span class="key">links</span>:
        - <span class="string"><span class="content">ping_123456</span></span>
    <span class="key">ping_123456</span>:
      <span class="key">image</span>: <span class="string"><span class="content">tsongpon/pingpong</span></span>
      <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp]</span></span>
    <span class="key">pong_123456</span>:
      <span class="key">image</span>: <span class="string"><span class="content">tsongpon/pingpong</span></span>
      <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp]</span></span>
      <span class="key">depends_on</span>:
        - <span class="string"><span class="delimiter">&quot;</span><span class="content">ping_123456</span><span class="delimiter">&quot;</span></span>
<span class="error">&lt;/property&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since now the ports are unique and names are unique, you can run tests using the same orchestration in parallel against
the same docker host.</p>
</div>
<div class="paragraph">
<p>The same approach can work for ensuring that each test run has a unique network. As docker allows multiple networks to
have the same name, it will not throw an error if two concurrent tests create networks with the same name.
However, as <strong>cube</strong> networks are specified by name in the cube specification, if there are multiple networks with the
same name, the <strong>cube</strong> could end up in any one of them, resulting in hard-to-debug test failures.</p>
</div>
<div class="paragraph">
<p>Again, adding the special character <code><strong></code> to the end of the network name will cause a random network name to be used.
The name can then be used for a *cube</strong>'s networkMode or in the <strong>cube</strong>'s network list, and it will be substituted
correctly when the test runs.</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="error">&lt;property name=&quot;dockerContainers&quot;&gt;</span>
    <span class="key">networks</span>:
      <span class="key">testnetwork*</span>:
        <span class="key">driver</span>: <span class="string"><span class="content">bridge</span></span>
    <span class="key">tomcat*</span>:
      <span class="key">image</span>: <span class="string"><span class="content">tomcat:10.1.30</span></span>
      <span class="key">portBindings</span>: <span class="string"><span class="content">[8080/tcp]</span></span>
      <span class="key">networkMode</span>: <span class="string"><span class="content">testnetwork*</span></span>
    <span class="key">ping*</span>:
      <span class="key">image</span>: <span class="string"><span class="content">tsongpon/pingpong</span></span>
      <span class="key">exposedPorts</span>: <span class="string"><span class="content">[8089/tcp]</span></span>
      <span class="key">networks</span>:
        - <span class="string"><span class="content">testnetwork*</span></span>
<span class="error">&lt;/property&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can use the same approach for <em>docker-compose</em> files, not only with <em>CUBE</em> format.
But then your <em>docker-compose</em> will be tight to Arquillian Cube.
The best approach if you want to use docker-compose format is using <code>extends</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Star operator can also be used on enrichers, for example:
<code>@HostPort(containerName = "tomcat*", value = 8080)</code> or
<code>@DockerUrl(containerName = "tomcat*", exposedPort = 8080)</code>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_container_object_pattern"><a class="anchor" href="#_container_object_pattern"></a>11. Container Object pattern</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you search for a description of what <strong>Page Object</strong> is, you&#8217;ll find that it describes a pattern that allows you to model content in a reusable and maintainable way.
The description also points that within your web app&#8217;s UI, there are areas that your tests interact with, and a Page Object simply models those areas as objects within the test code.
Using the Page Object pattern reduces the amount of duplicated code. If the UI changes, only the Page Object will need to be updated for the test cases to run.</p>
</div>
<div class="paragraph">
<p>As you can see, the Page Object pattern applies to UI elements. We (the Arquillian community) have coined a new pattern following Page Object that we call the <strong>Container Object</strong> pattern.
You can think of a Container Object as a mechanism to encapsulate areas (data and actions) related to a container (for now only Docker containers) that your test might interact with.
For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the host IP where the container is running</p>
</li>
<li>
<p>the bounded port for a given exposed port</p>
</li>
<li>
<p>any parameter configured inside the configuration file (Dockerfile), like a user or password to access the service running in the container.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if running a MySQL database in a container, it could be the user and password to access the database.
Notice that nothing prevents you from generating the correct URL to access the service directly from your test, or executing commands against the container, for example retrieving an internal file.</p>
</div>
<div class="paragraph">
<p>As is the case with Page Objects, the Container Object pattern gives you a mechanism to build a model that can be reused on several projects.</p>
</div>
<div class="paragraph">
<p>Before looking at how this pattern is implemented in Cube, let&#8217;s go through an example:</p>
</div>
<div class="paragraph">
<p>Suppose all your applications need to send a file to an FTP server.
To write an integration/component test for your apps, you might need an FTP server to send the file to, and then check that the file was correctly sent.
One way to implement such test is (i) by using Docker to start an FTP server just before executing the test, then (ii) execute the test using this docker container as the receiving FTP server, (iii) before stopping the container check that the file is present, and finally (iv) stop and destroy the container.</p>
</div>
<div class="paragraph">
<p>All these operations that involve the FTP server and container could be encapsulated inside a Container Object.
This container object might contain the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>which image is used</p>
</li>
<li>
<p>IP and port bound to the host where the FTP server is running</p>
</li>
<li>
<p>user and password required to access the FTP server</p>
</li>
<li>
<p>methods for asserting the existence of a file inside the container</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Test code will only interact with this object instead of directly hard coding all required information inside the test.
Again, as in the Page Object pattern, any change on the container only affects the Container Object and not the test itself.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s see how <em>Arquillian Cube</em> implements the Container Object pattern.</p>
</div>
<div class="sect2">
<h3 id="_arquillian_cube_and_container_object"><a class="anchor" href="#_arquillian_cube_and_container_object"></a>11.1. Arquillian Cube and Container Object</h3>
<div class="paragraph">
<p>Let&#8217;s see a simple example of how you can implement a Container Object in <em>Cube</em>.
Suppose you want to create a container object that encapsulates a ping pong server running inside Docker.
The Container Object will be a simple POJO with special annotations:</p>
</div>
<div class="listingblock">
<div class="title">PingPongContainer.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.superbiz.containerobject</span>;

<span class="annotation">@Cube</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">pingpong</span><span class="delimiter">&quot;</span></span>, portBinding = <span class="string"><span class="delimiter">&quot;</span><span class="content">5432-&gt;8080/tcp</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@CubeDockerFile</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PingPongContainer</span> {

  <span class="annotation">@HostIp</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="predefined-type">String</span> dockerHost;

  <span class="annotation">@HostPort</span>(<span class="integer">8080</span>)
  <span class="directive">private</span> <span class="type">int</span> port;

  <span class="directive">public</span> <span class="predefined-type">URL</span> getConnectionUrl() { <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="keyword">try</span> {
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://</span><span class="delimiter">&quot;</span></span> + dockerHost + <span class="string"><span class="delimiter">&quot;</span><span class="content">:</span><span class="delimiter">&quot;</span></span> + port);
          } <span class="keyword">catch</span> (<span class="exception">MalformedURLException</span> e) {
                  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(e);
          }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Cube</code> annotation configures the Container Object</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A Container Object can be enriched with Arquillian enrichers</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The Container Object hides how to connect to the PingPong server</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>@Cube</code> annotation is used to configure a Container Object.
Its <code>value</code> property is used to specify how the started container will be named (in this example <code>pingpong</code>) while the <code>portBinding</code> property can be used to specify the port binding information for the container instance (in this case <code>5432&#8594;8080/tcp</code>).
Notice that <code>portBinding</code> can also accept an array, in which case more than one port binding definitions can be specified.</p>
</div>
<div class="paragraph">
<p>The next annotation is <code>@CubeDockerFile</code>, which configures how the container is created.
This example will use a Dockerfile located at the default class path location.
As the default location is the <em>package+classname</em>, in our example the <code>Dockerfile</code> should be placed at <code>org/superbiz/containerobject/PingPongContainer</code>.
It is possible to set any other class path location by passing it as the <code>value</code> property of the <code>@CubeDockerFile</code> annotation.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>@CubeDockerFile</code> annotation defines the <em>location</em> where the <code>Dockerfile</code> is found, not the file itself.
This location must be reachable from the ClassLoader creating the container object, which means it should be on the class path for the class loader to be able to find it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Any Cube can be enriched with any client side enricher. In the previous example a <code>@HostIp</code> enricher is used, but it could be enriched similarly with <code>@CubeIp</code> (which works similar to <code>@HostPort</code>), or a <code>DockerClient</code> instance if the field is annotated with <code>@ArquillianResource</code>.</p>
</div>
<div class="paragraph">
<p>Finally the <code>@HostPort</code> is used to translate the exposed port to the bound port.
In this example the port value will be 5432. Later you will learn briefly why this annotation is important.</p>
</div>
<div class="paragraph">
<p>After creating the container object, you can start using it in your test:</p>
</div>
<div class="listingblock">
<div class="title">PingPongTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Arquillian.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">PingPongTest</span> {

    <span class="annotation">@Cube</span>
    PingPongContainer pingPongContainer;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> shouldReturnOkAsPong() <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="predefined-type">String</span> pong = ping();
        assertThat(pong, containsString(<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span>));
        assertThat(pingPongContainer.getConnectionPort(), is(<span class="integer">5432</span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most important step in that test example is setting the Container Object as a field of the test class, and annotating it with <code>@Cube</code>.
Before running a test, Arquillian will detect that it needs to (i) start a new Cube (Docker container), (ii) create the Container Object and (iii) inject it in the test.
Notice that this <code>@Cube</code> annotation is exactly the same as the one used when you defined the Container Object.
Placing a <code>@Cube</code> annotation on the field will allow you to override any property of the Container Object from the test side.
Due to the override mechanism, it is important to use the <code>@HostPort</code> annotation when the bound port is needed, since it can be changed from the test definition.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The Container Object pattern only works in Client mode or Arquillian Standalone.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_shrinkwrap_dockerfile_descriptor"><a class="anchor" href="#_shrinkwrap_dockerfile_descriptor"></a>11.1.1. ShrinkWrap Dockerfile Descriptor</h4>
<div class="paragraph">
<p>If you want you can use <strong>ShrinkWrap Dockerfile</strong> descriptor to create the <code>Dockerfile</code> file.
First thing you need to do is adding <code>shrinkwrap-descriptord-api-docker dependencies</code>:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jboss.shrinkwrap.descriptors<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>shrinkwrap-descriptors-api-docker<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>

<span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jboss.shrinkwrap.descriptors<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>shrinkwrap-descriptors-impl-docker<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And in similar way you use <code>@Deployment</code> in Arquillian test, you can use <code>@CubeDockerFile</code> annotation in a public static method to define <code>Dockerfile</code> file and elements required for creating the container programmatically:</p>
</div>
<div class="listingblock">
<div class="title">PingPongContainer.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cube</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">pingpong</span><span class="delimiter">&quot;</span></span>, portBinding = <span class="string"><span class="delimiter">&quot;</span><span class="content">5432-&gt;8080/tcp</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">PingPongContainer</span> {

  <span class="annotation">@CubeDockerFile</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="directive">public</span> <span class="directive">static</span> Archive&lt;?&gt; createContainer() { <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="predefined-type">String</span> dockerDescriptor =   Descriptors.create(DockerDescriptor.class).from(<span class="string"><span class="delimiter">&quot;</span><span class="content">tsongpon/pingpong</span><span class="delimiter">&quot;</span></span>).exportAsString();
      <span class="keyword">return</span> ShrinkWrap.create(GenericArchive.class)
                .add(<span class="keyword">new</span> StringAsset(dockerDescriptor), <span class="string"><span class="delimiter">&quot;</span><span class="content">Dockerfile</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="3"></i><b>(3)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@CubeDockerFile</code> annotation is used.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Method must be <code>public</code> and <code>static</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Returns a <code>GenericArchive</code> with all elements required for building the Docker container instance.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As part of Arquillian Cube, we are providing a <code>org.arquillian.cube.impl.shrinkwrap.asset.CacheUrlAsset</code> asset.
This asset is similar to <code>org.jboss.shrinkwrap.api.asset.UrlAsset</code>, but the former caches to disk for an amount of time the content that has been downloaded from the URL.
By default, this expiration time is 1 hour, and it is configurable by using the proper constructor.</p>
</div>
</div>
<div class="sect3">
<h4 id="_links"><a class="anchor" href="#_links"></a>11.1.2. Links</h4>
<div class="paragraph">
<p>A Container Object can reference more Container Objects from inside of it.
Effectively, a Container Object can be an aggregation of other Container Objects:</p>
</div>
<div class="listingblock">
<div class="title">FirstContainerObject.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cube</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">FirstContainerObject</span> {

  <span class="annotation">@Cube</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">inner</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
  LinkContainerObject linkContainerObject;

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cube definition inside another Cube.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case Arquillian Cube will create a link from <code>FirstContainerObject</code> to <code>LinkContainerObject</code> with link value <code>inner:inner</code>.</p>
</div>
<div class="paragraph">
<p>Of course you can override the link value using <code>@Link</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cube</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">inner</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Link</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">db:db</span><span class="delimiter">&quot;</span></span>)
TestLinkContainerObject linkContainerObject;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_image"><a class="anchor" href="#_image"></a>11.1.3. Image</h4>
<div class="paragraph">
<p>So far, you&#8217;ve seen that a Container Object creates an instance from a <code>Dockerfile</code> using <code>@CubeDockerFile</code> annotation. You can also create a Container Object from an image by using <code>@Image</code> annotation:</p>
</div>
<div class="listingblock">
<div class="title">ImageContainerObject.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cube</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tomme</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Image</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tomee:8-jre-1.7.2-webprofile</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">ImageContainerObject</span> {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case Arquillian Cube will create containers based on the image defined in the annotation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_environment"><a class="anchor" href="#_environment"></a>11.1.4. Environment</h4>
<div class="paragraph">
<p>You can set environment variables using <code>@Environment</code> annotation at field or object level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Environment</span>(key = <span class="string"><span class="delimiter">&quot;</span><span class="content">C</span><span class="delimiter">&quot;</span></span>, value = <span class="string"><span class="delimiter">&quot;</span><span class="content">D</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Environment</span>(key = <span class="string"><span class="delimiter">&quot;</span><span class="content">A</span><span class="delimiter">&quot;</span></span>, value = <span class="string"><span class="delimiter">&quot;</span><span class="content">B</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Image</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tomee:8-jre-1.7.2-webprofile</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ImageContainer</span> {
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_volume"><a class="anchor" href="#_volume"></a>11.1.5. Volume</h4>
<div class="paragraph">
<p>You can set environment variables using <code>@Volume</code> annotation at field or object level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Image</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tomee:8-jre-1.7.2-webprofile</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Volume</span>(hostPath = <span class="string"><span class="delimiter">&quot;</span><span class="content">/mypath</span><span class="delimiter">&quot;</span></span>, containerPath = <span class="string"><span class="delimiter">&quot;</span><span class="content">/containerPath</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Volume</span>(hostPath = <span class="string"><span class="delimiter">&quot;</span><span class="content">/mypath2</span><span class="delimiter">&quot;</span></span>, containerPath = <span class="string"><span class="delimiter">&quot;</span><span class="content">/containerPath2</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ImageContainer</span> {
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_container_objects_dynamically"><a class="anchor" href="#_creating_container_objects_dynamically"></a>11.1.6. Creating container objects dynamically</h4>
<div class="paragraph">
<p>Up to this point you have seen how to automatically inject Container Objects in tests.
Arquillian Cube also allows creating container objects from code.
In the next example, the original <code>PingPongTest</code> has been rewritten to create the Container Object inside the test method.</p>
</div>
<div class="listingblock">
<div class="title">PingPongTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Arquillian.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">PingPongTest</span> {

    <span class="annotation">@ArquillianResource</span>
    ContainerObjectFactory factory; <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@ArquillianResource</span>
    CubeController cubeController;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> shouldReturnOkAsPong() <span class="directive">throws</span> <span class="exception">IOException</span> {
        PingPongContainer pingPongContainer =
            factory.createContainer(PingPongContainer.class); <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">try</span> {
            <span class="predefined-type">String</span> pong = ping();
            assertThat(pong, containsString(<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span>));
            assertThat(pingPongContainer.getConnectionPort(), is(<span class="integer">5432</span>));
        } <span class="keyword">finally</span> {
            cubeController.stop(<span class="string"><span class="delimiter">&quot;</span><span class="content">pingpong</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="3"></i><b>(3)</b>
            cubeController.destroy(<span class="string"><span class="delimiter">&quot;</span><span class="content">pingpong</span><span class="delimiter">&quot;</span></span>);
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A <code>ContainerObjectFactory</code> instance is injected into the test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The injectect factory instance is used to instantiate a container object.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A <code>CubeController</code> could be used to stop the associated docker container.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Although declaring container objects as fields of a test class is preffered, as it offers better control of the lifecycle of the container, creating container objects dynamically allows controlling exactly in which moment in time and in which order the containers are created.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_arquillian_cube_and_container_object_dsl"><a class="anchor" href="#_arquillian_cube_and_container_object_dsl"></a>11.2. Arquillian Cube and Container Object DSL</h3>
<div class="paragraph">
<p>Another option is using a generic container objects provided by Arquillian Cube to generate cube instances.
Using this approach you gain in velocity at time of writing the definition, but on the other side it is harder to reuse them or providing custom operations like you can do in custom container objects.</p>
</div>
<div class="paragraph">
<p>With DSL you can generate container objects or network objects as well.</p>
</div>
<div class="sect3">
<h4 id="_container_objects_dsl"><a class="anchor" href="#_container_objects_dsl"></a>11.2.1. Container Objects DSL</h4>
<div class="paragraph">
<p>To create a generic container object you only need to create a field of type <code>org.arquillian.cube.docker.impl.client.containerobject.dsl.Container</code> and annotate it with <code>@DockerContainer</code>.
Now you need to provide the full definition of the container using the DSL.
Let&#8217;s see how to use it following the previous Ping Pong example.</p>
</div>
<div class="listingblock">
<div class="title">PingPongTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DockerContainer</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="predefined-type">Container</span> pingpong = <span class="predefined-type">Container</span>.withContainerName(<span class="string"><span class="delimiter">&quot;</span><span class="content">pingpong</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
                        .fromImage(<span class="string"><span class="delimiter">&quot;</span><span class="content">tsongpon/pingpong</span><span class="delimiter">&quot;</span></span>)
                        .withPortBinding(<span class="integer">8080</span>)
                        .build();

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> should_return_ok_as_pong() <span class="directive">throws</span> <span class="exception">IOException</span> {
   <span class="predefined-type">String</span> response = ping(pingpong.getIpAddress(), pingpong.getBindPort(<span class="integer">8080</span>)); <i class="conum" data-value="3"></i><b>(3)</b>
    assertThat(response).containsSequence(<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate field with <code>DockerContainer</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Start the DSL using <code>withContainerName</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can get Docker Host Ip address and binding port for given exposed port</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In case you define more than one generic container and want to start them in a specfic order, there is <code>order</code> attribute in annotation to specify it. The higher the number, the sooner the container is started.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Container objects by default are started and stopped in class scope. To change it to method scope you can use <code>.withConnectionMode</code> call.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_junit_rule"><a class="anchor" href="#_junit_rule"></a>JUnit Rule</h5>
<div class="paragraph">
<p>If you are using <code>JUnit</code> and want to use Container DSL builder approach, you can use <code>JUnit Rule</code> instead of <code>Arquillian Runner</code>.</p>
</div>
<div class="paragraph">
<p>To do use it you need to define the container object using an special <code>JUnit Rule</code>.</p>
</div>
<div class="listingblock">
<div class="title">RedisTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ClassRule</span>
<span class="directive">public</span> <span class="directive">static</span> ContainerDslRule redis = <span class="keyword">new</span> ContainerDslRule(<span class="string"><span class="delimiter">&quot;</span><span class="content">redis:3.2.6</span><span class="delimiter">&quot;</span></span>)
                                               .withPortBinding(<span class="integer">6379</span>);

Jedis jedis = <span class="keyword">new</span> Jedis(redis.getIpAddress(), redis.getBindPort(<span class="integer">6379</span>));
jedis.set(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You need to add <code>org.arquillian.cube:arquillian-cube-docker-junit-rule</code> dependency.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In both approaches (Runner and JUnit Rule) of Container Object DSL way, star operator is supported.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ClassRule</span>
<span class="directive">public</span> <span class="directive">static</span> ContainerDslRule redisStar = <span class="keyword">new</span> ContainerDslRule(<span class="string"><span class="delimiter">&quot;</span><span class="content">redis:3.2.6</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">redis*</span><span class="delimiter">&quot;</span></span>)
                                                .withPortBinding(<span class="integer">6379</span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_junit_5"><a class="anchor" href="#_junit_5"></a>JUnit 5</h5>
<div class="paragraph">
<p>If you are using <code>JUnit 5</code> and want to use Container DSL approach, you can use <code>JUnit 5 Extension</code> instead of <code>Arquillian Runner</code>.</p>
</div>
<div class="paragraph">
<p>To do use it you need to define the container object using <code>ContainerDsl</code> class and registering <code>ContainerDslResolver</code>.</p>
</div>
<div class="listingblock">
<div class="title">RedisTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">//@ExtendWith(ContainerDslResolver.class)</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">RedisTest</span> {

    <span class="directive">private</span> ContainerDsl redis = <span class="keyword">new</span> ContainerDsl(<span class="string"><span class="delimiter">&quot;</span><span class="content">redis:3.2.6</span><span class="delimiter">&quot;</span></span>)
                                        .withPortBinding(<span class="integer">6379</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If field is static, container is started and stopped just once. If not then it is started and stopped for each test method execution.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You need to add <code>org.arquillian.cube:arquillian-cube-docker-junit5</code> dependency.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_network_objects_dsl"><a class="anchor" href="#_network_objects_dsl"></a>11.2.2. Network Objects DSL</h4>
<div class="paragraph">
<p>To create a network using DSL approach you only need to create a field of type <code>org.arquillian.cube.docker.impl.client.containerobject.dsl.Network</code> and annotate it with <code>org.arquillian.cube.docker.impl.client.containerobject.dsl.DockerNetwork</code>.
Let&#8217;s see how to create a new network with default driver.</p>
</div>
<div class="listingblock">
<div class="title">NetworkTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DockerNetwork</span> <i class="conum" data-value="1"></i><b>(1)</b>
Network network = Network.withDefaultDriver(<span class="string"><span class="delimiter">&quot;</span><span class="content">mynetwork</span><span class="delimiter">&quot;</span></span>).build(); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate field with <code>DockerNetwork</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Start the DSL using <code>withDefaultDriver</code> method</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_junit_rule_2"><a class="anchor" href="#_junit_rule_2"></a>JUnit Rule</h5>
<div class="paragraph">
<p>If you are using <code>JUnit</code> and want to use Network DSL builder approach, you can use <code>JUnit Rule</code> instead of <code>Arquillian Runner</code>.</p>
</div>
<div class="paragraph">
<p>To do use it you need to define the network object using an special <code>JUnit Rule</code>.</p>
</div>
<div class="listingblock">
<div class="title">NetworkTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ClassRule</span>
<span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> NetworkDslRule network = <span class="keyword">new</span> NetworkDslRule(<span class="string"><span class="delimiter">&quot;</span><span class="content">mynetwork</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You need to add <code>org.arquillian.cube:arquillian-cube-docker-junit-rule</code> dependency.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_junit_5_2"><a class="anchor" href="#_junit_5_2"></a>JUnit 5</h5>
<div class="paragraph">
<p>If you are using <code>JUnit 5</code> and want to use Network DSL approach, you can use <code>JUnit 5 Extension</code> instead of <code>Arquillian Runner</code>.</p>
</div>
<div class="paragraph">
<p>To do use it you need to define the network object using <code>NetowrkDsl</code> class and registering <code>NetworkDslResolver</code>.</p>
</div>
<div class="listingblock">
<div class="title">NetworkTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">//@ExtendWith(NetworkDslResolver.class)</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">NetworkTest</span> {
    <span class="directive">private</span> NetworkDsl networkDsl = <span class="keyword">new</span> NetworkDsl(<span class="string"><span class="delimiter">&quot;</span><span class="content">mynetwork</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If field is static, network is created and destroyed just once. If not then it is created and destroyed for each test method execution.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You need to add <code>org.arquillian.cube:arquillian-cube-docker-junit5</code> dependency.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_arquillian_standalone_and_cube"><a class="anchor" href="#_arquillian_standalone_and_cube"></a>12. Arquillian Standalone and Cube</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use Arquillian Standalone with Arquillian Cube too.
Arquillian Standalone is a mode of Arquillian which allows you to use Arquillian but without deploying any application.
Basically it means no <code>@Deployment</code> static method, and tests runs as client implicitly.</p>
</div>
<div class="paragraph">
<p>Running Arquillian Cube in Standalone mode means that Arquillian Cube starts all defined containers in the correct order.
Internally Arquillian Cube implicitly defines the <code>autostartContainers</code> property (unless you define it), with <code>regexp:.*</code> expression, which means all containers will be created/started.
If you want to avoid this behavior, you can set this property to <code>[none]</code>.
As a result, Arquilian Cube will not auto-start any container and you will be responsible of starting manually each instance (using for example, the CubeController class) by your own.</p>
</div>
<div class="paragraph">
<p>Dependencies you need to set for Standalone mode are:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.jboss.arquillian.junit<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>arquillian-junit-standalone<span class="tag">&lt;/artifactId&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
         <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
         <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-docker<span class="tag">&lt;/artifactId&gt;</span>
         <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You need to change <code>arquillian-junit-container</code> to <code>standalone</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_requirements_module"><a class="anchor" href="#_requirements_module"></a>13. Requirements Module</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Arquillian Cube tries to connect to the local Docker installation, or to a Kubernetes or OpenShift cluster.</p>
</div>
<div class="paragraph">
<p>Sometimes the test environment does not support one of the above-mentioned targets, and some tests may fail, e.g.: a
test requiring OpenShift 4 would fail if the test environment does not support providing an OpenShift 4 cluster.</p>
</div>
<div class="paragraph">
<p>Obviously this is not a test failure, and test should rather be ignored.
For this use case and similar ones, Arquillian Cube provides the <strong>requirements</strong> module.
This module makes it easy to skip tests, instead of failing, in the case any environment expectations are not met.</p>
</div>
<div class="sect2">
<h3 id="_example_of_environment_requirements"><a class="anchor" href="#_example_of_environment_requirements"></a>13.1. Example of environment requirements</h3>
<div class="paragraph">
<p>By using <em>Requirements</em>, you can set if you want to skip tests based on variable criteria, like missing environment
variables or system properties.
This is useful for example if you require that <code>DOCKER_HOST</code>, <code>DOCKER_TLS_VERIFY</code> or <code>DOCKER_CERT_PATH</code> system or
environment variable must be set.
Similarly, for example in the Kubernetes use case, a requirement can prevent a test from being executed if the cluster
is not available.</p>
</div>
<div class="paragraph">
<p>Notice that Cube gives precedence to these variables, as to those configured in <code>arquillian.xml</code>.</p>
</div>
<div class="paragraph">
<p>To use it you need to add requirements dependency.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-requirement<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can use a special runner or a JUnit <em>Rule</em>.
If you use a <em>Rule</em>, the scope of annotations can only be a test class, while annotations can be used at the suite level
when using an <em>ArquillianConditionalRunner</em>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see how to use with JUnit <em>Rule</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.arquillian.cube.requirement.RequiresSystemPropertyOrEnvironmentVariable</span>;
<span class="keyword">import</span> <span class="include">org.arquillian.cube.requirement.RequirementRule</span>;

<span class="annotation">@RunWith</span>(Arquillian.class)
<span class="annotation">@RequiresSystemPropertyOrEnvironmentVariable</span>(value = {<span class="string"><span class="delimiter">&quot;</span><span class="content">DOCKER_HOST</span><span class="delimiter">&quot;</span></span>}) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldServletTest</span> {

    <span class="annotation">@Rule</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> RequirementRule requirementRule = <span class="keyword">new</span> RequirementRule();

    <span class="comment">//....</span>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Checks if either a system property or an environment variable with name <code>DOCKER_HOST</code> is set</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Rule definition</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, you can use the <em>ArquillianConditionalRunner</em> approach to use the requirement at the suite level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.arquillian.cube.requirement.RequiresSystemPropertyOrEnvironmentVariable</span>;
<span class="keyword">import</span> <span class="include">org.arquillian.cube.requirement.ArquillianConditionalRunner</span>;

<span class="annotation">@RunWith</span>(ArquillianConditionalRunner.class) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@RequiresSystemPropertyOrEnvironmentVariable</span>(value = {<span class="string"><span class="delimiter">&quot;</span><span class="content">DOCKER_HOST</span><span class="delimiter">&quot;</span></span>}) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldServletTest</span> {

    <span class="comment">//....</span>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Runner for requirements check</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Checks if either a system property or an environment variable with name <code>DOCKER_HOST</code> is set</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>RequiresEnvironmentVariable</code> and <code>RequiresSystemProperty</code> annotations can be used too, which respectively check
whether <em>just</em> an environment variable or a system property ar set.</p>
</div>
</div>
<div class="sect2">
<h3 id="_example_with_openshift_4"><a class="anchor" href="#_example_with_openshift_4"></a>13.2. Example with OpenShift 4</h3>
<div class="paragraph">
<p>The <code>openshift</code> module also defines an annotation for checking the environment against an OpenShift 4 cluster existence.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.arquillian.cube.requirement.ArquillianConditionalRunner</span>;
<span class="keyword">import</span> <span class="include">org.arquillian.cube.openshift.impl.requirement.RequiresOpenShift4</span>;

<span class="annotation">@RunWith</span>(ArquillianConditionalRunner.class)
<span class="annotation">@RequiresOpenshift4</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">RouteInOtherNamespaceIT</span> {

    <span class="comment">//....</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>OpenShift 4 is required for the test to be executed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The test will only be executed if an OpenShift 4 cluster is available in the target environment</p>
</div>
</div>
<div class="sect2">
<h3 id="_customizing_requirements"><a class="anchor" href="#_customizing_requirements"></a>13.3. Customizing Requirements</h3>
<div class="paragraph">
<p>You can also implement your own requirement annotations.
To do it you only need to do two things.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add an annotation interface, decorated with <code>org.arquillian.cube.spi.requirement.Requires</code> pointing to a class
which implements <code>org.arquillian.cube.spi.requirement.Requirement</code>.</p>
</li>
<li>
<p>Add an implementation of the <code>org.arquillian.cube.spi.requirement.Requirement</code> interface.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s see an example of how to implement a requirement against docker version.</p>
</div>
<div class="listingblock">
<div class="title">RequiresDockerVersion.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.TYPE, <span class="predefined-type">ElementType</span>.METHOD})
<span class="annotation">@Requires</span>(DockerRequirement.class) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="annotation">@interface</span> RequiresDockerVersion {
    <span class="predefined-type">String</span> name() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>; <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sets requirement interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Attribute to set the required version</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And the implementation logic:</p>
</div>
<div class="listingblock">
<div class="title">DockerRequirement.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DockerRequirement</span> <span class="directive">implements</span> Requirement&lt;RequiresDockerVersion&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> check(RequiresDocker context) <span class="directive">throws</span> UnsatisfiedRequirementException {
        <span class="keyword">try</span> {
            <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; config = resolver.resolve(<span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;());
            <span class="predefined-type">String</span> serverUrl = config.get(CubeDockerConfiguration.DOCKER_URI);
            <span class="keyword">if</span> (Strings.isNullOrEmpty(serverUrl)) {
                <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedRequirementException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Could not resolve the docker server url.</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>
            } <span class="keyword">else</span> <span class="keyword">if</span> (!isDockerRunning(serverUrl)) {
                <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedRequirementException(<span class="string"><span class="delimiter">&quot;</span><span class="content">No server is running on url:[</span><span class="delimiter">&quot;</span></span> + serverUrl + <span class="string"><span class="delimiter">&quot;</span><span class="content">].</span><span class="delimiter">&quot;</span></span>);
            }
        } <span class="keyword">catch</span> (<span class="exception">ExecutionException</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> UnsatisfiedRequirementException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cannot execute docker command.</span><span class="delimiter">&quot;</span></span>);
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In case of not meeting an expectation, <code>org.arquillian.cube.spi.requirement.UnsatisfiedRequirementException</code> should be
thrown with a message.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After that you can use this annotation as any other requirements provided by Cube.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_containerless_server_and_docker"><a class="anchor" href="#_containerless_server_and_docker"></a>14. Containerless Server and Docker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In all previous sections we have seen that the application is deployed inside a container.
For example in case of <em>Tomcat</em> application, resources are deployed inside a <em>Servlet</em> container or for example in case of <em>Apache TomEE</em> you can deploy <em>EJBs</em> inside an <em>EJB</em> container.</p>
</div>
<div class="paragraph">
<p>But nowadays there other kind of applications that contains the container (if they have one) embedded inside them.
Typically these applications uses an embedded server and they are run as <em>CLI</em> applications.
Some examples can be <em>Spring Boot</em>, <em>Netty</em>, <em>SparkJava</em> or <em>Undertow</em>.</p>
</div>
<div class="paragraph">
<p>If you are using some of these technologies with <em>Docker</em>, you can still use <strong>Arquillian Cube</strong> to write your tests.</p>
</div>
<div class="sect2">
<h3 id="_java_embedded_servers"><a class="anchor" href="#_java_embedded_servers"></a>14.1. Java Embedded Servers</h3>
<div class="paragraph">
<p>Let&#8217;s suppose we are writing a service which should return as text the current day and time.
To serve this service to the world we decide to use <em>undertow</em> embedded server.</p>
</div>
<div class="paragraph">
<p>The code looks like:</p>
</div>
<div class="listingblock">
<div class="title">DaytimeServer.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">io.undertow.Undertow</span>;
<span class="keyword">import</span> <span class="include">io.undertow.server.HttpHandler</span>;
<span class="keyword">import</span> <span class="include">io.undertow.server.HttpServerExchange</span>;
<span class="keyword">import</span> <span class="include">io.undertow.util.Headers</span>;

<span class="keyword">import</span> <span class="include">java.text.SimpleDateFormat</span>;
<span class="keyword">import</span> <span class="include">java.util.Date</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">DaytimeServer</span> {

  <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) { <i class="conum" data-value="1"></i><b>(1)</b>

      Undertow server = Undertow.builder()
              .addHttpListener(<span class="integer">8080</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">0.0.0.0</span><span class="delimiter">&quot;</span></span>)
              .setHandler(<span class="keyword">new</span> HttpHandler() {
                <span class="annotation">@Override</span>
                <span class="directive">public</span> <span class="type">void</span> handleRequest(<span class="directive">final</span> HttpServerExchange exchange) <span class="directive">throws</span> <span class="exception">Exception</span> {
                    <span class="predefined-type">SimpleDateFormat</span> simpleDateFormat = <span class="keyword">new</span> <span class="predefined-type">SimpleDateFormat</span>();
                    exchange.getResponseHeaders().put(Headers.CONTENT_TYPE, <span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>);
                    exchange.getResponseSender().send(simpleDateFormat.format(<span class="keyword">new</span> <span class="predefined-type">Date</span>()) + <span class="predefined-type">System</span>.lineSeparator()); <i class="conum" data-value="2"></i><b>(2)</b>
                }
            }).build();
       server.start();
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This class is a CLI application.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Returns a text with the day and time formatted with SimpleDateFormat.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See that this application is a CLI application which is pretty different from previous examples.
Previously the packaged application was deployed inside an application server, which in fact means that <strong>Arquillian</strong> connects to the server and tells it to deploy that file.</p>
</div>
<div class="paragraph">
<p>In this example there is no application server nor servlet server waiting for <strong>Arquillian</strong> to deploy an archive but the application is self-contained, it contains everything.
So in fact if you want to run the application probably you will end up by doing something like java -jar daytime.jar.</p>
</div>
<div class="paragraph">
<p>So how to write a test for these classes if we are using <em>Docker</em> as runtime container?</p>
</div>
<div class="paragraph">
<p>The first thing to do is add arquillian-cube-containerless dependency.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-containerless<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>${arquillian.cube.version}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next step is creating a Dockerfile.
This is required because we need to set not only the container image to be used but how to run the application.
But see that there is a problem on creating a Dockerfile in this case.
The jar name is not static because it will depend on the name you give during the creation of the archive (using <em>Shrinkwrap</em>).
So in fact Dockerfile should be templaterized.
And this is something that <strong>Arquillian Cube</strong> can do for you.
The idea is creating a file called DockerfileTemplate.</p>
</div>
<div class="listingblock">
<div class="title">src/test/resources/daytime/DockerfileTemplate</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">FROM java:7

WORKDIR /usr/src/server
COPY ${deployableFilename} /usr/src/server/${deployableFilename} <i class="conum" data-value="1"></i><b>(1)</b>
EXPOSE 8080
CMD [&quot;java&quot;, &quot;-jar&quot;, &quot;${deployableFilename}&quot;]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>${deployableFilname} will be replaced at runtime by the name of the jar file created by <em>Shrinkwrap</em>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then we need to touch arquillian.xml file by setting an special container definition so <strong>Arquillian</strong> doesn&#8217;t crash because of trying to deploy the archive into a none defined container.</p>
</div>
<div class="listingblock">
<div class="title">src/test/resources/arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="tag">&lt;arquillian</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://jboss.org/schema/arquillian</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://jboss.org/schema/arquillian</span>
  <span class="content">http://jboss.org/schema/arquillian/arquillian_1_0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

  <span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">docker</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverVersion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>1.12<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverUri</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>http://localhost:2375<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dockerContainers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
      daytime:
        buildImage: <i class="conum" data-value="2"></i><b>(2)</b>
          dockerfileLocation: src/test/resources/undertow <i class="conum" data-value="3"></i><b>(3)</b>
          noCache: true
          remove: true
        await:
          strategy: polling
        portBindings: [8080/tcp]
    <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/extension&gt;</span>

  <span class="tag">&lt;container</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">containerless</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">containerlessDocker</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>daytime<span class="tag">&lt;/property&gt;</span> <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">embeddedPort</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>8080<span class="tag">&lt;/property&gt;</span> <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="tag">&lt;/configuration&gt;</span>
  <span class="tag">&lt;/container&gt;</span>

<span class="tag">&lt;/arquillian&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Docker container is defined as per usual.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>buildImage attribute is used to define the dockerfile location.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This attribute sets the directory where the Dockerfile is stored. In fact in this case it is the directory where DockerfileTemplate file is stored.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A container provided by <strong>Arquillian Cube</strong> must be defined.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>This property is used to set which container must be started.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>This property sets the exposed port by the embedded server.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If containerless definition only contains only one image, it is not necessary to use <em>containerlessDocker</em> property. At the same time if the image only exposes one port, it is not necessary to use <em>embeddedPort</em> proeprty to set the port. So in previous example you could avoid using <em>containerlessDocker</em> and <em>embeddedPort</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And finally the test:</p>
</div>
<div class="listingblock">
<div class="title">DaytimeTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Arquillian.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">DaytimeTest</span> {

  <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> LINE_SEPARATOR = <span class="predefined-type">System</span>
          .getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">line.separator</span><span class="delimiter">&quot;</span></span>);

  <span class="annotation">@Deployment</span>(testable = <span class="predefined-constant">false</span>) <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="directive">public</span> <span class="directive">static</span> JavaArchive createDeployment() {
      JavaArchive<span class="type">[]</span> undertow = Maven.resolver().resolve(<span class="string"><span class="delimiter">&quot;</span><span class="content">io.undertow:undertow-core:1.1.1.Final</span><span class="delimiter">&quot;</span></span>).withTransitivity().as(JavaArchive.class); <i class="conum" data-value="2"></i><b>(2)</b>

      JavaArchive jar = ShrinkWrap
              .create(JavaArchive.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">daytime.jar</span><span class="delimiter">&quot;</span></span>)
              .addClass(DaytimeServer.class); <i class="conum" data-value="3"></i><b>(3)</b>

      <span class="keyword">for</span> (JavaArchive javaArchive : undertow) { <i class="conum" data-value="4"></i><b>(4)</b>
          jar.merge(javaArchive);
      }

      jar.addAsManifestResource(
              <span class="keyword">new</span> StringAsset(
                      <span class="string"><span class="delimiter">&quot;</span><span class="content">Main-Class: org.arquillian.cube.impl.containerless.DaytimeServer</span><span class="delimiter">&quot;</span></span>
                              + LINE_SEPARATOR), <span class="string"><span class="delimiter">&quot;</span><span class="content">MANIFEST.MF</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="5"></i><b>(5)</b>
      <span class="keyword">return</span> jar;
  }

  <span class="annotation">@Test</span>
  <span class="directive">public</span> <span class="type">void</span> shouldReturnDateFromDaytimeServer(<span class="annotation">@ArquillianResource</span> <span class="predefined-type">URL</span> base) { <i class="conum" data-value="6"></i><b>(6)</b>
      <span class="keyword">try</span> (
              <span class="predefined-type">BufferedReader</span> in = <span class="keyword">new</span> <span class="predefined-type">BufferedReader</span>(<span class="keyword">new</span> <span class="predefined-type">InputStreamReader</span>(
                    base.openStream()));) {
          <span class="predefined-type">String</span> userInput = in.readLine();
          assertThat(userInput, notNullValue());
      } <span class="keyword">catch</span> (<span class="exception">UnknownHostException</span> e) {
          fail(<span class="string"><span class="delimiter">&quot;</span><span class="content">Don't know about host </span><span class="delimiter">&quot;</span></span>);
      } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) {
          fail(<span class="string"><span class="delimiter">&quot;</span><span class="content">Couldn't get I/O for the connection to </span><span class="delimiter">&quot;</span></span>);
      }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Tests should be run as-client.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><em>ShrinkWrap</em> Maven resolver gets all dependencies for <em>Undertow</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create a jar file called daytime.jar with DaytimeServer class.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Undertow dependencies are merged inside jar.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Because it is a runnable jar, MANIFEST is created accordantly.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Simple test.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cube_docker_dronegraphene_integration"><a class="anchor" href="#_cube_docker_dronegraphene_integration"></a>15. Cube Docker Drone/Graphene Integration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_drone"><a class="anchor" href="#_drone"></a>15.1. Drone</h3>
<div class="paragraph">
<p>The Arquillian Drone extension for Arquillian provides a simple way how to include functional tests for your application with a web-based user interface.
Arquillian Drone brings the power of WebDriver into the Arquillian framework.</p>
</div>
<div class="paragraph">
<p>Arquillian Drone provides some features that make it better to use instead of plain WebDriver:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Life cycle management of the browser</p>
</li>
<li>
<p>Interaction with deployments and containers provided by Arquillian</p>
</li>
<li>
<p>Simple usage of multiple browsers in a single test</p>
</li>
<li>
<p>Configuration kept on a single place, outside of the Java code</p>
</li>
<li>
<p>Fully compatible with the IDE</p>
</li>
<li>
<p>Support for injection of Pages, PagesFragments, AJAX request guards and more via Arquillian Graphene 2</p>
</li>
<li>
<p>Integration with mobile based browsers testing (Arquillian Droidium)</p>
</li>
<li>
<p>Integration of JavaScript test suite execution (QUnit)</p>
</li>
<li>
<p>Compatible with WebDriver (Selenium 2) and Selenium Grids</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can read more about Drone at <a href="https://docs.jboss.org/author/display/ARQ/Drone" class="bare">https://docs.jboss.org/author/display/ARQ/Drone</a></p>
</div>
<div class="sect3">
<h4 id="_integration_with_cube_docker"><a class="anchor" href="#_integration_with_cube_docker"></a>15.1.1. Integration with Cube Docker</h4>
<div class="paragraph">
<p>Arquillian Cube Docker is the Arquillian extension for managing Docker containers from your test.</p>
</div>
<div class="paragraph">
<p>Selenium offers Docker images for Selenium Standalone Server with Chrome or Firefox installed.
You can check available the images at <a href="https://github.com/SeleniumHQ/docker-selenium" class="bare">https://github.com/SeleniumHQ/docker-selenium</a>.</p>
</div>
<div class="paragraph">
<p>With these images and using Selenium WebDriver you can run your functional tests for web UI applications without having to install any browser.</p>
</div>
<div class="paragraph">
<p>It seems logic an integration of Arquillian Drone with Cube, so you can use all powerful features of Drone, and let Cube configure Docker things for you.</p>
</div>
<div class="paragraph">
<p>This integration does next things for you:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Inspect classpath to get selenium version used</p>
</li>
<li>
<p>Starts a docker container with configured browser in Drone and same selenium version as your <code>JARs</code>. If not Firefox is used</p>
</li>
<li>
<p>Provides a WebDriver that is able to connect to this container</p>
</li>
<li>
<p>If configured (by default it is) a VNC recorder container is started so each test is recorded in a <code>mp4</code> file.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a>15.1.2. Configuration</h4>
<div class="paragraph">
<p>Apart from using Drone configuration properties for configuring browser, Cube Docker can be customized with some specific attributes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">recordingMode</dt>
<dd>
<p>Configures mode for recording. The valid values are: <code>ALL, ONLY_FAILING, NONE. Default value is `ALL</code>.</p>
</dd>
<dt class="hdlist1">videoOutput</dt>
<dd>
<p>Directory where videos are stored. By default is <code>target/reports/videos</code> or if target does not exists <code>build/reports/videos</code> and if not creates a <code>target/reports/videos</code> by default.</p>
</dd>
<dt class="hdlist1">browserImage</dt>
<dd>
<p>Docker image to be used as custom browser image instead of the official one (<a href="https://github.com/SeleniumHQ/docker-selenium" class="bare">https://github.com/SeleniumHQ/docker-selenium</a>). Notice that browser property will be used for setting <code>WebDriver</code> capabilities.</p>
</dd>
<dt class="hdlist1">browserDockerfileLocation</dt>
<dd>
<p>Dockerfile location to be used to built custom docker image instead of the official one. This property has preference over browserImage.</p>
</dd>
<dt class="hdlist1">containerNameStrategy</dt>
<dd>
<p>Sets the strategy for generating the container name. Valid values are <code>STATIC, STATIC_PREFIX, RANDOM</code> with the default being <code>STATIC</code>. <code>STATIC</code> will always use the same name, <code>STATIC_PREFIX</code> lets you define a prefix and enables running different tests in parallel and <code>RANDOM</code> generates a unique container name on every test run enabling running the same test in parallel.</p>
</dd>
<dt class="hdlist1">containerNamePrefix</dt>
<dd>
<p>The prefix for the <code>STATIC_PREFIX</code> container name strategy.</p>
</dd>
<dt class="hdlist1">dockerRegistry</dt>
<dd>
<p>Use this to override the default docker registry with a user specified registry.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Your custom images must expose the webdriver port <code>4444</code> and if you plan to use VNC, expose the default port <code>5900</code> as well
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An example of configuration might look like:</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;arquillian&gt;</span>
    <span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cubedrone</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">recordingMode</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>NONE<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/extension&gt;</span>
<span class="tag">&lt;/arquillian&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example"><a class="anchor" href="#_example"></a>15.1.3. Example</h4>
<div class="paragraph">
<p>For adding Drone Cube integration you only need a Cube project with a <code>docker-compose</code> or <code>cube</code> file only specifying business containers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">helloworld</span>:
  <span class="key">image</span>: <span class="string"><span class="content">dockercloud/hello-world</span></span>
  <span class="key">ports</span>:
    - <span class="string"><span class="delimiter">&quot;</span><span class="content">80:80</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure the Cube extension:</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">docker</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dockerContainersFile</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>docker-compose.yml<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally among <code>cube</code> dependencies, add the <code>drone</code>, <code>selenium</code> and <code>cube-drone</code> dependencies.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencyManagement&gt;</span>
    <span class="tag">&lt;dependencies&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.jboss.arquillian.extension<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>arquillian-drone-bom<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>2.0.0.Final<span class="tag">&lt;/versio&gt;</span>
            <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
            <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.jboss.arquillian.selenium<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>selenium-bom<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>2.53.1<span class="tag">&lt;/version&gt;</span>
            <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
            <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span>

<span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-docker-drone<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.jboss.arquillian.extension<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>arquillian-drone-webdriver-depchain<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>2.0.0.Final<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
        <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Full source code can be found at: <a href="https://github.com/arquillian/arquillian-cube/tree/main/docker/ftest-drone" class="bare">https://github.com/arquillian/arquillian-cube/tree/main/docker/ftest-drone</a></p>
</div>
<div class="paragraph">
<p>Full source code of usign custom image can be found at: <a href="https://github.com/arquillian/arquillian-cube/tree/main/docker/ftest-drone-custom" class="bare">https://github.com/arquillian/arquillian-cube/tree/main/docker/ftest-drone-custom</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_graphene"><a class="anchor" href="#_graphene"></a>15.2. Graphene</h3>
<div class="paragraph">
<p>Arquillian Graphene is a set of extensions for the WebDriver API, focused on rapid development and usability in a Java environment.
Its API encourages people to write tests for AJAX-based web applications in a concise and maintainable way.
Graphene strives for reusable tests by simplifying the use of web page abstractions (Page Objects and Page Fragments).
You will get a taste of the Graphene API in just a minute!</p>
</div>
<div class="sect3">
<h4 id="_integration_with_docker_cube"><a class="anchor" href="#_integration_with_docker_cube"></a>15.2.1. Integration with Docker Cube</h4>
<div class="paragraph">
<p>Arquillian Graphene depends on Drone to provide an instance of WebDriver, so everything that is valid in <a href="#_integration_with_cube_docker">Integration with Cube Docker</a> is also valid for Cube Graphene.</p>
</div>
<div class="paragraph">
<p>So what can offer Docker Cube integration to you?</p>
</div>
<div class="paragraph">
<p>Arquillian has in summary two operating modes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Standalone</dt>
<dd>
<p>runs tests without container integration, only lifecycle of extensions is managed allows to use Graphene independently of Arquillian containers and deployment management. In terms of implementation means a test without <code>@Deployment</code> method, so it means that the artifact is already created and running. In case of Docker Cube means that docker image has been already created with the artifact inside it. You are in standalone mode if you add the <code>arquillian-junit-standalone</code> artifact.</p>
</dd>
<dt class="hdlist1">Container</dt>
<dd>
<p>runs tests with container, managed lifecycle of container including deployment. In terms of Docekr Cube means that the deployment file is going to be deployed into a running Docker image. You are in standalone mode if you add the <code>arquillian-junit-container</code> artifact.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>One of the things that Graphene offers to developers is to not have to worry about where the application is deployed by resolving automatically the host and the context of the application.
In summary developer does not need to worry about calling <code>webdriver.get(&#8230;&#8203;)</code> method since it is automatically called by Graphene.
Notice that this is a big difference with Drone where you need to call the <code>get</code> method <a href="#_example">Example</a>.</p>
</div>
<div class="paragraph">
<p>This autoresolution only works in case of running with <strong>container</strong> mode since it knows everything from the point of view deployment.
But in case of using <strong>Standalone</strong> mode, since it doesn&#8217;t know anything from deployment, you need to use <code>url</code> configuration property to set the url to use in <code>webdriver.get(..)</code> method.</p>
</div>
<div id="graphene-configuration" class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">graphene</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>http://localhost:8080/myapp<span class="tag">&lt;/property&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Base URL of WebDriver</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The problem is that in case of using Docker Cube is that probably you don&#8217;t know the docker host at configuration time but in runtime.
And this is where Docker Cube can help you when using <strong>Standalone</strong> mode.</p>
</div>
</div>
<div class="sect3">
<h4 id="_url_configuration_in_standalone_mode"><a class="anchor" href="#_url_configuration_in_standalone_mode"></a>15.2.2. URL configuration in Standalone mode</h4>
<div class="paragraph">
<p>As noted in <a href="#graphene-configuration">Graphene Configuration</a> you need to configure the <code>url</code> parameter in case of using Graphene in Standalone mode.
This is quite difficult to do it with Docker Cube because you need to set the docker host address and you might not know at configuration time.
For this reason Docker Cube Graphene integration helps you on this following next rules:</p>
</div>
<div class="paragraph">
<p><code>url</code> can use the <em>dockerHost</em> special word which will be replaced at runtime by docker host ip.</p>
</div>
<div class="paragraph">
<p>If <code>url</code> property starts with <em>dockerHost</em> resolution will be appended automatically at the start of the <code>url</code>.</p>
</div>
<div class="paragraph">
<p>Some examples (for now don&#8217;t think about ports since it is going to touch later):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An empty or not present of both properties: <code>scheme</code> and <code>url</code> will result in <code><a href="http://ipOfDockerhost" class="bare">http://ipOfDockerhost</a></code>.</p>
</li>
<li>
<p>If <code>url</code> is <em><a href="http://192.168.99.100/context" class="bare">http://192.168.99.100/context</a></em>  the result will be <code><a href="http://192.168.99.100/context" class="bare">http://192.168.99.100/context</a></code>.</p>
</li>
<li>
<p>If <code>url</code> is <em><a href="http://dockerHost/context" class="bare">http://dockerHost/context</a></em>  then the result will be <code><a href="http://ipOfDockerHost/context" class="bare">http://ipOfDockerHost/context</a></code>.</p>
</li>
<li>
<p>if <code>url</code> is <em><a href="http://containerName/context" class="bare">http://containerName/context</a></em> which means it is not an IP nor <code>dockerHost</code>, then Cube will find the internal IP of container with given name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Previous examples has not take into consideration port thing.
The next thing to resolve is the port of the URL which in this case and since browser runs inside docker host means resolve exposed ports..</p>
</div>
<div class="paragraph">
<p>Port resolution follows next rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>url</code> contains a port, that port is used. Notice that this port should be an exposed port.</p>
</li>
<li>
<p>If <code>url</code> has no port then <em>80</em> is used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In most cases you are going to use:</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">graphene</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>http://helloworld:8080/myapp<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That configuration would be translated to <code><a href="http://&lt;internalIpOfhelloworldContainer:8080/myapp" class="bare">http://&lt;internalIpOfhelloworldContainer:8080/myapp</a></code> and Graphene will use it as base for all WebDriver calls.</p>
</div>
</div>
<div class="sect3">
<h4 id="_example_2"><a class="anchor" href="#_example_2"></a>15.2.3. Example</h4>
<div class="paragraph">
<p>Apart from adding <code>arquillian</code>, <code>arquillian-drone</code>, <code>selenium-bom</code> and <code>arquillian-cube-docker-drone</code>, obviously you also need to add the dependencies of Graphene.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jboss.arquillian.graphene<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>graphene-webdriver<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.1.0.Final<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jboss.arquillian.graphene<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>graphene-webdriver-impl<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.1.0.Final<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see the same example we used in Drone but using Graphene at <a href="https://github.com/arquillian/arquillian-cube/tree/main/docker/ftest-graphene" class="bare">https://github.com/arquillian/arquillian-cube/tree/main/docker/ftest-graphene</a></p>
</div>
<div class="paragraph">
<p>Also, you can learn about Graphene at <a href="http://arquillian.org/guides/functional_testing_using_graphene/" class="bare">http://arquillian.org/guides/functional_testing_using_graphene/</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rest_assured_integration"><a class="anchor" href="#_rest_assured_integration"></a>16. Rest-Assured integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rest-Assured is a Java DSL for easy testing of REST services.
An example of how to make a GET request and validate the JSON or XML response might be like:</p>
</div>
<div class="paragraph">
<p><code>get("/lotto").then().assertThat().body("lotto.lottoId", equalTo(5));</code></p>
</div>
<div class="paragraph">
<p>The problem with Rest Assured is that by default it assumes that host is <em>localhost</em> and port <em>8080</em>.
This might be perfect when not using Docker but when using docker this assumptions might not be the most typical.</p>
</div>
<div class="paragraph">
<p>For example, you may use another bind port rather than <em>8080</em>, you can expose 8080 port but bind to another port.
Also, you might run docker host in different ip rather than <em>localhost</em>, maybe because you are using an external docker host.</p>
</div>
<div class="paragraph">
<p>So in these cases you need to set in every request:</p>
</div>
<div class="paragraph">
<p><code>get("http://myhost.org:5000/lotto").then().assertThat().body("lotto.lottoId", equalTo(5));</code></p>
</div>
<div class="paragraph">
<p>or you can also configure Rest-Assured:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RestAssured.baseURI = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://myhost.org</span><span class="delimiter">&quot;</span></span>;
RestAssured.port = <span class="integer">5000</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or using RequestSpecBuilder</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">spec = <span class="keyword">new</span> RequestSpecBuilder()
            .setContentType(ContentType.JSON)
            .setBaseUri(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/</span><span class="delimiter">&quot;</span></span>)
            .build();</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_why_integration_with_cube"><a class="anchor" href="#_why_integration_with_cube"></a>16.1. Why integration with Cube?</h3>
<div class="paragraph">
<p>Previous approach works but it has some problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You need to repeat the same configuration properties in all tests you want to use Rest-Assured with Docker.</p>
</li>
<li>
<p>Requires some development interference of the developer, if it is running in docker machine one <em>ip</em> must be set which might change in the future,
or changed to <em>localhost</em> if running on native linux.</p>
</li>
<li>
<p>Any change on Rest-Assured configuration properties would make all tests fails.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To fix these problems, you can use Arquillian Cube Docker RestAssured integration which creates a <code>RequestSpecBuilder</code>
with correct values set.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_3"><a class="anchor" href="#_configuration_3"></a>16.2. Configuration</h3>
<div class="sect3">
<h4 id="_dependencies"><a class="anchor" href="#_dependencies"></a>16.2.1. Dependencies</h4>
<div class="paragraph">
<p>To use Arquillian Cube RestAssured integration you only need to add as dependency.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
     <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
     <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-docker-restassured<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_parameters"><a class="anchor" href="#_configuration_parameters"></a>16.2.2. Configuration Parameters</h4>
<div class="paragraph">
<p>By default, if your scenario is not complex you don&#8217;t need to configure anything else, but this extension also contains some configuration parameters that can be used.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 22.2222%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">baseUri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;schema&gt;://&lt;dockerhost&gt;</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>It is the base uri used in RestAssured. You can set a specific value or not set and let extension configure it by
default using auto-resolution system.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">schema</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Schema used in case of auto-resolution of baseUri</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If from all running containers there is only one binding port (notice that exposed ports are not bound if not specified),
then this is the value used. If there are more than one binding port then an exception is thrown.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Port to be used for communicating with docker host. By default, this port must be the exposed port used in port binding.
The extension will resolve for given exposed port which is the binding port. If it is not found then exposed port will
be assumed as binding port too. For example using -p 8080:80 you need to set this property to 80 and extension will resolve to 8080.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">exclusionContainers</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If you want to use auto-resolution of the port attribute you might want to exclude that extension searches for binding
ports in some containers (for example monitoring containers). This is a CSV property to set container names of al of them.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">basePath</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Base path (context) of the application</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useRelaxedHttpsValidation</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Configures RestAssured to use relaxed https validation. If attribute is present but with no value then it is applied to
all protocols. If you put a string, only this protocol will be applied the relaxed rules.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authenticationScheme</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Sets the authentication scheme. Possible values are:
* <code>basic:username:password</code> for basic auth.
* <code>form:username:password</code> for from auth.
* <code>preemptive:username:password</code>.
* <code>certificate:url:password</code> for cert auth.
* <code>digest:username:password</code> for digest auth.
* <code>oauth:consumerKey:consumerSecret:accessToken:secretToken</code> for oauth 1.
* <code>oauth2:accessToken</code> for oauth 2.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">restassured</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>80<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You can set any extension property using system properties or environment variables, this can be really helpful in case of setting authentication scheme and sensitive data. For example <code>arq.extension.restassured.basePath=helloworld</code> for setting <code>basePath</code> property.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also use <code>@DockerUrl</code> enrichment for configuring the <code>RequestSpecBuilder</code> instead of relaying to <code>arquillian.xml</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DockerUrl</span>(containerName = <span class="string"><span class="delimiter">&quot;</span><span class="content">pingpong</span><span class="delimiter">&quot;</span></span>, exposedPort = <span class="integer">8080</span>)
<span class="annotation">@ArquillianResource</span>
RequestSpecBuilder requestSpecBuilder;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_3"><a class="anchor" href="#_example_3"></a>16.2.3. Example</h4>
<div class="paragraph">
<p>After setting the dependency and configuring the extension, if required you can write your Arquillian Cube test as
usually and use RestAssured without configuring it.</p>
</div>
<div class="paragraph">
<p>For example, with the following docker compose file which starts a <code>ping-pong</code> server listening at root context:</p>
</div>
<div class="listingblock">
<div class="title">docker-compose.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">helloworld</span>:
  <span class="key">image</span>: <span class="string"><span class="content">tsongpon/pingpong</span></span>
  <span class="key">ports</span>:
    - <span class="string"><span class="delimiter">&quot;</span><span class="content">8080:8080</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>you only need to do:</p>
</div>
<div class="listingblock">
<div class="title">PingPongTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Arquillian.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">PingPongTest</span> {

    <span class="annotation">@ArquillianResource</span>
    <span class="annotation">@DockerUrl</span>(containerName = <span class="string"><span class="delimiter">&quot;</span><span class="content">helloworld</span><span class="delimiter">&quot;</span></span>, exposedPort = <span class="integer">8080</span>)
    RequestSpecBuilder requestSpecBuilder;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_receive_ok_message() <span class="directive">throws</span> <span class="exception">MalformedURLException</span>, <span class="exception">InterruptedException</span> {
        RestAssured
            .given()
            .spec(requestSpecBuilder.build())
            .when()
            .get()
            .then()
            .assertThat().body(<span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>, equalTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span>));
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that no <em>ip</em> nor <em>port</em> configuration are required since everything is managed and configured by Cube.</p>
</div>
<div class="paragraph">
<p>You can see full example at: <a href="https://github.com/arquillian/arquillian-cube/tree/main/docker/ftest-restassured" class="bare">https://github.com/arquillian/arquillian-cube/tree/main/docker/ftest-restassured</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_arquillian_reporter_integration"><a class="anchor" href="#_arquillian_reporter_integration"></a>17. Arquillian Reporter integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Arquillian Reporter (<a href="https://github.com/arquillian/arquillian-reporter" class="bare">https://github.com/arquillian/arquillian-reporter</a>) project brings neat reports of your Arquillian tests.</p>
</div>
<div class="paragraph">
<p>Check Arquillian Reporter website to see the kind of reports you can generate and how to configure it.</p>
</div>
<div class="paragraph">
<p>Arquillian Cube integrates with Arquillian Reporter to use the reports and provide some information about the Cube
environment.</p>
</div>
<div class="paragraph">
<p>To integrate Cube with Reporter, you only need to add arquillian reporter&#8217;s depchain dependency:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.reporter<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-reporter-depchain<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>${version.arquillian.reporter}<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After that all <strong>cubes</strong> information will be added in the report.
Cubes are elements that are deployed into a system, for example a Pod or a Docker container.</p>
</div>
<div class="paragraph">
<p>For example, in the case of a Docker Cube start and stop duration time wil be reported, whether the container execution
failed or not, and some container properties like ports, links, image name, entrypoint, network, etc.</p>
</div>
<div class="sect2">
<h3 id="_arquillian_cube_docker_reporter_2"><a class="anchor" href="#_arquillian_cube_docker_reporter_2"></a>17.1. Arquillian Cube Docker Reporter</h3>
<div class="paragraph">
<p>In the previous section you&#8217;ve read that by just adding reporter dependency, you&#8217;ll get integration between Cube and
Reporter, and some information about <strong>cubes</strong> (for example a docker container) is reported.</p>
</div>
<div class="paragraph">
<p>But sometimes you need more information about the system, rather than on individual <strong>cubes</strong>.
For this reason a Docker Cube-Reporter integration exists, that adds specific information to the report about
environment peculiarities, like the composition used during deployment or the docker host information.</p>
</div>
<div class="paragraph">
<p>For this reason if you add next dependency too:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-docker-reporter<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Information about the docker host and docker compositions will be added to the report.</p>
</div>
</div>
<div class="sect2">
<h3 id="_arquillian_cube_docker_drone_integration"><a class="anchor" href="#_arquillian_cube_docker_drone_integration"></a>17.2. Arquillian Cube Docker Drone Integration</h3>
<div class="paragraph">
<p>In <a href="#_cube_docker_dronegraphene_integration">Cube Docker Drone/Graphene Integration</a> you&#8217;ve read that you can execute web UI tests inside a docker container,
which contains the browser.
Also, a screencast is recorded, so that you can review lately what has happened inside the container.</p>
</div>
<div class="paragraph">
<p>If you add the aforementioned dependencies, i.e. <code>arquillian-cube-docker-reporter</code> and <code>arquillian-reporter-depchain</code> to
a Cube Docker Drone project, then the report will contain the screencasts as well, for you to display them directly
within the report the recordings.</p>
</div>
</div>
<div class="sect2">
<h3 id="_arquillian_cube_docker_restassured_integration"><a class="anchor" href="#_arquillian_cube_docker_restassured_integration"></a>17.3. Arquillian Cube Docker RestAssured Integration</h3>
<div class="paragraph">
<p>If you add <code>arquillian-cube-docker-reporter</code> and <code>arquillian-reporter-depchain</code> in a Cube Docker RestAssured project,
then the report will contain the request and response logs for all test methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="_arquillian_cube_kubernetes_reporter_2"><a class="anchor" href="#_arquillian_cube_kubernetes_reporter_2"></a>17.4. Arquillian Cube Kubernetes Reporter</h3>
<div class="paragraph">
<p>There is an Arquillian Cube Kubernetes Reporter integration that provides report data about resources configuration
and the Kubernetes session i.e. Namespace, Master URL, Replication Controllers, Pods, Services etc.</p>
</div>
<div class="paragraph">
<p>For this integration to work the following dependencies must be added:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-kubernetes-reporter<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.reporter<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-reporter-depchain<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>${version.arquillian.reporter}<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examples"><a class="anchor" href="#_examples"></a>17.5. Examples</h3>
<div class="paragraph">
<p>Arquillian Cube Docker Reports: <a href="https://github.com/arquillian/arquillian-cube/tree/main/docker/ftest-reporter" class="bare">https://github.com/arquillian/arquillian-cube/tree/main/docker/ftest-reporter</a></p>
</div>
<div class="paragraph">
<p>Arquillian Cube Docker Drone Reports: <a href="https://github.com/arquillian/arquillian-cube/tree/main/docker/ftest-drone-reporter" class="bare">https://github.com/arquillian/arquillian-cube/tree/main/docker/ftest-drone-reporter</a></p>
</div>
<div class="paragraph">
<p>Arquillian Cube Kubernetes Reports: <a href="https://github.com/arquillian/arquillian-cube/tree/main/kubernetes/ftest-kubernetes-reporter" class="bare">https://github.com/arquillian/arquillian-cube/tree/main/kubernetes/ftest-kubernetes-reporter</a></p>
</div>
<div class="paragraph">
<p>Arquillian Reporter for more information: <a href="https://github.com/arquillian/arquillian-reporter" class="bare">https://github.com/arquillian/arquillian-reporter</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_polyglot_applications"><a class="anchor" href="#_polyglot_applications"></a>18. Polyglot Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In previous section we have seen that we can test any <em>java</em> <em>CLI</em> application that offers a socket connection.
But if you think clearly there is nothing that avoid <strong>Arquillian Cube</strong> to deploy applications developed in other languages like <em>Node.js</em>, <em>Play</em>, <em>Ruby on Rails</em>, &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see an example on how you can use <strong>Arquillian Cube</strong> to test a <em>Node.js</em> <em>hello world</em> application.</p>
</div>
<div class="paragraph">
<p>The first thing to do is to create the <em>Node.js</em> application.</p>
</div>
<div class="listingblock">
<div class="title">src/main/js/package.json</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">helloworld-server</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0.0.1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">A NodeJS webserver to run inside a docker container</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">asotobu@gmail.com</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">license</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">APLv2</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">dependencies</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">express</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">scripts</span><span class="delimiter">&quot;</span></span>: {<span class="key"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">node index.js</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/js/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> express = require(<span class="string"><span class="delimiter">'</span><span class="content">express</span><span class="delimiter">'</span></span>);

<span class="keyword">var</span> app = express();

app.get(<span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(req, res){
  res.send(<span class="string"><span class="delimiter">'</span><span class="content">Hello from inside a container!</span><span class="delimiter">'</span></span>);
});

app.listen(<span class="integer">8080</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we need to define a DockerfileTemplate as we did for Undertow.</p>
</div>
<div class="listingblock">
<div class="title">src/test/resources/node/DockerfileTemplate</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">FROM node:<span class="float">0.11</span><span class="float">.14</span>

RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app

ADD <span class="error">$</span>{deployableFilename} /usr/src/app <i class="conum" data-value="1"></i><b>(1)</b>
RUN npm install
EXPOSE <span class="integer">8080</span>

CMD [ <span class="string"><span class="delimiter">&quot;</span><span class="content">npm</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span> ]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We need to use the ADD command adding the deployed file instead of COPY. We are going to see why below.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, the arquillian.xml configuration file:</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="tag">&lt;arquillian</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://jboss.org/schema/arquillian</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://jboss.org/schema/arquillian</span>
  <span class="content">http://jboss.org/schema/arquillian/arquillian_1_0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

  <span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">docker</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverVersion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>1.12<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverUri</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>http://localhost:2375<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dockerContainers</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        node:
          buildImage:
            dockerfileLocation: src/test/resources/node
            noCache: true
            remove: true
          await:
            strategy: polling
          portBindings: [8080/tcp]
    <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/extension&gt;</span>

  <span class="tag">&lt;container</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">containerless</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">containerlessDocker</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>node<span class="tag">&lt;/property&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">embeddedPort</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>8080<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
  <span class="tag">&lt;/container&gt;</span>

<span class="tag">&lt;/arquillian&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This property is used to set which container must be started. In this case node.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If <em>containerless</em> definition only contains one image, it is not necessary to use <em>containerlessDocker</em> property.
Similarly, if the image only exposes one port, it is not necessary to use <em>embeddedPort</em> proeprty to set the port.
So in previous example you could avoid using <em>containerlessDocker</em> and <em>embeddedPort</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And finally the <strong>Arquillian</strong> test.</p>
</div>
<div class="listingblock">
<div class="title">NodeTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Arquillian.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">NodeTest</span> {

  <span class="annotation">@Deployment</span>(testable = <span class="predefined-constant">false</span>) <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="directive">public</span> <span class="directive">static</span> GenericArchive createDeployment() {
    <span class="keyword">return</span> ShrinkWrap.create(GenericArchive.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">app.tar</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
            .add(<span class="keyword">new</span> ClassLoaderAsset(<span class="string"><span class="delimiter">&quot;</span><span class="content">index.js</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">index.js</span><span class="delimiter">&quot;</span></span>)
            .add(<span class="keyword">new</span> ClassLoaderAsset(<span class="string"><span class="delimiter">&quot;</span><span class="content">package.json</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">package.json</span><span class="delimiter">&quot;</span></span>);
  }

  <span class="annotation">@Test</span>
  <span class="directive">public</span> <span class="type">void</span> shouldReturnMessageFromNodeJs(<span class="annotation">@ArquillianResource</span> <span class="predefined-type">URL</span> base) { <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="keyword">try</span> (<span class="predefined-type">BufferedReader</span> in = <span class="keyword">new</span> <span class="predefined-type">BufferedReader</span>(<span class="keyword">new</span> <span class="predefined-type">InputStreamReader</span>(
            base.openStream()));) {
        <span class="predefined-type">String</span> userInput = in.readLine();
        assertThat(userInput, is(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello from inside a container!</span><span class="delimiter">&quot;</span></span>));
    } <span class="keyword">catch</span> (<span class="exception">UnknownHostException</span> e) {
        fail(<span class="string"><span class="delimiter">&quot;</span><span class="content">Don't know about host </span><span class="delimiter">&quot;</span></span>);
    } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) {
        fail(<span class="string"><span class="delimiter">&quot;</span><span class="content">Couldn't get I/O for the connection to </span><span class="delimiter">&quot;</span></span>);
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Tests should be run as-client.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>GenericArchive with tar extension must be created using <em>Shrinkwrap</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Simple test.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
GenericArchive must end with tar extension because it is expected by <strong>Arquillian Cube</strong>.
When you use ADD in Dockerfile, <em>Docker</em> will <em>untar</em> automatically the file to given location.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kubernetes"><a class="anchor" href="#_kubernetes"></a>19. Kubernetes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The kubernetes extension helps you write and run integration tests for your Kubernetes/Openshift application.</p>
</div>
<div class="sect2">
<h3 id="_overview"><a class="anchor" href="#_overview"></a>19.1. Overview</h3>
<div class="paragraph">
<p>This extension will create and manage one temporary namespace for your tests, apply all Kubernetes resources required to
create your environment and once everything is ready it will run your tests. The tests will be enriched with resources
required to access services. Finally, when testing is over it will clean everything up.</p>
</div>
<div class="paragraph">
<p>In addition to the main testing namespace, additional secondary namespaces could be used during testing. Arquillian Cube
would not modify them, but tests could be enriched with resources from secondary namespaces to access services in them
in case you need to verify changes made by services you are testing.</p>
</div>
<div class="paragraph">
<p>This extension  will neither mutate your containers <strong>(by deploying, reconfiguring, etc.)</strong> nor your Kubernetes resources
and takes a black box approach to testing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_modules"><a class="anchor" href="#_modules"></a>19.2. Modules</h3>
<div class="paragraph">
<p>The main modules of this extension are the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kubernetes</p>
</li>
<li>
<p>Openshift</p>
</li>
<li>
<p>Fabric8 Kubernetes Client integration</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_features"><a class="anchor" href="#_features"></a>19.3. Features</h3>
<div class="ulist">
<ul>
<li>
<p>Hybrid <strong>(in or out of Kubernetes/Openshift)</strong></p>
</li>
<li>
<p>Advanced namespace management</p>
</li>
<li>
<p>Dependency management <strong>(for Maven based projects)</strong></p>
</li>
<li>
<p>Auto align with Docker Registry</p>
</li>
<li>
<p>Enrichers for:</p>
<div class="ulist">
<ul>
<li>
<p>Kubernetes/Openshift client</p>
</li>
<li>
<p>Pods</p>
</li>
<li>
<p>Replication Controllers</p>
</li>
<li>
<p>Services</p>
</li>
</ul>
</div>
</li>
<li>
<p>Integration with <a href="https://eclipse.dev/jkube/docs/kubernetes-maven-plugin/">JKube Kubernetes Maven Plugin</a></p>
</li>
<li>
<p>Integration with <a href="https://eclipse.dev/jkube/docs/openshift-maven-plugin/">JKube OpenShift Maven Plugin</a></p>
</li>
<li>
<p>"Bring your own client" support</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_pre_requisites"><a class="anchor" href="#_pre_requisites"></a>19.4. Pre-requisites</h3>
<div class="ulist">
<ul>
<li>
<p>To use kubernetes extension, your host should provide a running kubernetes cluster.</p>
</li>
<li>
<p>To use openshift extension, your host should provide a running openshift cluster.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_setup"><a class="anchor" href="#_setup"></a>19.5. Setup</h3>
<div class="paragraph">
<p>To use Kubernetes extension you need to register next dependency in your build tool: <code>org.arquillian.cube:arquillian-cube-kubernetes:$2.0.0.Final</code>.</p>
</div>
<div class="paragraph">
<p>To use OpenShift extension you need to register next dependency in your build tool: <code>org.arquillian.cube:arquillian-cube-openshift:$2.0.0.Final</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_the_extension"><a class="anchor" href="#_configuring_the_extension"></a>19.6. Configuring the extension</h3>
<div class="paragraph">
<p>The plugin can be configured using the traditional <code>arquillian.xml</code>, via system properties or environment variables
(in that particular order).
This means that for every supported configuration parameter, the <code>arquillian.xml</code> file will be looked up first, and if
it doesn&#8217;t contain an entry, then the system properties will be used.
If no result has been found so far, the environment variables will be used.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> When checking for environment variables, property names will get capitalized, and symbols like "." will be
converted to "_".
For example <strong>foo.bar.baz</strong> will be converted to <strong>FOO_BAR_BAZ</strong>.</p>
</div>
<div class="sect3">
<h4 id="_kubernetes_configuration_parameters"><a class="anchor" href="#_kubernetes_configuration_parameters"></a>19.6.1. Kubernetes Configuration Parameters</h4>
<div class="paragraph">
<p>You can configure Kubernetes by using any of the following configuration properties in <code>arquillian.xml</code>.</p>
</div>
<div class="listingblock">
<div class="title">src/test/resources/arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">kubernetes</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Options</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Env</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kubernetes.master</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL to the Kubernetes master</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cube.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username to log in server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cube.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password to log in server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cube.auth.token</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bearer token for authentication to the API server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cube.api.version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String(v1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version for API server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cube.trust.certs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean(true)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean to trust Certificate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kubernetes.domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain to use for creating routes for services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">docker.registry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The docker registry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace.use.current</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean (false)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don&#8217;t generate a testing namespace use the current instead</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace.use.existing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don&#8217;t generate a testing namespace use the specified one instead</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace.prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String (itest)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you don&#8217;t specify a testing namespace, a random one will be
created, with this prefix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace.lazy.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool (true)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the specified testing namespace be created if not exists,
or throw exception?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace.destroy.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool (true)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to destroy the testing namespace after the end of the test
suite</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace.destroy.confirm.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool (false)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to ask for confirmation to delete the testing namespace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace.destroy.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time to wait before destroying the testing namespace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace.cleanup.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool (true)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to clean (delete resources) the testing namespace after the
end of the test suite</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace.cleanup.confirm.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool (false)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to ask for confirmation to clean the testing namespace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace.cleanup.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time to wait when cleaning up the testing namespace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env.init.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool (true)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to initialize the environment (apply kubernetes
resources)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env.config.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL to the Kubernetes JSON/YAML (defaults to classpath
resource kubernetes.json)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env.config.resource.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Option to select a different classpath resource (other
than kubernetes.json)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env.setup.script.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Option to select a shell script that will setup the
environment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env.teardown.script.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Option to select a shell script to tear down / cleanup
the environment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env.dependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-separated list of URLs to more environment dependencies
kubernetes.json</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wait.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool (true)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to wait until the env is ready</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wait.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long (5mins)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The total amount of time to wait until the env is ready</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wait.poll.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long (5secs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The poll interval to use for checking if the environment
is ready</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wait.for.service.list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-separated list of additional services to wait upon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ansi.logger.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool (true)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to enable colorful output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kubernetes.client.creator.class.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool (true)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fully qualified class name of a kubernetes client
creator class (byon)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logs.copy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool (false)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to capture the pods logs and save them into the
filesystem - as individual files, one for each pod. Filenames will be "ClassName-[MethodName-]-PodName[-ContainerName].log".
If the pod has multiple containers, one log file for each container will be created. Kubernetes events (<code>kubectl get events</code>)
will also be captured if this flag is enabled. Filenames will end with <code>-KUBE_EVENTS.log</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logs.path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory where to save the pods logs. Defaults to "target/surefire-reports".</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_openshift_configuration_parameters"><a class="anchor" href="#_openshift_configuration_parameters"></a>19.6.2. Openshift Configuration Parameters</h4>
<div class="paragraph">
<p>When using OpenShift you can use <code>arquillian.xml</code> to configure ANY of the configuration properties introduced at <a href="#_kubernetes_configuration_parameters">Kubernetes Configuration Parameters</a> mixed with some specific configuration parameters related to OpenShift.
For OpenShift, you need to use the <code>openshift</code> qualifier instead of <code>kubernetes</code>, but as noticed in previous paragraph
you can use it to set any Kubernetes configuration parameters as well.</p>
</div>
<div class="listingblock">
<div class="title">src/test/resources/arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">openshift</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Env</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoStartContainers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma Separated List of Pods which you want to auto
start</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">definitionsFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definitions file path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxiedContainerPorts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma Separated List following Pod:containerPort OR
Pod:MappedPort:ContainerPort</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableImageStreamDetection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool (true)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable detecting ImageStream resources located at target/XXX-is.(json/yaml)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">portForwardBindAddress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String (127.0.0.1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If using port forwarding you can set the host</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL where template is stored. This template is executed before any execution</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateLabels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CSV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets a comma separated value of template labels in form &lt;key&gt;=&lt;value&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateParameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CSV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets a comma separated value of template parameters in form &lt;key&gt;=&lt;value&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool (true)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets if templates must be processed or not</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">awaitRouteRepetitions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int (1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>@AwaitRoute</code> is used, this option specifies how many times in a row
the route must respond successfully to be considered available; useful in environments where the route intermittently fails for a short while at the beginning</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_openshift_dns_naming_service"><a class="anchor" href="#_openshift_dns_naming_service"></a>19.6.3. Openshift DNS Naming Service</h4>
<div class="paragraph">
<p>The OpenShift module provides an easy way to run tests against your public application&#8217;s route.
The Arquillian Naming Service allows you to run tests annotated with @RunsAsClient without adding the routes
manually to your /etc/hosts to make the host name resolvable. The arquillian Cube generates a custom namespaces prefix
that will be used to define the application&#8217;s route when running your tests against an OpenShift instance, even if you
specify a namespace manually it will be transparent and the application&#8217;s endpoint will be resolvable within your java
tests.</p>
</div>
<div class="paragraph">
<p>To use it, you need to set up your tests to use the ArquillianNameService, which you must install via the
<code>INameService.install(new ArqCubeNameService())</code> call, as in the following example:</p>
</div>
<div class="listingblock">
<div class="title">SomethingCoolTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Before</span>
<span class="directive">public</span> <span class="type">void</span> prepareEnv() <span class="directive">throws</span> <span class="exception">NoSuchFieldException</span>, <span class="exception">ClassNotFoundException</span>, <span class="exception">IllegalAccessException</span> {
    INameService.install(<span class="keyword">new</span> ArqCubeNameService());
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_openshift_annotations"><a class="anchor" href="#_openshift_annotations"></a>19.6.4. OpenShift Annotations</h4>
<div class="paragraph">
<p>The OpenShift extension comes with some annotations that let you define resources at the test level rather than globally.</p>
</div>
<div class="sect4">
<h5 id="_template"><a class="anchor" href="#_template"></a><code>@Template</code></h5>
<div class="paragraph">
<p>A template describes a set of objects that can be parameterized and processed to produce a list of resources for
creation by OpenShift.</p>
</div>
<div class="paragraph">
<p>You can set a template location viaa a configuration parameter or using <code>@Template</code> annotation at class level.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a small example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Category</span>(RequiresOpenshift.class)
<span class="annotation">@RequiresOpenshift</span>
<span class="annotation">@RunWith</span>(ArquillianConditionalRunner.class)
<span class="annotation">@Template</span>(url = <span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:hello-openshift.yaml</span><span class="delimiter">&quot;</span></span>,
          parameters = <span class="annotation">@TemplateParameter</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">RESPONSE</span><span class="delimiter">&quot;</span></span>, value = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello from Arquillian Template</span><span class="delimiter">&quot;</span></span>))
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldTemplateIT</span> {

    <span class="annotation">@RouteURL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello-openshift-route</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@AwaitRoute</span>
    <span class="directive">private</span> <span class="predefined-type">URL</span> url;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_create_class_template_resources() <span class="directive">throws</span> <span class="exception">IOException</span> {
        verifyResponse(url);
    }

    <span class="annotation">@Test</span>
    <span class="annotation">@Template</span>(url = <span class="string"><span class="delimiter">&quot;</span><span class="content">https://gist.githubusercontent.com/dipak-pawar/403b870fc92f6569f64f12b506318606/raw/4dd7cd4b259f893353509411ba4777792cacd034/hello_openshift_route_template.yaml</span><span class="delimiter">&quot;</span></span>,
        parameters = <span class="annotation">@TemplateParameter</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">ROUTE_NAME</span><span class="delimiter">&quot;</span></span>, value = <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-openshift-method-route</span><span class="delimiter">&quot;</span></span>))
    <span class="directive">public</span> <span class="type">void</span> should_create_method_template_resources(
        <span class="annotation">@RouteURL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello-openshift-method-route</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@AwaitRoute</span> <span class="predefined-type">URL</span> routeUrl)
        <span class="directive">throws</span> <span class="exception">IOException</span> {
        verifyResponse(routeUrl);
    }

    <span class="directive">private</span> <span class="type">void</span> verifyResponse(<span class="predefined-type">URL</span> url) <span class="directive">throws</span> <span class="exception">IOException</span> {
        assertThat(url).isNotNull();

        RestAssured.given()
            .when()
            .get(url)
            .then()
            .assertThat()
            .statusCode(<span class="integer">200</span>)
            .body(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello from Arquillian Template</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, in <code>@Template</code>, url can be set using <code>url = <a href="https://git.io/vNRQm" class="bare">https://git.io/vNRQm</a></code> or using
<code>url = "classpath:hello-openshift.yaml"</code> if template is on Test class path.</p>
</div>
</div>
<div class="sect4">
<h5 id="_openshiftresource"><a class="anchor" href="#_openshiftresource"></a><code>@OpenShiftResource</code></h5>
<div class="paragraph">
<p>You can apply OpenShift resources files before test execution.
Usually, this is a suitable way for creating non-first-citizen resources, like service accounts, credentials, routes, etc.</p>
</div>
<div class="paragraph">
<p>The value can either be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>link (<a href="https://www.github.com/alesj/template-testing/some.json" class="bare">https://www.github.com/alesj/template-testing/some.json</a>)</p>
</li>
<li>
<p>test classpath resource (classpath:some.json)</p>
</li>
<li>
<p>or plain content ({"kind" : "Secret", &#8230;&#8203;}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use <code>@OpenShiftResource</code> either at class level - which implies that the resource is created before test class execution
and then deleted after the same test class execution - or at method level, which implies that resources are created and
deleted after each test method execution.</p>
</div>
<div class="paragraph">
<p>You can see an example of OpenShift resources usage at <a href="https://github.com/arquillian/arquillian-cube/blob/master/openshift/ftest-openshift-resources-standalone/src/test/java/org/arquillian/cube/openshift/standalone/HelloWorldOpenShiftResourcesIT.java" class="bare">https://github.com/arquillian/arquillian-cube/blob/master/openshift/ftest-openshift-resources-standalone/src/test/java/org/arquillian/cube/openshift/standalone/HelloWorldOpenShiftResourcesIT.java</a></p>
</div>
</div>
<div class="sect4">
<h5 id="_openshiftdynamicimagestreamresource"><a class="anchor" href="#_openshiftdynamicimagestreamresource"></a><code>@OpenShiftDynamicImageStreamResource</code></h5>
<div class="paragraph">
<p>The <code>@OpenShiftResource</code> annotation makes it possible to add image stream definitions. To run some specific tests
we need to be able to override the image stream definition and point to the container image we want to test.
Very often these images are stored in insecure registries and the tags applied are different (in many cases newer)
than expected by the original image stream definition.</p>
</div>
<div class="paragraph">
<p>For this purpose the <code>@OpenShiftDynamicImageStreamResource</code> was created. We can create an image stream definition
by providing only required information, without the need to construct the JSON or YAML object expected by OpenShift.
Required resource will be created dynamically and deployed in OpenShift together with other resources.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Image stream name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Image stream version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>image</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Image name with registry and tag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>insecure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the registry is insecure, by default <code>true</code></p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">OpenShiftDynamicImageStreamResourceTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@RunWith</span>(Arquillian.class)
    <span class="annotation">@Template</span>(url = <span class="string"><span class="delimiter">&quot;</span><span class="content">https://raw.githubusercontent.com/${template.repository:jboss-openshift}/application-templates/${template.branch:master}/eap/eap71-sso-s2i.json</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@OpenShiftDynamicImageStreamResource</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">${imageStream.eap64.name:jboss-eap64-openshift}</span><span class="delimiter">&quot;</span></span>, image = <span class="string"><span class="delimiter">&quot;</span><span class="content">${imageStream.eap64.image:registry.access.redhat.com/jboss-eap-6/eap64-openshift:1.8}</span><span class="delimiter">&quot;</span></span>, version = <span class="string"><span class="delimiter">&quot;</span><span class="content">${imageStream.eap64.version:1.8}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">class</span> <span class="class">OpenShiftDynamicImageStreamResourceTest</span> {

      <span class="annotation">@Test</span>
      <span class="directive">public</span> <span class="type">void</span> testStuff() <span class="directive">throws</span> <span class="exception">Exception</span> {
       <span class="comment">//Do stuff...</span>
      }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_namespaces"><a class="anchor" href="#_namespaces"></a>19.7. Namespaces</h3>
<div class="paragraph">
<p>The default behavior of the extension is to create a unique testing namespace per test suite. The namespace is created
Before the suite is started and destroyed in the end.
For debugging purposes, you can set the <strong>namespace.cleanup.enabled</strong> and <strong>namespace.destroy.enabled</strong>  to false and
keep the testing namespace around.</p>
</div>
<div class="paragraph">
<p>In other cases you may find it useful to manually create and manage the environment rather than having <strong>Arquillian</strong>
do that for you.
In this case you can use the <strong>namespace.use.existing</strong> option to select an existing testing namespace.
This option goes hand in hand with <strong>env.init.enabled</strong> which can be used to prevent the extension from modifying
the environment.</p>
</div>
<div class="paragraph">
<p>Last but not least, you can just tell <strong>Arquillian</strong> that you are going to use the current namespace as testing namespace.
In this case, arquillian cube will delegate to
<a href="https://github.com/fabric8io/kubernetes-client/">Kubernetes Client</a> that in turn will use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>~/.kube/config</code></p>
</li>
<li>
<p><code>/var/run/secrets/kubernetes.io/serviceaccount/namespace</code></p>
</li>
<li>
<p>the <code>KUBERNETES_NAMESPACE</code> environment variable</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>to determine the current testing namespace.</p>
</div>
<div class="paragraph">
<p>In addition to the primary testing namespace a number of secondary namespaces could participate in tests, but only as
a possible location of resources needed to be accessed during tests, usually with verifying purpose. When the service
you are testing made some changes in state of services in another namespaces, you can specify the secondary
namespace in a field of <code>@Named</code> annotation to reach them.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Necessary configuration to avoid permission conflicts for creating namespaces.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When using <code>Minishift</code> to spin up a local Kubernetes cluster, login in as <code>admin</code> to create the default namespace or
use <code>current</code> or <code>existing</code> namespace configured using properties <code>namespace.use.current</code> and <code>namespace.use.existing</code>
respectively if logged in as any other user.</p>
</li>
<li>
<p>In case of remote cluster use <code>current</code> or <code>existing</code> namespace for the user authenticated by token using property
<code>cube.auth.token</code> or by username and password using properties <code>cube.username</code> and <code>cube.password</code> respectively. The
properties can be set in <code>arquillian.xml</code> as shown in the snippet below or as system properties with the latter taking precedence.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- configuring remote cluster --&gt;</span>

<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namespace.use.existing</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>existing-namespace<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">kubernetes.master</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>https://api.yourcluster.openshift.com<span class="tag">&lt;/property&gt;</span>

<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cube.auth.token</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>token<span class="tag">&lt;/property&gt;</span>
<span class="comment">&lt;!-- OR --&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cube.username</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>username<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cube.password</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>password<span class="tag">&lt;/property&gt;</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_creating_the_environment"><a class="anchor" href="#_creating_the_environment"></a>19.8. Creating the environment</h3>
<div class="paragraph">
<p>After creating or selecting an existing namespace, the next step is the environment preparation. This is the stage
where all the required Kubernetes configuration will be applied.</p>
</div>
<div class="sect3">
<h4 id="_how_to_run_kubernetes_with_multiple_configuration_files"><a class="anchor" href="#_how_to_run_kubernetes_with_multiple_configuration_files"></a>19.8.1. How to run kubernetes with multiple configuration files?</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Out of the box, the extension will use the classpath and try to find a resource named <strong>kubernetes.json</strong> or
<strong>kubernetes.yaml</strong>. The name of the resource can be changed using the <strong>env.config.resource.name</strong>.
Of course, it is also possible to specify an external resource by URL using the <strong>env.config.url</strong>.</p>
</li>
<li>
<p>While finding resource in classpath with property <strong>env.config.resource.name</strong>, cube will look into classpath
with given name, if not found, then cube will continue to look into classpath under META-INF/fabric8/ directory.
Using this you can put multiple resources(openshift.json, openshift.yml) inside META-INF/fabric8, and choose only
required one by specifying <strong>env.config.resource.name</strong> property.</p>
</li>
<li>
<p>Either way, it is possible that the kubernetes configuration used, depends on other configurations. It is also
possible that your environment configuration is split in multiple files.
To cover cases like this the <strong>env.dependencies</strong> is provided which accepts a comma-separated list of URLs.</p>
</li>
<li>
<p>There are cases, where instead of specifying the resources, you want to specify some shell scripts that will setup
the environment. For those cases you can use the <strong>env.setup.script.url</strong> / <strong>env.teardown.script.url</strong> to pass the
scripts for setting up and tearing down the environment. Note that these scripts are going to be called right after the
namespace is created and cleaned up respectively.
Both scripts will be executed using visible environment variables the following:</p>
<div class="ulist">
<ul>
<li>
<p>KUBERNETES_MASTER</p>
</li>
<li>
<p>KUBERNETES_NAMESPACE</p>
</li>
<li>
<p>KUBERNETES_DOMAIN</p>
</li>
<li>
<p>DOCKER_REGISTRY</p>
</li>
<li>
<p>all host environment variables</p>
</li>
<li>
<p>all environment variables in arquillian.xml via env.script.env (as properties).</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>(You can use any custom URL provided the appropriate URL stream handler.)</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Out of the box mvn urls are supported, so you can use values like:
<strong>mvn:my.groupId/artifactId/1.0.0/json/kubernetes</strong> (work in progress)</p>
</div>
<div class="paragraph">
<p><strong>Also:</strong> If your project is using maven and dependencies like the above are expressed in the pom, the will be used
<strong>automatically</strong>. (work in progress)</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Arquillian Cube Kubernetes needs to authenticate into Kubernetes.
To do it, Cube reads from <code>~/.kube/config</code> user information (token, password).</p>
</div>
<div class="paragraph">
<p>For example in case of OpenShift you can use <code>oc login --username=admin --password=admin</code> for creating a token for
connecting as admin, or <code>oc config set-credentials myself --username=admin --password=admin</code> for statically adding the
username and password and communicate with Kubernetes to update the <code>~/.kube/config</code> file with the info provided.</p>
</div>
<div class="paragraph">
<p>You can read more about Kubernetes config file at <a href="http://kubernetes.io/docs/user-guide/kubectl/kubectl_config/" class="bare">http://kubernetes.io/docs/user-guide/kubectl/kubectl_config/</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_readiness_and_waiting"><a class="anchor" href="#_readiness_and_waiting"></a>19.9. Readiness and waiting</h3>
<div class="paragraph">
<p>Creating an environment does not guarantee its readiness. For example a Docker image may be required to get pulled by a
remote repository and this make take even several minutes.
Running a test against a Pod which is not Running state is pretty much pointless, so we need to wait until everything
is ready.</p>
</div>
<div class="paragraph">
<p>This extension will wait up to <strong>wait.timeout</strong> until everything is up and running. Everything? It will wait for all
Pods and Service <strong>(that were created during the test suite initialization)</strong> to become ready.
It will poll them every <strong>wait.poll.interval</strong> milliseconds. For services there is also the option to perform a simple
"connection test"  by setting the flag <strong>wait.for.service.connection.enabled</strong> to true.
In this case it will not just wait for the service to be ready, but also to be usable/connectable.</p>
</div>
</div>
<div class="sect2">
<h3 id="_immutable_infrastructure_and_integration_testing"><a class="anchor" href="#_immutable_infrastructure_and_integration_testing"></a>19.10. Immutable infrastructure and integration testing</h3>
<div class="paragraph">
<p>As mentioned in the overview, this extension will not try to deploy your tests, inside an application container.
It doesn&#8217;t need nor want to know what runs inside your docker containers, nor will try to mess with it.
It doesn&#8217;t even need to run inside Kubernetes (it can just run in your laptop and talk to the kubernetes master).</p>
</div>
<div class="paragraph">
<p>So what exactly is your test case going to test?</p>
</div>
<div class="paragraph">
<p>The test cases are meant to consume and test the provided services and assert that the environment is in the
expected state.</p>
</div>
<div class="paragraph">
<p>The test case may obtain everything it needs, by accessing the Kubernetes resources that are provided by the plugin as
@ArquillianResources (see resource providers below).</p>
</div>
</div>
<div class="sect2">
<h3 id="_resource_providers"><a class="anchor" href="#_resource_providers"></a>19.11. Resource Providers</h3>
<div class="paragraph">
<p>The resource providers available, can be used to inject to your test cases the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A kubernetes client as an instance of KubernetesClient</p>
</li>
<li>
<p>Session object that contains information (e.g. the testing namespace) or the uuid of the test session.</p>
</li>
<li>
<p>Deployments <strong>(by id or as a list of all deployments created during the session, optionally filtered by label)</strong></p>
</li>
<li>
<p>Pods <strong>(by id or as a list of all pods created during the session, optionally filtered by label)</strong></p>
</li>
<li>
<p>Replication Controllers <strong>(by id or as a list of all replication controllers created during the session, optionally
filtered by label)</strong></p>
</li>
<li>
<p>Replica Sets <strong>(by id or as a list of all replica sets created during the session, optionally filtered by label)</strong></p>
</li>
<li>
<p>Services <strong>(by id or as a list of all services created during the session, optionally filtered by label)</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Openshift extension also provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deployment Configs <strong>(by id or as a list of all deployment configs created during the session)</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here&#8217;s a small example:</p>
</div>
<div class="listingblock">
<div class="title">ExampleTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@RunWith</span>(Arquillian.class)
    <span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleTest</span> {

     <span class="annotation">@ArquillianResource</span>
     KubernetesClient client;

     <span class="annotation">@ArquillianResource</span>
     Session session;

      <span class="annotation">@Test</span>
      <span class="directive">public</span> <span class="type">void</span> testAtLeastOnePod() <span class="directive">throws</span> <span class="exception">Exception</span> {
       assertThat(client).pods().runningStatus().filterNamespace(session.getNamespace()).hasSize(<span class="integer">1</span>);
      }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The test code above, demonstrates how you can inject and use inside your test the <strong>KubernetesClient</strong> and the
<strong>Session</strong> object.
It also demonstrates the use of <strong>kubernetes-assertions</strong> which is a nice little library based on
<a href="http://assertj.org">assert4j</a> for performing assertions on top of the Kubernetes model.</p>
</div>
<div class="paragraph">
<p>Also, you can gather control of what to deploy, when to deploy or when to wait for resources readiness.
To control you need to inject into test the <code>org.arquillian.cube.kubernetes.impl.KubernetesAssistant</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(ArquillianConditionalRunner.class)
<span class="annotation">@Category</span>(RequiresKubernetes.class)
<span class="annotation">@RequiresKubernetes</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldKubernetesAssistantTest</span> {

    <span class="annotation">@ArquillianResource</span>
    <span class="directive">private</span> KubernetesAssistant kubernetesAssistant;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_inject_kubernetes_assistant() {
        assertThat(kubernetesAssistant).isNotNull();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_apply_route_programmatically() <span class="directive">throws</span> <span class="exception">IOException</span> {
        kubernetesAssistant.deployApplication(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>);                   <i class="conum" data-value="1"></i><b>(1)</b>
        Optional&lt;<span class="predefined-type">URL</span>&gt; serviceUrl = kubernetesAssistant.getServiceUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>);    <i class="conum" data-value="2"></i><b>(2)</b>

        given()
            .when()
            .get(serviceUrl.get())
            .then()
            .assertThat()
            .statusCode(<span class="integer">200</span>)
            .body(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello OpenShift!</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sets the application name where everything is deployed.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can get the url of the deployed service on the cluster.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next example is intended to show how you can inject a resource by id.</p>
</div>
<div class="listingblock">
<div class="title">ResourceByIdTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@RunWith</span>(Arquillian.class)
    <span class="directive">public</span> <span class="type">class</span> <span class="class">ResourceByIdTest</span> {

     <span class="annotation">@ArquillianResource</span>
     <span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-service</span><span class="delimiter">&quot;</span></span>)
     Service service;

     <span class="annotation">@ArquillianResource</span>
     <span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-pod</span><span class="delimiter">&quot;</span></span>)
     Pod pod;

     <span class="annotation">@ArquillianResource</span>
     <span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-contoller</span><span class="delimiter">&quot;</span></span>)
     ReplicationController controller;

      <span class="annotation">@Test</span>
      <span class="directive">public</span> <span class="type">void</span> testStuff() <span class="directive">throws</span> <span class="exception">Exception</span> {
       <span class="comment">//Do stuff...</span>
      }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next example is intended to show how you can inject a resource from secondary namespace.</p>
</div>
<div class="listingblock">
<div class="title">ResourceByIdInSecondaryNamespaceTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@RunWith</span>(Arquillian.class)
    <span class="directive">public</span> <span class="type">class</span> <span class="class">ResourceByIdInSecondaryNamespaceTest</span> {

     <span class="annotation">@ArquillianResource</span>
     <span class="annotation">@Named</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">my-service</span><span class="delimiter">&quot;</span></span>, namespace = <span class="string"><span class="delimiter">&quot;</span><span class="content">my-predefined-namespace</span><span class="delimiter">&quot;</span></span>)
     Service service;

     <span class="annotation">@ArquillianResource</span>
     <span class="annotation">@Named</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">my-pod</span><span class="delimiter">&quot;</span></span>, namespace = <span class="string"><span class="delimiter">&quot;</span><span class="content">my-predefined-namespace</span><span class="delimiter">&quot;</span></span>)
     Pod pod;

     <span class="annotation">@ArquillianResource</span>
     <span class="annotation">@Named</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">my-contoller</span><span class="delimiter">&quot;</span></span>, namespace = <span class="string"><span class="delimiter">&quot;</span><span class="content">my-predefined-namespace</span><span class="delimiter">&quot;</span></span>)
     ReplicationController controller;

      <span class="annotation">@Test</span>
      <span class="directive">public</span> <span class="type">void</span> testStuff() <span class="directive">throws</span> <span class="exception">Exception</span> {
       <span class="comment">//Do stuff...</span>
      }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next example shows how to inject a resource filtering by label.</p>
</div>
<div class="listingblock">
<div class="title">ResourceByLabelTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@RunWith</span>(Arquillian.class)
    <span class="directive">public</span> <span class="type">class</span> <span class="class">ResourceByLabelTest</span> {

     <span class="annotation">@ArquillianResource</span>
     <span class="annotation">@WithLabel</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>, value=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-app</span><span class="delimiter">&quot;</span></span>)
     Service service;

     <span class="annotation">@ArquillianResource</span>
     <span class="annotation">@WithLabel</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>, value=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-app</span><span class="delimiter">&quot;</span></span>)
     Pod pod;

     <span class="annotation">@ArquillianResource</span>
     <span class="annotation">@WithLabel</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>, value=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-app</span><span class="delimiter">&quot;</span></span>)
     ReplicationController controller;

      <span class="annotation">@Test</span>
      <span class="directive">public</span> <span class="type">void</span> testStuff() <span class="directive">throws</span> <span class="exception">Exception</span> {
       <span class="comment">//Do stuff...</span>
      }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next example is intended to how you can inject a resource list.</p>
</div>
<div class="listingblock">
<div class="title">ResourceListExample.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@RunWith</span>(Arquillian.class)
    <span class="directive">public</span> <span class="type">class</span> <span class="class">ResourceListExample</span> {

     <span class="annotation">@ArquillianResource</span>
     ServiceList services;

     <span class="annotation">@ArquillianResource</span>
     PodList pods;

     <span class="annotation">@ArquillianResource</span>
     ReplicationControllerList controllers;

      <span class="annotation">@Test</span>
      <span class="directive">public</span> <span class="type">void</span> testStuff() <span class="directive">throws</span> <span class="exception">Exception</span> {
       <span class="comment">//Do stuff...</span>
      }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s see how can you inject OpenShift Client Service.</p>
</div>
<div class="listingblock">
<div class="title">OpenshiftExample.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldTest</span> {


    <span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello-openshift-service</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@PortForward</span>
    <span class="annotation">@ArquillianResource</span>
    Service service;

    <span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello-openshift-service</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@PortForward</span>
    <span class="annotation">@ArquillianResource</span>
    <span class="predefined-type">URL</span> url;

    <span class="annotation">@Named</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">another-openshift-service</span><span class="delimiter">&quot;</span></span>, namespace = <span class="string"><span class="delimiter">&quot;</span><span class="content">my-predefined-namespace</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@PortForward</span>
    <span class="annotation">@ArquillianResource</span>
    Service anotherService;

    <span class="annotation">@Named</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">another-openshift-service</span><span class="delimiter">&quot;</span></span>, namespace = <span class="string"><span class="delimiter">&quot;</span><span class="content">my-predefined-namespace</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@PortForward</span>
    <span class="annotation">@ArquillianResource</span>
    <span class="predefined-type">URL</span> anotherUrl;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> service_instances_should_not_be_null() <span class="directive">throws</span> <span class="exception">Exception</span> {
        assertThat(service).isNotNull();
        assertThat(anotherService).isNotNull();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testStuff() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">//Do stuff...</span>
        <span class="comment">//Modify something with request to url...</span>
        <span class="comment">//Check results with request to anotherUrl...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case of OpenShift, test can be enriched with <code>OpenShiftClient</code>.</p>
</div>
<div class="listingblock">
<div class="title">OpenshiftExample.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldTest</span> {

    <span class="annotation">@ArquillianResource</span>
    OpenShiftClient client;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also you can gather control of what to deploy, when to deploy or  when to wait for resources readiness.
To control you need to inject into test the <code>org.arquillian.cube.openshift.impl.client.OpenShiftAssistant</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldOpenShiftAssistantTest</span> {

    <span class="annotation">@ArquillianResource</span>
    OpenShiftAssistant openShiftAssistant;

     <span class="annotation">@Test</span>
     <span class="directive">public</span> <span class="type">void</span> should_apply_route_programmatically() <span class="directive">throws</span> <span class="exception">IOException</span> {

         openShiftAssistant.deployApplication(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-route.json</span><span class="delimiter">&quot;</span></span>);  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
         <span class="directive">final</span> Optional&lt;<span class="predefined-type">URL</span>&gt; route = openShiftAssistant.getRoute(); <i class="conum" data-value="3"></i><b>(3)</b>
     }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sets the application name where everything is deployed</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Sets the resource to apply, in this case creation of an OpenShift <code>route</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can get the first defined route from cluster</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s see how can you execute <code>oc</code> or <code>kubectl</code> commands as a part of your test.</p>
</div>
<div class="listingblock">
<div class="title">OpenshiftAndK8sExample.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Category</span>(RequiresOpenshift.class)
<span class="annotation">@RequiresOpenshift</span>
<span class="annotation">@RunWith</span>(ArquillianConditionalRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldIT</span> {

    <span class="directive">private</span> <span class="directive">static</span> CommandExecutor commandExecutor = <span class="keyword">new</span> CommandExecutor();

    <span class="directive">private</span> <span class="predefined-type">String</span> ocVersion;

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> getOpenshiftVersion() {
        <span class="directive">final</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; output = commandExecutor.execCommand(<span class="string"><span class="delimiter">&quot;</span><span class="content">oc version</span><span class="delimiter">&quot;</span></span>);
        ocVersion = output.get(<span class="integer">0</span>);
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_be_able_get_namespace_using_kubectl() {
        <span class="comment">// when</span>
        <span class="directive">final</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; output = commandExecutor.execCommand(<span class="string"><span class="delimiter">&quot;</span><span class="content">kubectl get ns -o jsonpath='{..name}'</span><span class="delimiter">&quot;</span></span>);

        <span class="directive">final</span> <span class="predefined-type">String</span> firstLine = output.get(<span class="integer">0</span>);
        <span class="directive">final</span> <span class="predefined-type">String</span><span class="type">[]</span> namespaces = firstLine.substring(<span class="integer">1</span>, firstLine.length() - <span class="integer">1</span>).split(<span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>);

        <span class="comment">// then</span>
        assertThat(namespaces).contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_be_able_deploy_resources_using_oc() {
        <span class="comment">// TODO - Uncomment. Requires a known oc version. Use cases must be evaluated</span>
        <span class="comment">//assumeThat(ocVersion).contains(&quot;4.16&quot;);</span>
        <span class="predefined-type">String</span> commandToExecute = <span class="string"><span class="delimiter">&quot;</span><span class="content">oc create -f </span><span class="delimiter">&quot;</span></span> + getResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">openshift.json</span><span class="delimiter">&quot;</span></span>);

        <span class="comment">// when</span>
        <span class="directive">final</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; resources = commandExecutor.execCommand(commandToExecute);

        <span class="comment">// then</span>
        Stream&lt;<span class="predefined-type">String</span>&gt; ocOutputs = Stream.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">service/hello-world created</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">deployment.apps/hello-world created</span><span class="delimiter">&quot;</span></span>);
        Stream&lt;<span class="predefined-type">String</span>&gt; oc3Outputs = Stream.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">service </span><span class="char">\&quot;</span><span class="content">hello-world</span><span class="char">\&quot;</span><span class="content"> created</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">deployment.apps </span><span class="char">\&quot;</span><span class="content">hello-world</span><span class="char">\&quot;</span><span class="content"> created</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">if</span> (!resources.containsAll(ocOutputs.collect(Collectors.toList())) &amp;&amp; !resources.containsAll(oc3Outputs.collect(Collectors.toList()))) {
            Assert.fail(<span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">Unexpected output from oc command: %s = [%s]</span><span class="delimiter">&quot;</span></span>,
                commandToExecute, <span class="predefined-type">String</span>.join(<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>, resources)));
        }
    }

    <span class="annotation">@AfterClass</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> deleteDeployment() {
        <span class="predefined-type">String</span> commandToExecute = <span class="string"><span class="delimiter">&quot;</span><span class="content">oc delete -f </span><span class="delimiter">&quot;</span></span> + getResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">openshift.json</span><span class="delimiter">&quot;</span></span>);
        commandExecutor.execCommand(commandToExecute);
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> getResource(<span class="predefined-type">String</span> resourceName) {
        <span class="directive">final</span> <span class="predefined-type">URL</span> resource = <span class="predefined-type">Thread</span>.currentThread().getContextClassLoader().getResource(resourceName);
        <span class="keyword">if</span> (resource == <span class="predefined-constant">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalStateException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Expected </span><span class="delimiter">&quot;</span></span> + resourceName + <span class="string"><span class="delimiter">&quot;</span><span class="content"> to be on the classpath</span><span class="delimiter">&quot;</span></span>);
        }

        <span class="keyword">try</span> {
            <span class="keyword">return</span> resource.toURI().getPath();
        } <span class="keyword">catch</span> (<span class="exception">URISyntaxException</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(e);
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_openshift_integration_with_graphene"><a class="anchor" href="#_openshift_integration_with_graphene"></a>19.12. OpenShift Integration with Graphene</h3>
<div class="paragraph">
<p>Integration with Graphene allows for auto-resolution of the host and the context of the application deployed within the
OpenShift cluster by using the cluster&#8217;s <code>route</code> definition for configuring Graphene.</p>
</div>
<div class="paragraph">
<p>In case, multiple routes are defined, user can select a <code>route</code>, by setting the route name as the host part in the URL
property for Graphene.</p>
</div>
<div class="paragraph">
<p>For example, as shown in the below snippet (1), a route named <code>hello-world</code> is selected for configuring the URL for
graphene.</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">graphene</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>http://hello-world:8080<span class="tag">&lt;/property&gt;</span>   <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If there is a single route or no route name is set, a default route from the definition is used for Graphene
configuration.</p>
</div>
<div class="sect3">
<h4 id="_example_4"><a class="anchor" href="#_example_4"></a>19.12.1. Example</h4>
<div class="paragraph">
<p>Apart from adding arquillian and arquillian-cube-openshift, obviously you also need to add the dependencies for
arquillian-drone, selenium-bom and aquillian-graphene.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencyManagement&gt;</span>
    <span class="tag">&lt;dependencies&gt;</span>
        <span class="comment">&lt;!-- arquillian-drone-bom dependencies --&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.jboss.arquillian.extension<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>arquillian-drone-bom<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>2.0.0.Final<span class="tag">&lt;/version&gt;</span>
            <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
            <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>

        <span class="comment">&lt;!-- selenium-bom dependencies --&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.jboss.arquillian.selenium<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>selenium-bom<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>2.53.1<span class="tag">&lt;/version&gt;</span>
            <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
            <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span>

<span class="comment">&lt;!-- arquillian-drone webdriver dependency --&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jboss.arquillian.extension<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-drone-webdriver-depchain<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.0.0.Final<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>

<span class="comment">&lt;!-- arquillian-graphene dependencies --&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jboss.arquillian.graphene<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>graphene-webdriver<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.1.0.Final<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jboss.arquillian.graphene<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>graphene-webdriver-impl<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.1.0.Final<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see the example using Graphene at
<a href="https://github.com/arquillian/arquillian-cube/tree/master/openshift/ftest-openshift-graphene" class="bare">https://github.com/arquillian/arquillian-cube/tree/master/openshift/ftest-openshift-graphene</a> .</p>
</div>
<div class="paragraph">
<p>Also, you can learn more about Graphene at <a href="http://arquillian.org/guides/functional_testing_using_graphene/" class="bare">http://arquillian.org/guides/functional_testing_using_graphene/</a> .</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_openshift_integration_with_restassured"><a class="anchor" href="#_openshift_integration_with_restassured"></a>19.13. OpenShift Integration with RestAssured</h3>
<div class="paragraph">
<p>Integration with Rest-Assured allows for auto-resolution of the base URI of the application deployed within the
OpenShift cluster by using <code>OpenShift Route</code> definition for configuring Rest-Assured.</p>
</div>
<div class="sect3">
<h4 id="_configuration_4"><a class="anchor" href="#_configuration_4"></a>19.13.1. Configuration</h4>
<div class="paragraph">
<p>You can configure a specific base URI using the <code>baseUri</code> property from Restassured configuration. In this case, the
hostname is going to be resolved as OpenShift route name, and if there is no route with that name, then the base URI is
treated as is. For example:</p>
</div>
<div class="listingblock">
<div class="title">arquillian.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">restassured</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">baseUri</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>http://hello-openshift<span class="tag">&lt;/property&gt;</span>   <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As shown in the above snippet example (1), this integration will try to find an OpenShift route with name hello-world
and inject its IP. If there is no route with that name, then the base URI field is considered to be the final base URI.</p>
</div>
<div class="paragraph">
<p>If however, no specific base URI is configured, a default route from the definition is used for rest-assured
configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dependency"><a class="anchor" href="#_dependency"></a>19.13.2. Dependency</h4>
<div class="paragraph">
<p>To use Arquillian Cube OpenShift RestAssured integration you only need to add as dependency.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-openshift-restassured<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_5"><a class="anchor" href="#_example_5"></a>19.13.3. Example</h4>
<div class="paragraph">
<p>After setting the dependencies for OpenShift and OpenShift-RestAssured and configuring the extensions, you are all set
to write your Arquillian Cube test as :</p>
</div>
<div class="listingblock">
<div class="title">HelloOpenShiftRestAssuredIT.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Category</span>(RequiresOpenshift.class)
<span class="annotation">@RunWith</span>(ArquillianConditionalRunner.class)
<span class="annotation">@RequiresOpenshift</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloOpenShiftRestAssuredIT</span> {

    <span class="annotation">@ArquillianResource</span>
    RequestSpecBuilder requestSpecBuilder;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testGreetingEndpoint() {
        given(requestSpecBuilder.build())
            .when().get()
            .then()
            .statusCode(<span class="integer">200</span>)
            .body(containsString(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello OpenShift!</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that no <em>ip</em> nor <em>port</em> configuration are required since everything is managed and configured by Cube.</p>
</div>
<div class="paragraph">
<p>You can see the full example using OpenShift and Rest-Assured at
<a href="https://github.com/arquillian/arquillian-cube/tree/master/openshift/ftest-openshift-restassured" class="bare">https://github.com/arquillian/arquillian-cube/tree/master/openshift/ftest-openshift-restassured</a> .</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_istio_in_kubernetesopenshift"><a class="anchor" href="#_istio_in_kubernetesopenshift"></a>19.14. Istio in Kubernetes/OpenShift</h3>
<div class="paragraph">
<p>Arquillian Cube also support Istio, so you can apply Istio resources before executing tests.</p>
</div>
<div class="paragraph">
<p>As it happens with Arquillian Kubernetes/OpenShift integration, the integration is provided as annotation and as assistant.</p>
</div>
<div class="sect3">
<h4 id="_dependency_2"><a class="anchor" href="#_dependency_2"></a>19.14.1. Dependency</h4>
<div class="paragraph">
<p>To use Istio integration you just need to add next dependency.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.arquillian.cube<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>arquillian-cube-istio-kubernetes<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>${project.version}<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Same dependency can be used for OpenShift
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_istioresource"><a class="anchor" href="#_istioresource"></a>19.14.2. <code>@IstioResource</code></h4>
<div class="paragraph">
<p>You can define at a class or method level which Istio resource to apply before any test class or method execution. Those resources will be unregistered after all corresponding test class or methods are executed.</p>
</div>
<div class="paragraph">
<p>The location of Istio Resource can start with <code>http(s):</code> or <code>file:</code> which then the value is treated as <code>URL.
If location is prefixed with `classpath:</code>, then the resource is considered to be located at classpath.</p>
</div>
<div class="paragraph">
<p>If it is not prefixed, then the resource is considered to be the content text.</p>
</div>
<div class="paragraph">
<p>For example: <code>@IstioResource("classpath:istio_route_rule.yaml")</code></p>
</div>
<div class="paragraph">
<p>The value also supports like <code>${property:defaultValue}</code> where `property is resolved against system property, if not set then environment variable, and if not set the default value (if specified) is returned.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When applying any resource, Istio notifies that the resource has been correctly registered, but this does not mean that all the configuration has been populated across all the cluster.</p>
</div>
<div class="paragraph">
<p>This means that when test method is executed, all Istio elements might not be updated yet.
At this time, Istio does not cover to query its state, so the only thing you can do is either sleeping some amount of time before executing the test or create some polling against a service that should be reachable after applying the rule.</p>
</div>
<div class="paragraph">
<p><a href="#_istio_assistant">Istio Assistant</a> provides some helper methd based on <code>awaitility</code> and <code>OkHttp</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_restoreistioresource"><a class="anchor" href="#_restoreistioresource"></a>19.14.3. <code>@RestoreIstioResource</code></h4>
<div class="paragraph">
<p>Same as <code>@IstioResource</code>, there is a <code>@RestoreIstioResource</code> which is applied after execution (test class or test method depending on the scope).</p>
</div>
</div>
<div class="sect3">
<h4 id="_istio_assistant"><a class="anchor" href="#_istio_assistant"></a>19.14.4. Istio Assistant</h4>
<div class="paragraph">
<p>You can register and unregister Istio resources programmatically using <code>IstioAssistant</code>.
Notice that both annotations and assistant approaches can be mixed in the same test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ArquillianResource</span>
<span class="directive">private</span> IstioAssistant istioAssistant;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The assistant provides you <code>deployIstioResources</code> and <code>undeployIstioResources</code> to deploy and undeploy Istio resources.</p>
</div>
<div class="paragraph">
<p>Assistant also provides a helper method to poll a URL based on <code>awaitility</code> and <code>OkHttp</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> Request request = <span class="keyword">new</span> Request.Builder()
    .url(url.toString() + <span class="string"><span class="delimiter">&quot;</span><span class="content">api/v1/products/0/reviews</span><span class="delimiter">&quot;</span></span>)
    .addHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cookie</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">user=alex; Domain=</span><span class="delimiter">&quot;</span></span> + url.getHost() +<span class="string"><span class="delimiter">&quot;</span><span class="content">; Path=/</span><span class="delimiter">&quot;</span></span>)
    .build(); <i class="conum" data-value="1"></i><b>(1)</b>

istioAssistant.await(request, response -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">2.0.0</span><span class="delimiter">&quot;</span></span>.equals(response.header(<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>))); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creates the request to reach version 2.0.0 of the service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When all proxies are updated the request will finally get service 2 (instead of 1) and return the version in header</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_arquillian_kubernetes_and_openshift_recipes"><a class="anchor" href="#_arquillian_kubernetes_and_openshift_recipes"></a>19.15. Arquillian Kubernetes and OpenShift Recipes</h3>
<div class="paragraph">
<p>To help you get started with ease, listed below are specially curated examples for Kubernetes and OpenShift Extensions.</p>
</div>
<div class="sect3">
<h4 id="_example_1"><a class="anchor" href="#_example_1"></a>19.15.1. Example 1</h4>
<div class="paragraph">
<p>Deploying a sample PHP Guestbook application with Redis on Kubernetes from the resource descriptor
manifest file and testing it using Arquillian Cube Extension for Kubernetes and Kubernetes custom assertions.</p>
</div>
<div class="paragraph">
<p>Source: <a href="https://github.com/arquillian-testing-microservices/kubernetes-deployment-testing">arquillian-testing-microservices/kubernetes-deployment-testing</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_example_2_2"><a class="anchor" href="#_example_2_2"></a>19.15.2. Example 2</h4>
<div class="paragraph">
<p>Deploying a Wordpress and My SQL application to OpenShift from a Template file and testing it using Arquillian
Cube Extension for OpenShift and  Fabric8 OpenShift Client.</p>
</div>
<div class="paragraph">
<p>Source: <a href="https://github.com/arquillian-testing-microservices/openshift-deployment-testing">arquillian-testing-microservices/openshift-deployment-testing</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dealing_with_version_conflicts"><a class="anchor" href="#_dealing_with_version_conflicts"></a>19.16. Dealing with version conflicts</h3>
<div class="paragraph">
<p>Arquillian Cube Kubernetes and Openshift modules, heavily rely on the Fabric8 Kubernetes/Openshift client.
This client is also used in wide range of frameworks, so its not that long of a shot to encounter version conflicts.</p>
</div>
<div class="paragraph">
<p>To eliminate such issues, arquillian as of 1.1.0 is using a shaded uberjar of the client which contains versioned
package (with major and minor version).</p>
</div>
<div class="paragraph">
<p>All enrichers provided by the arquillian modules, are configured to work both with the internal types, but also with
whatever version of the client that is found in the classpath.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If your existing tests don&#8217;t have a dependency to the kubernetes-client, you will either need to add
kubernetes-client, to your classpath or use the internal classes. It is recommended to do the first.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fabric8"><a class="anchor" href="#_fabric8"></a>20. Fabric8</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Fabric8 extension can be used along with the Kubernetes extension to provide a tighter integration with the <a href="https://github.com/fabric8io/kubernetes-client">Fabric8 Kubernetes Client</a></p>
</div>
<div class="sect2">
<h3 id="_additional_features"><a class="anchor" href="#_additional_features"></a>20.1. Additional Features</h3>
<div class="ulist">
<ul>
<li>
<p>Integration with <a href="https://eclipse.dev/jkube/docs/kubernetes-maven-plugin/">JKube Kubernetes Maven Plugin</a></p>
</li>
<li>
<p>Integration with <a href="https://eclipse.dev/jkube/docs/openshift-maven-plugin/">JKube OpenShift Maven Plugin</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_jkube_kubernetes_openshift_maven_plugin_integration_with_cube"><a class="anchor" href="#_jkube_kubernetes_openshift_maven_plugin_integration_with_cube"></a>20.2. JKube Kubernetes &amp; OpenShift Maven Plugin Integration With Cube</h3>
<div class="paragraph">
<p>If you are using <a href="https://eclipse.dev/jkube/docs/kubernetes-maven-plugin/">JKube Kubernetes Maven Plugin</a> or
<a href="https://eclipse.dev/jkube/docs/openshift-maven-plugin/">JKube OpenShift Maven Plugin</a> to build images, generate
resources and deploy your application to cluster, then you should use the same approach for integration testing using Cube.</p>
</div>
<div class="paragraph">
<p>However, there is way to build images and generate resources using the JKube <code>kubernetes-maven-plugin</code> or
<code>openshift-maven-plugin</code> as a part of test execution.
If you enable <code>cube.fmp.build</code> property, cube will build image and generate resources for you by running embedded maven
build as per options provided in <code>arquillian.xml</code> using either:
- <code>mvn package k8s:build k8s:resource -Dfabric8.namespace=${namespace_configured_for_cube}</code>, or
- <code>mvn package oc:build oc:resource -Dfabric8.namespace=${namespace_configured_for_cube}</code></p>
</div>
<div class="paragraph">
<p>You can use the following configuration options with Kubernetes and OpenShift extension to enable
<a href="https://eclipse.dev/jkube/docs/kubernetes-maven-plugin/">JKube Kubernetes Maven Plugin</a> or
<a href="https://eclipse.dev/jkube/docs/openshift-maven-plugin/">JKube OpenShift Maven Plugin</a> build in test execution.</p>
</div>
<div class="paragraph">
<p><strong>Configuration Options</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Options</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Env</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cube.fmp.build</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool (false)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to generate resources using fmp when running test from Maven or IDE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cube.fmp.build.disable.for.mvn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool (false)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to generate resources using fmp only when running test from IDE, not from maven</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cube.fmp.pom.path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to pom.xml where fmp plugin configuration is present. Defaults to <code>pom.xml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cube.fmp.build.options</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters used to start up the JVM running Embedded Maven and can be used to supply additional options to Embedded Maven.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cube.fmp.debug.output</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool (false)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to show debug output(-X) for generating resources using JKube Kubernetes or OpenShift maven plugin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cube.fmp.logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool (true)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to show logs for generating resources using JKube Kubernetes or OpenShift maven plugin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cube.fmp.profiles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-separated list of profiles which you want to activate while generating resources</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cube.fmp.system.properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-separated key value pair to use for maven build</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>IMPORTANT</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure you have either the JKube <code>kubernetes-maven-plugin</code> or <code>openshift-maven-plugin</code> dependency in plugin section:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;build&gt;</span>
    <span class="tag">&lt;plugins&gt;</span>
      <span class="tag">&lt;plugin&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>kubernetes-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>${version.jkube}<span class="tag">&lt;/version&gt;</span>
      <span class="tag">&lt;/plugin&gt;</span>
    <span class="tag">&lt;/plugins&gt;</span>
  <span class="tag">&lt;/build&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;build&gt;</span>
    <span class="tag">&lt;plugins&gt;</span>
      <span class="tag">&lt;plugin&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.eclipse.jkube<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>openshift-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>${version.jkube}<span class="tag">&lt;/version&gt;</span>
      <span class="tag">&lt;/plugin&gt;</span>
    <span class="tag">&lt;/plugins&gt;</span>
  <span class="tag">&lt;/build&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If you have multiple profiles defined in your pom.xml, you can enable profile in which you have the JKube
<code>kubernetes-maven-plugin</code> or the <code>openshift-maven-plugin</code> dependency by using <code>cube.fmp.profiles</code> in arquillian.xml.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can see the example using <code>openshift-maven-plugin</code> at: <a href="https://github.com/arquillian/arquillian-cube/tree/main/openshift/ftest-openshift-jkube-maven-plugin" class="bare">https://github.com/arquillian/arquillian-cube/tree/main/openshift/ftest-openshift-jkube-maven-plugin</a></p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-02-07 08:46:42 UTC
</div>
</div>
</body>
</html>